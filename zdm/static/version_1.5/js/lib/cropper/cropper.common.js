/*!
 * Cropper.js v1.1.2
 * https://github.com/fengyuanchen/cropperjs
 *
 * Copyright (c) 2015-2017 Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2017-10-18T13:27:02.189Z
 */

function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function isNumber(a){return typeof a=="number"&&!isNaN(a)}function isUndefined(a){return typeof a=="undefined"}function isObject(a){return(typeof a=="undefined"?"undefined":_typeof(a))==="object"&&a!==null}function isPlainObject(a){if(!isObject(a))return!1;try{var b=a.constructor,c=b.prototype;return b&&c&&hasOwnProperty.call(c,"isPrototypeOf")}catch(d){return!1}}function isFunction(a){return typeof a=="function"}function each(a,b){if(a&&isFunction(b))if(Array.isArray(a)||isNumber(a.length)){var c=a.length,d=void 0;for(d=0;d<c;d+=1)if(b.call(a,a[d],d,a)===!1)break}else isObject(a)&&Object.keys(a).forEach(function(c){b.call(a,a[c],c,a)});return a}function extend(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];if(isObject(a)&&c.length>0){if(Object.assign)return Object.assign.apply(Object,[a].concat(c));c.forEach(function(b){isObject(b)&&Object.keys(b).forEach(function(c){a[c]=b[c]})})}return a}function proxy(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}}function normalizeDecimalNumber(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e11;return REGEXP_DECIMALS.test(a)?Math.round(a*b)/b:a}function setStyle(a,b){var c=a.style;each(b,function(a,b){REGEXP_SUFFIX.test(b)&&isNumber(a)&&(a+="px"),c[b]=a})}function hasClass(a,b){return a.classList?a.classList.contains(b):a.className.indexOf(b)>-1}function addClass(a,b){if(!b)return;if(isNumber(a.length)){each(a,function(a){addClass(a,b)});return}if(a.classList){a.classList.add(b);return}var c=a.className.trim();c?c.indexOf(b)<0&&(a.className=c+" "+b):a.className=b}function removeClass(a,b){if(!b)return;if(isNumber(a.length)){each(a,function(a){removeClass(a,b)});return}if(a.classList){a.classList.remove(b);return}a.className.indexOf(b)>=0&&(a.className=a.className.replace(b,""))}function toggleClass(a,b,c){if(!b)return;if(isNumber(a.length)){each(a,function(a){toggleClass(a,b,c)});return}c?addClass(a,b):removeClass(a,b)}function hyphenate(a){return a.replace(REGEXP_HYPHENATE,"$1-$2").toLowerCase()}function getData(a,b){return isObject(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-"+hyphenate(b))}function setData(a,b,c){isObject(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-"+hyphenate(b),c)}function removeData(a,b){if(isObject(a[b]))delete a[b];else if(a.dataset)try{delete a.dataset[b]}catch(c){a.dataset[b]=null}else a.removeAttribute("data-"+hyphenate(b))}function removeListener(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!isFunction(c))return;var e=b.trim().split(REGEXP_SPACES);if(e.length>1){each(e,function(b){removeListener(a,b,c)});return}isFunction(c.onceListener)&&(c=c.onceListener,delete c.onceListener),a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)}function addListener(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!isFunction(c))return;var e=b.trim().split(REGEXP_SPACES);if(e.length>1){each(e,function(b){addListener(a,b,c)});return}if(d.once){var f=c,g=function h(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return removeListener(a,b,h),f.apply(a,d)};f.onceListener=g,c=g}a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)}function dispatchEvent(a,b,c){if(a.dispatchEvent){var d=void 0;return isFunction(Event)&&isFunction(CustomEvent)?isUndefined(c)?d=new Event(b,{bubbles:!0,cancelable:!0}):d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):isUndefined(c)?(d=document.createEvent("Event"),d.initEvent(b,!0,!0)):(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!0,c)),a.dispatchEvent(d)}return a.fireEvent?a.fireEvent("on"+b):!0}function getOffset(a){var b=document.documentElement,c=a.getBoundingClientRect();return{left:c.left+((global.scrollX||b&&b.scrollLeft||0)-(b&&b.clientLeft||0)),top:c.top+((global.scrollY||b&&b.scrollTop||0)-(b&&b.clientTop||0))}}function empty(a){while(a.firstChild)a.removeChild(a.firstChild)}function isCrossOriginURL(a){var b=a.match(REGEXP_ORIGINS);return b&&(b[1]!==location.protocol||b[2]!==location.hostname||b[3]!==location.port)}function addTimestamp(a){var b="timestamp="+(new Date).getTime();return a+(a.indexOf("?")===-1?"?":"&")+b}function getTransforms(a){var b=a.rotate,c=a.scaleX,d=a.scaleY,e=a.translateX,f=a.translateY,g=[];isNumber(e)&&e!==0&&g.push("translateX("+e+"px)"),isNumber(f)&&f!==0&&g.push("translateY("+f+"px)"),isNumber(b)&&b!==0&&g.push("rotate("+b+"deg)"),isNumber(c)&&c!==1&&g.push("scaleX("+c+")"),isNumber(d)&&d!==1&&g.push("scaleY("+d+")");var h=g.length?g.join(" "):"none";return{WebkitTransform:h,msTransform:h,transform:h}}function getImageNaturalSizes(a,b){if(a.naturalWidth&&!IS_SAFARI_OR_UIWEBVIEW){b(a.naturalWidth,a.naturalHeight);return}var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.src=a.src}function getMaxZoomRatio(a){var b=extend({},a),c=[];return each(a,function(a,d){delete b[d],each(b,function(b){var d=Math.abs(a.startX-b.startX),e=Math.abs(a.startY-b.startY),f=Math.abs(a.endX-b.endX),g=Math.abs(a.endY-b.endY),h=Math.sqrt(d*d+e*e),i=Math.sqrt(f*f+g*g),j=(i-h)/h;c.push(j)})}),c.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),c[0]}function getPointer(a,b){var c=a.pageX,d=a.pageY,e={endX:c,endY:d};return b?e:extend({startX:c,startY:d},e)}function getPointersCenter(a){var b=0,c=0,d=0;return each(a,function(a){var e=a.startX,f=a.startY;b+=e,c+=f,d+=1}),b/=d,c/=d,{pageX:b,pageY:c}}function getContainSizes(a){var b=a.aspectRatio,c=a.height,d=a.width,e=function(a){return isFinite(a)&&a>0};return e(d)&&e(c)?c*b>d?c=d/b:d=c*b:e(d)?c=d/b:e(c)&&(d=c*b),{width:d,height:c}}function getRotatedSizes(a){var b=a.width,c=a.height,d=a.degree;d=Math.abs(d);if(d%180===90)return{width:c,height:b};var e=d%90*Math.PI/180,f=Math.sin(e),g=Math.cos(e);return{width:b*g+c*f,height:b*f+c*g}}function getSourceCanvas(a,b,c,d){var e=b.naturalWidth,f=b.naturalHeight,g=b.rotate,h=b.scaleX,i=b.scaleY,j=c.aspectRatio,k=c.naturalWidth,l=c.naturalHeight,m=d.fillColor,n=m===undefined?"transparent":m,o=d.imageSmoothingEnabled,p=o===undefined?!0:o,q=d.imageSmoothingQuality,r=q===undefined?"low":q,s=d.maxWidth,t=s===undefined?Infinity:s,u=d.maxHeight,v=u===undefined?Infinity:u,w=d.minWidth,x=w===undefined?0:w,y=d.minHeight,z=y===undefined?0:y,A=document.createElement("canvas"),B=A.getContext("2d"),C=getContainSizes({aspectRatio:j,width:t,height:v}),D=getContainSizes({aspectRatio:j,width:x,height:z}),E=Math.min(C.width,Math.max(D.width,k)),F=Math.min(C.height,Math.max(D.height,l)),G=[-e/2,-f/2,e,f];return A.width=normalizeDecimalNumber(E),A.height=normalizeDecimalNumber(F),B.fillStyle=n,B.fillRect(0,0,E,F),B.save(),B.translate(E/2,F/2),B.rotate(g*Math.PI/180),B.scale(h,i),B.imageSmoothingEnabled=p,B.imageSmoothingQuality=r,B.drawImage.apply(B,[a].concat(_toConsumableArray(G.map(function(a){return Math.floor(normalizeDecimalNumber(a))})))),B.restore(),A}function getStringFromCharCode(a,b,c){var d="",e=void 0;c+=b;for(e=b;e<c;e+=1)d+=fromCharCode(a.getUint8(e));return d}function dataURLToArrayBuffer(a){var b=a.replace(REGEXP_DATA_URL_HEAD,""),c=atob(b),d=new ArrayBuffer(c.length),e=new Uint8Array(d);return each(e,function(a,b){e[b]=c.charCodeAt(b)}),d}function arrayBufferToDataURL(a,b){var c=new Uint8Array(a),d="";return each(c,function(a){d+=fromCharCode(a)}),"data:"+b+";base64,"+btoa(d)}function getOrientation(a){var b=new DataView(a),c=void 0,d=void 0,e=void 0,f=void 0;if(b.getUint8(0)===255&&b.getUint8(1)===216){var g=b.byteLength,h=2;while(h<g){if(b.getUint8(h)===255&&b.getUint8(h+1)===225){e=h;break}h+=1}}if(e){var i=e+4,j=e+10;if(getStringFromCharCode(b,i,4)==="Exif"){var k=b.getUint16(j);d=k===18761;if(d||k===19789)if(b.getUint16(j+2,d)===42){var l=b.getUint32(j+4,d);l>=8&&(f=j+l)}}}if(f){var m=b.getUint16(f,d),n=void 0,o=void 0;for(o=0;o<m;o+=1){n=f+o*12+2;if(b.getUint16(n,d)===274){n+=8,c=b.getUint16(n,d),b.setUint16(n,1,d);break}}}return c}function parseOrientation(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=90,d=-1;break;case 6:b=90;break;case 7:b=90,c=-1;break;case 8:b=-90;break;default:}return{rotate:b,scaleX:c,scaleY:d}}function _toConsumableArray$1(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var global=typeof window!="undefined"?window:{},NAMESPACE="cropper",ACTION_ALL="all",ACTION_CROP="crop",ACTION_MOVE="move",ACTION_ZOOM="zoom",ACTION_EAST="e",ACTION_WEST="w",ACTION_SOUTH="s",ACTION_NORTH="n",ACTION_NORTH_EAST="ne",ACTION_NORTH_WEST="nw",ACTION_SOUTH_EAST="se",ACTION_SOUTH_WEST="sw",CLASS_CROP=NAMESPACE+"-crop",CLASS_DISABLED=NAMESPACE+"-disabled",CLASS_HIDDEN=NAMESPACE+"-hidden",CLASS_HIDE=NAMESPACE+"-hide",CLASS_INVISIBLE=NAMESPACE+"-invisible",CLASS_MODAL=NAMESPACE+"-modal",CLASS_MOVE=NAMESPACE+"-move",DATA_ACTION="action",DATA_PREVIEW="preview",DRAG_MODE_CROP="crop",DRAG_MODE_MOVE="move",DRAG_MODE_NONE="none",EVENT_CROP="crop",EVENT_CROP_END="cropend",EVENT_CROP_MOVE="cropmove",EVENT_CROP_START="cropstart",EVENT_DBLCLICK="dblclick",EVENT_ERROR="error",EVENT_LOAD="load",EVENT_POINTER_DOWN=global.PointerEvent?"pointerdown":"touchstart mousedown",EVENT_POINTER_MOVE=global.PointerEvent?"pointermove":"touchmove mousemove",EVENT_POINTER_UP=global.PointerEvent?" pointerup pointercancel":"touchend touchcancel mouseup",EVENT_READY="ready",EVENT_RESIZE="resize",EVENT_WHEEL="wheel mousewheel DOMMouseScroll",EVENT_ZOOM="zoom",REGEXP_ACTIONS=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,REGEXP_DATA_URL=/^data:/,REGEXP_DATA_URL_JPEG=/^data:image\/jpeg;base64,/,REGEXP_TAG_NAME=/^(img|canvas)$/i,DEFAULTS={viewMode:0,dragMode:DRAG_MODE_CROP,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},isNaN=Number.isNaN||global.isNaN,hasOwnProperty=Object.prototype.hasOwnProperty,REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/i,REGEXP_SUFFIX=/^(width|height|left|top|marginLeft|marginTop)$/,REGEXP_HYPHENATE=/([a-z\d])([A-Z])/g,REGEXP_SPACES=/\s+/,location=global.location,REGEXP_ORIGINS=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,navigator=global.navigator,IS_SAFARI_OR_UIWEBVIEW=navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),isFinite=Number.isFinite||global.isFinite,fromCharCode=String.fromCharCode,REGEXP_DATA_URL_HEAD=/^data:.*,/,render={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.element,b=this.options,c=this.container,d=this.cropper;addClass(d,CLASS_HIDDEN),removeClass(a,CLASS_HIDDEN);var e={width:Math.max(c.offsetWidth,Number(b.minContainerWidth)||200),height:Math.max(c.offsetHeight,Number(b.minContainerHeight)||100)};this.containerData=e,setStyle(d,{width:e.width,height:e.height}),addClass(a,CLASS_HIDDEN),removeClass(d,CLASS_HIDDEN)},initCanvas:function(){var a=this.containerData,b=this.imageData,c=this.options.viewMode,d=Math.abs(b.rotate)%180===90,e=d?b.naturalHeight:b.naturalWidth,f=d?b.naturalWidth:b.naturalHeight,g=e/f,h=a.width,i=a.height;a.height*g>a.width?c===3?h=a.height*g:i=a.width/g:c===3?i=a.width/g:h=a.height*g;var j={aspectRatio:g,naturalWidth:e,naturalHeight:f,width:h,height:i};j.left=(a.width-h)/2,j.top=(a.height-i)/2,j.oldLeft=j.left,j.oldTop=j.top,this.canvasData=j,this.limited=c===1||c===2,this.limitCanvas(!0,!0),this.initialImageData=extend({},b),this.initialCanvasData=extend({},j)},limitCanvas:function(a,b){var c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=c.viewMode,h=e.aspectRatio,i=this.cropped&&f;if(a){var j=Number(c.minCanvasWidth)||0,k=Number(c.minCanvasHeight)||0;g>1?(j=Math.max(j,d.width),k=Math.max(k,d.height),g===3&&(k*h>j?j=k*h:k=j/h)):g>0&&(j?j=Math.max(j,i?f.width:0):k?k=Math.max(k,i?f.height:0):i&&(j=f.width,k=f.height,k*h>j?j=k*h:k=j/h));var l=getContainSizes({aspectRatio:h,width:j,height:k});j=l.width,k=l.height,e.minWidth=j,e.minHeight=k,e.maxWidth=Infinity,e.maxHeight=Infinity}if(b)if(g){var m=d.width-e.width,n=d.height-e.height;e.minLeft=Math.min(0,m),e.minTop=Math.min(0,n),e.maxLeft=Math.max(0,m),e.maxTop=Math.max(0,n),i&&this.limited&&(e.minLeft=Math.min(f.left,f.left+(f.width-e.width)),e.minTop=Math.min(f.top,f.top+(f.height-e.height)),e.maxLeft=f.left,e.maxTop=f.top,g===2&&(e.width>=d.width&&(e.minLeft=Math.min(0,m),e.maxLeft=Math.max(0,m)),e.height>=d.height&&(e.minTop=Math.min(0,n),e.maxTop=Math.max(0,n))))}else e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=d.width,e.maxTop=d.height},renderCanvas:function(a,b){var c=this.canvasData,d=this.imageData;if(b){var e=getRotatedSizes({width:d.naturalWidth*Math.abs(d.scaleX),height:d.naturalHeight*Math.abs(d.scaleY),degree:d.rotate}),f=e.width,g=e.height,h=c.width*(f/c.naturalWidth),i=c.height*(g/c.naturalHeight);c.left-=(h-c.width)/2,c.top-=(i-c.height)/2,c.width=h,c.height=i,c.aspectRatio=f/g,c.naturalWidth=f,c.naturalHeight=g,this.limitCanvas(!0,!1)}if(c.width>c.maxWidth||c.width<c.minWidth)c.left=c.oldLeft;if(c.height>c.maxHeight||c.height<c.minHeight)c.top=c.oldTop;c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCanvas(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,setStyle(this.canvas,extend({width:c.width,height:c.height},getTransforms({translateX:c.left,translateY:c.top}))),this.renderImage(a),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(a){var b=this.canvasData,c=this.imageData,d=c.naturalWidth*(b.width/b.naturalWidth),e=c.naturalHeight*(b.height/b.naturalHeight);extend(c,{width:d,height:e,left:(b.width-d)/2,top:(b.height-e)/2}),setStyle(this.image,extend({width:c.width,height:c.height},getTransforms(extend({translateX:c.left,translateY:c.top},c)))),a&&this.output()},initCropBox:function(){var a=this.options,b=this.canvasData,c=a.aspectRatio,d=Number(a.autoCropArea)||.8,e={width:b.width,height:b.height};c&&(b.height*c>b.width?e.height=e.width/c:e.width=e.height*c),this.cropBoxData=e,this.limitCropBox(!0,!0),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),e.width=Math.max(e.minWidth,e.width*d),e.height=Math.max(e.minHeight,e.height*d),e.left=b.left+(b.width-e.width)/2,e.top=b.top+(b.height-e.height)/2,e.oldLeft=e.left,e.oldTop=e.top,this.initialCropBoxData=extend({},e)},limitCropBox:function(a,b){var c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=this.limited,h=c.aspectRatio;if(a){var i=Number(c.minCropBoxWidth)||0,j=Number(c.minCropBoxHeight)||0,k=Math.min(d.width,g?e.width:d.width),l=Math.min(d.height,g?e.height:d.height);i=Math.min(i,d.width),j=Math.min(j,d.height),h&&(i&&j?j*h>i?j=i/h:i=j*h:i?j=i/h:j&&(i=j*h),l*h>k?l=k/h:k=l*h),f.minWidth=Math.min(i,k),f.minHeight=Math.min(j,l),f.maxWidth=k,f.maxHeight=l}b&&(g?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(d.width,e.left+e.width)-f.width,f.maxTop=Math.min(d.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=d.width-f.width,f.maxTop=d.height-f.height))},renderCropBox:function(){var a=this.options,b=this.containerData,c=this.cropBoxData;if(c.width>c.maxWidth||c.width<c.minWidth)c.left=c.oldLeft;if(c.height>c.maxHeight||c.height<c.minHeight)c.top=c.oldTop;c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCropBox(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,a.movable&&a.cropBoxMovable&&setData(this.face,DATA_ACTION,c.width>=b.width&&c.height>=b.height?ACTION_MOVE:ACTION_ALL),setStyle(this.cropBox,extend({width:c.width,height:c.height},getTransforms({translateX:c.left,translateY:c.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete&&dispatchEvent(this.element,EVENT_CROP,this.getData())}},preview={initPreview:function(){var a=this.crossOrigin,b=this.options.preview,c=a?this.crossOriginUrl:this.url,d=document.createElement("img");a&&(d.crossOrigin=a),d.src=c,this.viewBox.appendChild(d),this.image2=d;if(!b)return;var e=b.querySelector?[b]:document.querySelectorAll(b);this.previews=e,each(e,function(b){var d=document.createElement("img");setData(b,DATA_PREVIEW,{width:b.offsetWidth,height:b.offsetHeight,html:b.innerHTML}),a&&(d.crossOrigin=a),d.src=c,d.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',empty(b),b.appendChild(d)})},resetPreview:function(){each(this.previews,function(a){var b=getData(a,DATA_PREVIEW);setStyle(a,{width:b.width,height:b.height}),a.innerHTML=b.html,removeData(a,DATA_PREVIEW)})},preview:function(){var a=this.imageData,b=this.canvasData,c=this.cropBoxData,d=c.width,e=c.height,f=a.width,g=a.height,h=c.left-b.left-a.left,i=c.top-b.top-a.top;if(!this.cropped||this.disabled)return;setStyle(this.image2,extend({width:f,height:g},getTransforms(extend({translateX:-h,translateY:-i},a)))),each(this.previews,function(b){var c=getData(b,DATA_PREVIEW),j=c.width,k=c.height,l=j,m=k,n=1;d&&(n=j/d,m=e*n),e&&m>k&&(n=k/e,l=d*n,m=k),setStyle(b,{width:l,height:m}),setStyle(b.getElementsByTagName("img")[0],extend({width:f*n,height:g*n},getTransforms(extend({translateX:-h*n,translateY:-i*n},a))))})}},events={bind:function(){var a=this.element,b=this.options,c=this.cropper;isFunction(b.cropstart)&&addListener(a,EVENT_CROP_START,b.cropstart),isFunction(b.cropmove)&&addListener(a,EVENT_CROP_MOVE,b.cropmove),isFunction(b.cropend)&&addListener(a,EVENT_CROP_END,b.cropend),isFunction(b.crop)&&addListener(a,EVENT_CROP,b.crop),isFunction(b.zoom)&&addListener(a,EVENT_ZOOM,b.zoom),addListener(c,EVENT_POINTER_DOWN,this.onCropStart=proxy(this.cropStart,this)),b.zoomable&&b.zoomOnWheel&&addListener(c,EVENT_WHEEL,this.onWheel=proxy(this.wheel,this)),b.toggleDragModeOnDblclick&&addListener(c,EVENT_DBLCLICK,this.onDblclick=proxy(this.dblclick,this)),addListener(document,EVENT_POINTER_MOVE,this.onCropMove=proxy(this.cropMove,this)),addListener(document,EVENT_POINTER_UP,this.onCropEnd=proxy(this.cropEnd,this)),b.responsive&&addListener(global,EVENT_RESIZE,this.onResize=proxy(this.resize,this))},unbind:function(){var a=this.element,b=this.options,c=this.cropper;isFunction(b.cropstart)&&removeListener(a,EVENT_CROP_START,b.cropstart),isFunction(b.cropmove)&&removeListener(a,EVENT_CROP_MOVE,b.cropmove),isFunction(b.cropend)&&removeListener(a,EVENT_CROP_END,b.cropend),isFunction(b.crop)&&removeListener(a,EVENT_CROP,b.crop),isFunction(b.zoom)&&removeListener(a,EVENT_ZOOM,b.zoom),removeListener(c,EVENT_POINTER_DOWN,this.onCropStart),b.zoomable&&b.zoomOnWheel&&removeListener(c,EVENT_WHEEL,this.onWheel),b.toggleDragModeOnDblclick&&removeListener(c,EVENT_DBLCLICK,this.onDblclick),removeListener(document,EVENT_POINTER_MOVE,this.onCropMove),removeListener(document,EVENT_POINTER_UP,this.onCropEnd),b.responsive&&removeListener(global,EVENT_RESIZE,this.onResize)}},handlers={resize:function(){var a=this.options,b=this.container,c=this.containerData,d=Number(a.minContainerWidth)||200,e=Number(a.minContainerHeight)||100;if(this.disabled||c.width<=d||c.height<=e)return;var f=b.offsetWidth/c.width;if(f!==1||b.offsetHeight!==c.height){var g=void 0,h=void 0;a.restore&&(g=this.getCanvasData(),h=this.getCropBoxData()),this.render(),a.restore&&(this.setCanvasData(each(g,function(a,b){g[b]=a*f})),this.setCropBoxData(each(h,function(a,b){h[b]=a*f})))}},dblclick:function(){if(this.disabled||this.options.dragMode===DRAG_MODE_NONE)return;this.setDragMode(hasClass(this.dragBox,CLASS_CROP)?DRAG_MODE_MOVE:DRAG_MODE_CROP)},wheel:function(a){var b=this,c=Number(this.options.wheelZoomRatio)||.1,d=1;if(this.disabled)return;a.preventDefault();if(this.wheeling)return;this.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),a.deltaY?d=a.deltaY>0?1:-1:a.wheelDelta?d=-a.wheelDelta/120:a.detail&&(d=a.detail>0?1:-1),this.zoom(-d*c,a)},cropStart:function(a){if(this.disabled)return;var b=this.options,c=this.pointers,d=void 0;a.changedTouches?each(a.changedTouches,function(a){c[a.identifier]=getPointer(a)}):c[a.pointerId||0]=getPointer(a),Object.keys(c).length>1&&b.zoomable&&b.zoomOnTouch?d=ACTION_ZOOM:d=getData(a.target,DATA_ACTION);if(!REGEXP_ACTIONS.test(d))return;if(dispatchEvent(this.element,EVENT_CROP_START,{originalEvent:a,action:d})===!1)return;a.preventDefault(),this.action=d,this.cropping=!1,d===ACTION_CROP&&(this.cropping=!0,addClass(this.dragBox,CLASS_MODAL))},cropMove:function(a){var b=this.action;if(this.disabled||!b)return;var c=this.pointers;a.preventDefault();if(dispatchEvent(this.element,EVENT_CROP_MOVE,{originalEvent:a,action:b})===!1)return;a.changedTouches?each(a.changedTouches,function(a){extend(c[a.identifier],getPointer(a,!0))}):extend(c[a.pointerId||0],getPointer(a,!0)),this.change(a)},cropEnd:function(a){if(this.disabled)return;var b=this.action,c=this.pointers;a.changedTouches?each(a.changedTouches,function(a){delete c[a.identifier]}):delete c[a.pointerId||0];if(!b)return;a.preventDefault(),Object.keys(c).length||(this.action=""),this.cropping&&(this.cropping=!1,toggleClass(this.dragBox,CLASS_MODAL,this.cropped&&this.options.modal)),dispatchEvent(this.element,EVENT_CROP_END,{originalEvent:a,action:b})}},change={change:function(a){var b=this.options,c=this.canvasData,d=this.containerData,e=this.cropBoxData,f=this.pointers,g=this.action,h=b.aspectRatio,i=e.left,j=e.top,k=e.width,l=e.height,m=i+k,n=j+l,o=0,p=0,q=d.width,r=d.height,s=!0,t=void 0;!h&&a.shiftKey&&(h=k&&l?k/l:1),this.limited&&(o=e.minLeft,p=e.minTop,q=o+Math.min(d.width,c.width,c.left+c.width),r=p+Math.min(d.height,c.height,c.top+c.height));var u=f[Object.keys(f)[0]],v={x:u.endX-u.startX,y:u.endY-u.startY},w=function(a){switch(a){case ACTION_EAST:m+v.x>q&&(v.x=q-m);break;case ACTION_WEST:i+v.x<o&&(v.x=o-i);break;case ACTION_NORTH:j+v.y<p&&(v.y=p-j);break;case ACTION_SOUTH:n+v.y>r&&(v.y=r-n);break;default:}};switch(g){case ACTION_ALL:i+=v.x,j+=v.y;break;case ACTION_EAST:if(v.x>=0&&(m>=q||h&&(j<=p||n>=r))){s=!1;break}w(ACTION_EAST),k+=v.x,h&&(l=k/h,j-=v.x/h/2),k<0&&(g=ACTION_WEST,k=0);break;case ACTION_NORTH:if(v.y<=0&&(j<=p||h&&(i<=o||m>=q))){s=!1;break}w(ACTION_NORTH),l-=v.y,j+=v.y,h&&(k=l*h,i+=v.y*h/2),l<0&&(g=ACTION_SOUTH,l=0);break;case ACTION_WEST:if(v.x<=0&&(i<=o||h&&(j<=p||n>=r))){s=!1;break}w(ACTION_WEST),k-=v.x,i+=v.x,h&&(l=k/h,j+=v.x/h/2),k<0&&(g=ACTION_EAST,k=0);break;case ACTION_SOUTH:if(v.y>=0&&(n>=r||h&&(i<=o||m>=q))){s=!1;break}w(ACTION_SOUTH),l+=v.y,h&&(k=l*h,i-=v.y*h/2),l<0&&(g=ACTION_NORTH,l=0);break;case ACTION_NORTH_EAST:if(h){if(v.y<=0&&(j<=p||m>=q)){s=!1;break}w(ACTION_NORTH),l-=v.y,j+=v.y,k=l*h}else w(ACTION_NORTH),w(ACTION_EAST),v.x>=0?m<q?k+=v.x:v.y<=0&&j<=p&&(s=!1):k+=v.x,v.y<=0?j>p&&(l-=v.y,j+=v.y):(l-=v.y,j+=v.y);k<0&&l<0?(g=ACTION_SOUTH_WEST,l=0,k=0):k<0?(g=ACTION_NORTH_WEST,k=0):l<0&&(g=ACTION_SOUTH_EAST,l=0);break;case ACTION_NORTH_WEST:if(h){if(v.y<=0&&(j<=p||i<=o)){s=!1;break}w(ACTION_NORTH),l-=v.y,j+=v.y,k=l*h,i+=v.y*h}else w(ACTION_NORTH),w(ACTION_WEST),v.x<=0?i>o?(k-=v.x,i+=v.x):v.y<=0&&j<=p&&(s=!1):(k-=v.x,i+=v.x),v.y<=0?j>p&&(l-=v.y,j+=v.y):(l-=v.y,j+=v.y);k<0&&l<0?(g=ACTION_SOUTH_EAST,l=0,k=0):k<0?(g=ACTION_NORTH_EAST,k=0):l<0&&(g=ACTION_SOUTH_WEST,l=0);break;case ACTION_SOUTH_WEST:if(h){if(v.x<=0&&(i<=o||n>=r)){s=!1;break}w(ACTION_WEST),k-=v.x,i+=v.x,l=k/h}else w(ACTION_SOUTH),w(ACTION_WEST),v.x<=0?i>o?(k-=v.x,i+=v.x):v.y>=0&&n>=r&&(s=!1):(k-=v.x,i+=v.x),v.y>=0?n<r&&(l+=v.y):l+=v.y;k<0&&l<0?(g=ACTION_NORTH_EAST,l=0,k=0):k<0?(g=ACTION_SOUTH_EAST,k=0):l<0&&(g=ACTION_NORTH_WEST,l=0);break;case ACTION_SOUTH_EAST:if(h){if(v.x>=0&&(m>=q||n>=r)){s=!1;break}w(ACTION_EAST),k+=v.x,l=k/h}else w(ACTION_SOUTH),w(ACTION_EAST),v.x>=0?m<q?k+=v.x:v.y>=0&&n>=r&&(s=!1):k+=v.x,v.y>=0?n<r&&(l+=v.y):l+=v.y;k<0&&l<0?(g=ACTION_NORTH_WEST,l=0,k=0):k<0?(g=ACTION_SOUTH_WEST,k=0):l<0&&(g=ACTION_NORTH_EAST,l=0);break;case ACTION_MOVE:this.move(v.x,v.y),s=!1;break;case ACTION_ZOOM:this.zoom(getMaxZoomRatio(f),a),s=!1;break;case ACTION_CROP:if(!v.x||!v.y){s=!1;break}t=getOffset(this.cropper),i=u.startX-t.left,j=u.startY-t.top,k=e.minWidth,l=e.minHeight,v.x>0?g=v.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST:v.x<0&&(i-=k,g=v.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST),v.y<0&&(j-=l),this.cropped||(removeClass(this.cropBox,CLASS_HIDDEN),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break;default:}s&&(e.width=k,e.height=l,e.left=i,e.top=j,this.action=g,this.renderCropBox()),each(f,function(a){a.startX=a.endX,a.startY=a.endY})}},methods={crop:function(){return this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&addClass(this.dragBox,CLASS_MODAL),removeClass(this.cropBox,CLASS_HIDDEN)),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=extend({},this.initialImageData),this.canvasData=extend({},this.initialCanvasData),this.cropBoxData=extend({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(extend(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),removeClass(this.dragBox,CLASS_MODAL),addClass(this.cropBox,CLASS_HIDDEN)),this},replace:function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return!this.disabled&&a&&(this.isImg&&(this.element.src=a),b?(this.url=a,this.image.src=a,this.ready&&(this.image2.src=a,each(this.previews,function(b){b.getElementsByTagName("img")[0].src=a}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(a))),this},enable:function(){return this.ready&&(this.disabled=!1,removeClass(this.cropper,CLASS_DISABLED)),this},disable:function(){return this.ready&&(this.disabled=!0,addClass(this.cropper,CLASS_DISABLED)),this},destroy:function(){var a=this.element,b=this.image;return this.loaded?(this.isImg&&this.replaced&&(a.src=this.originalUrl),this.unbuild(),removeClass(a,CLASS_HIDDEN)):this.isImg?removeListener(a,EVENT_LOAD,this.onStart):b&&b.parentNode.removeChild(b),removeData(a,NAMESPACE),this},move:function(a,b){var c=this.canvasData,d=c.left,e=c.top;return this.moveTo(isUndefined(a)?a:d+Number(a),isUndefined(b)?b:e+Number(b))},moveTo:function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a,c=this.canvasData,d=!1;return a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.movable&&(isNumber(a)&&(c.left=a,d=!0),isNumber(b)&&(c.top=b,d=!0),d&&this.renderCanvas(!0)),this},zoom:function(a,b){var c=this.canvasData;return a=Number(a),a<0?a=1/(1-a):a=1+a,this.zoomTo(c.width*a/c.naturalWidth,b)},zoomTo:function(a,b){var c=this.options,d=this.canvasData,e=d.width,f=d.height,g=d.naturalWidth,h=d.naturalHeight;a=Number(a);if(a>=0&&this.ready&&!this.disabled&&c.zoomable){var i=g*a,j=h*a;if(dispatchEvent(this.element,EVENT_ZOOM,{originalEvent:b,oldRatio:e/g,ratio:i/g})===!1)return this;if(b){var k=this.pointers,l=getOffset(this.cropper),m=k&&Object.keys(k).length?getPointersCenter(k):{pageX:b.pageX,pageY:b.pageY};d.left-=(i-e)*((m.pageX-l.left-d.left)/e),d.top-=(j-f)*((m.pageY-l.top-d.top)/f)}else d.left-=(i-e)/2,d.top-=(j-f)/2;d.width=i,d.height=j,this.renderCanvas(!0)}return this},rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(a){return a=Number(a),isNumber(a)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=a%360,this.renderCanvas(!0,!0)),this},scaleX:function(a){var b=this.imageData.scaleY;return this.scale(a,isNumber(b)?b:1)},scaleY:function(a){var b=this.imageData.scaleX;return this.scale(isNumber(b)?b:1,a)},scale:function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a,c=this.imageData,d=!1;return a=Number(a),b=Number(b),this.ready&&!this.disabled&&this.options.scalable&&(isNumber(a)&&(c.scaleX=a,d=!0),isNumber(b)&&(c.scaleY=b,d=!0),d&&this.renderCanvas(!0,!0)),this},getData:function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,b=this.options,c=this.imageData,d=this.canvasData,e=this.cropBoxData,f=void 0;if(this.ready&&this.cropped){f={x:e.left-d.left,y:e.top-d.top,width:e.width,height:e.height};var g=c.width/c.naturalWidth;each(f,function(b,c){b/=g,f[c]=a?Math.round(b):b})}else f={x:0,y:0,width:0,height:0};return b.rotatable&&(f.rotate=c.rotate||0),b.scalable&&(f.scaleX=c.scaleX||1,f.scaleY=c.scaleY||1),f},setData:function(a){var b=this.options,c=this.imageData,d=this.canvasData,e={};isFunction(a)&&(a=a.call(this.element));if(this.ready&&!this.disabled&&isPlainObject(a)){var f=!1;b.rotatable&&isNumber(a.rotate)&&a.rotate!==c.rotate&&(c.rotate=a.rotate,f=!0),b.scalable&&(isNumber(a.scaleX)&&a.scaleX!==c.scaleX&&(c.scaleX=a.scaleX,f=!0),isNumber(a.scaleY)&&a.scaleY!==c.scaleY&&(c.scaleY=a.scaleY,f=!0)),f&&this.renderCanvas(!0,!0);var g=c.width/c.naturalWidth;isNumber(a.x)&&(e.left=a.x*g+d.left),isNumber(a.y)&&(e.top=a.y*g+d.top),isNumber(a.width)&&(e.width=a.width*g),isNumber(a.height)&&(e.height=a.height*g),this.setCropBoxData(e)}return this},getContainerData:function(){return this.ready?extend({},this.containerData):{}},getImageData:function(){return this.loaded?extend({},this.imageData):{}},getCanvasData:function(){var a=this.canvasData,b={};return this.ready&&each(["left","top","width","height","naturalWidth","naturalHeight"],function(c){b[c]=a[c]}),b},setCanvasData:function(a){var b=this.canvasData,c=b.aspectRatio;return isFunction(a)&&(a=a.call(this.element)),this.ready&&!this.disabled&&isPlainObject(a)&&(isNumber(a.left)&&(b.left=a.left),isNumber(a.top)&&(b.top=a.top),isNumber(a.width)?(b.width=a.width,b.height=a.width/c):isNumber(a.height)&&(b.height=a.height,b.width=a.height*c),this.renderCanvas(!0)),this},getCropBoxData:function(){var a=this.cropBoxData,b=void 0;return this.ready&&this.cropped&&(b={left:a.left,top:a.top,width:a.width,height:a.height}),b||{}},setCropBoxData:function(a){var b=this.cropBoxData,c=this.options.aspectRatio,d=void 0,e=void 0;return isFunction(a)&&(a=a.call(this.element)),this.ready&&this.cropped&&!this.disabled&&isPlainObject(a)&&(isNumber(a.left)&&(b.left=a.left),isNumber(a.top)&&(b.top=a.top),isNumber(a.width)&&a.width!==b.width&&(d=!0,b.width=a.width),isNumber(a.height)&&a.height!==b.height&&(e=!0,b.height=a.height),c&&(d?b.height=b.width/c:e&&(b.width=b.height*c)),this.renderCropBox()),this},getCroppedCanvas:function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.ready||!global.HTMLCanvasElement)return null;var b=this.canvasData,c=getSourceCanvas(this.image,this.imageData,b,a);if(!this.cropped)return c;var d=this.getData(),e=d.x,f=d.y,g=d.width,h=d.height,i=g/h,j=getContainSizes({aspectRatio:i,width:a.maxWidth||Infinity,height:a.maxHeight||Infinity}),k=getContainSizes({aspectRatio:i,width:a.minWidth||0,height:a.minHeight||0}),l=getContainSizes({aspectRatio:i,width:a.width||g,height:a.height||h}),m=l.width,n=l.height;m=Math.min(j.width,Math.max(k.width,m)),n=Math.min(j.height,Math.max(k.height,n));var o=document.createElement("canvas"),p=o.getContext("2d");o.width=normalizeDecimalNumber(m),o.height=normalizeDecimalNumber(n),p.fillStyle=a.fillColor||"transparent",p.fillRect(0,0,m,n);var q=a.imageSmoothingEnabled,r=q===undefined?!0:q,s=a.imageSmoothingQuality;p.imageSmoothingEnabled=r,s&&(p.imageSmoothingQuality=s);var t=c.width,u=c.height,v=e,w=f,x=void 0,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0;v<=-g||v>t?(v=0,x=0,z=0,B=0):v<=0?(z=-v,v=0,x=Math.min(t,g+v),B=x):v<=t&&(z=0,x=Math.min(g,t-v),B=x),x<=0||w<=-h||w>u?(w=0,y=0,A=0,C=0):w<=0?(A=-w,w=0,y=Math.min(u,h+w),C=y):w<=u&&(A=0,y=Math.min(h,u-w),C=y);var D=[v,w,x,y];if(B>0&&C>0){var E=m/g;D.push(z*E,A*E,B*E,C*E)}return p.drawImage.apply(p,[c].concat(_toConsumableArray$1(D.map(function(a){return Math.floor(normalizeDecimalNumber(a))})))),o},setAspectRatio:function(a){var b=this.options;return!this.disabled&&!isUndefined(a)&&(b.aspectRatio=Math.max(0,a)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(a){var b=this.options,c=this.dragBox,d=this.face;if(this.loaded&&!this.disabled){var e=a===DRAG_MODE_CROP,f=b.movable&&a===DRAG_MODE_MOVE;a=e||f?a:DRAG_MODE_NONE,setData(c,DATA_ACTION,a),toggleClass(c,CLASS_CROP,e),toggleClass(c,CLASS_MOVE,f),b.cropBoxMovable||(setData(d,DATA_ACTION,a),toggleClass(d,CLASS_CROP,e),toggleClass(d,CLASS_MOVE,f))}return this}},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),AnotherCropper=global.Cropper,Cropper=function(){function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,a);if(!b||!REGEXP_TAG_NAME.test(b.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=b,this.options=extend({},DEFAULTS,isPlainObject(c)&&c),this.complete=!1,this.cropped=!1,this.disabled=!1,this.isImg=!1,this.limited=!1,this.loaded=!1,this.ready=!1,this.replaced=!1,this.wheeling=!1,this.originalUrl="",this.canvasData=null,this.cropBoxData=null,this.previews=null,this.pointers={},this.init()}return _createClass(a,[{key:"init",value:function(){var a=this.element,b=a.tagName.toLowerCase(),c=void 0;if(getData(a,NAMESPACE))return;setData(a,NAMESPACE,this);if(b==="img"){this.isImg=!0,c=a.getAttribute("src")||"",this.originalUrl=c;if(!c)return;c=a.src}else b==="canvas"&&global.HTMLCanvasElement&&(c=a.toDataURL());this.load(c)}},{key:"load",value:function(a){var b=this;if(!a)return;this.url=a,this.imageData={};var c=this.element,d=this.options;if(!d.checkOrientation||!global.ArrayBuffer){this.clone();return}if(REGEXP_DATA_URL.test(a)){REGEXP_DATA_URL_JPEG.test(a)?this.read(dataURLToArrayBuffer(a)):this.clone();return}var e=new XMLHttpRequest;e.onerror=function(){b.clone()},e.onload=function(){b.read(e.response)},d.checkCrossOrigin&&isCrossOriginURL(a)&&c.crossOrigin&&(a=addTimestamp(a)),e.open("get",a),e.responseType="arraybuffer",e.withCredentials=c.crossOrigin==="use-credentials",e.send()}},{key:"read",value:function(a){var b=this.options,c=this.imageData,d=getOrientation(a),e=0,f=1,g=1;if(d>1){this.url=arrayBufferToDataURL(a,"image/jpeg");var h=parseOrientation(d);e=h.rotate,f=h.scaleX,g=h.scaleY}b.rotatable&&(c.rotate=e),b.scalable&&(c.scaleX=f,c.scaleY=g),this.clone()}},{key:"clone",value:function(){var a=this.element,b=this.url,c=void 0,d=void 0;this.options.checkCrossOrigin&&isCrossOriginURL(b)&&(c=a.crossOrigin,c?d=b:(c="anonymous",d=addTimestamp(b))),this.crossOrigin=c,this.crossOriginUrl=d;var e=document.createElement("img");c&&(e.crossOrigin=c),e.src=d||b;var f=proxy(this.start,this),g=proxy(this.stop,this);this.image=e,this.onStart=f,this.onStop=g,this.isImg?a.complete?this.start():addListener(a,EVENT_LOAD,f):(addListener(e,EVENT_LOAD,f),addListener(e,EVENT_ERROR,g),addClass(e,CLASS_HIDE),a.parentNode.insertBefore(e,a.nextSibling))}},{key:"start",value:function(a){var b=this,c=this.isImg?this.element:this.image;a&&(removeListener(c,EVENT_LOAD,this.onStart),removeListener(c,EVENT_ERROR,this.onStop)),getImageNaturalSizes(c,function(a,c){extend(b.imageData,{naturalWidth:a,naturalHeight:c,aspectRatio:a/c}),b.loaded=!0,b.build()})}},{key:"stop",value:function(){var a=this.image;removeListener(a,EVENT_LOAD,this.onStart),removeListener(a,EVENT_ERROR,this.onStop),a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){var a=this;if(!this.loaded)return;this.ready&&this.unbuild();var b=this.element,c=this.options,d=this.image,e=b.parentNode,f=document.createElement("div");f.innerHTML=TEMPLATE;var g=f.querySelector("."+NAMESPACE+"-container"),h=g.querySelector("."+NAMESPACE+"-canvas"),i=g.querySelector("."+NAMESPACE+"-drag-box"),j=g.querySelector("."+NAMESPACE+"-crop-box"),k=j.querySelector("."+NAMESPACE+"-face");this.container=e,this.cropper=g,this.canvas=h,this.dragBox=i,this.cropBox=j,this.viewBox=g.querySelector("."+NAMESPACE+"-view-box"),this.face=k,h.appendChild(d),addClass(b,CLASS_HIDDEN),e.insertBefore(g,b.nextSibling),this.isImg||removeClass(d,CLASS_HIDE),this.initPreview(),this.bind(),c.aspectRatio=Math.max(0,c.aspectRatio)||NaN,c.viewMode=Math.max(0,Math.min(3,Math.round(c.viewMode)))||0,this.cropped=c.autoCrop,c.autoCrop?c.modal&&addClass(i,CLASS_MODAL):addClass(j,CLASS_HIDDEN),c.guides||addClass(j.getElementsByClassName(NAMESPACE+"-dashed"),CLASS_HIDDEN),c.center||addClass(j.getElementsByClassName(NAMESPACE+"-center"),CLASS_HIDDEN),c.background&&addClass(g,NAMESPACE+"-bg"),c.highlight||addClass(k,CLASS_INVISIBLE),c.cropBoxMovable&&(addClass(k,CLASS_MOVE),setData(k,DATA_ACTION,ACTION_ALL)),c.cropBoxResizable||(addClass(j.getElementsByClassName(NAMESPACE+"-line"),CLASS_HIDDEN),addClass(j.getElementsByClassName(NAMESPACE+"-point"),CLASS_HIDDEN)),this.setDragMode(c.dragMode),this.render(),this.ready=!0,this.setData(c.data),this.completing=setTimeout(function(){isFunction(c.ready)&&addListener(b,EVENT_READY,c.ready,{once:!0}),dispatchEvent(b,EVENT_READY),dispatchEvent(b,EVENT_CROP,a.getData()),a.complete=!0},0)}},{key:"unbuild",value:function(){if(!this.ready)return;this.complete||clearTimeout(this.completing),this.ready=!1,this.complete=!1,this.initialImageData=null,this.initialCanvasData=null,this.initialCropBoxData=null,this.containerData=null,this.canvasData=null,this.cropBoxData=null,this.unbind(),this.resetPreview(),this.previews=null,this.viewBox=null,this.cropBox=null,this.dragBox=null,this.canvas=null,this.container=null,this.cropper.parentNode.removeChild(this.cropper),this.cropper=null}}],[{key:"noConflict",value:function(){return global.Cropper=AnotherCropper,a}},{key:"setDefaults",value:function(a){extend(DEFAULTS,isPlainObject(a)&&a)}}]),a}();extend(Cropper.prototype,render,preview,events,handlers,change,methods),module.exports=Cropper