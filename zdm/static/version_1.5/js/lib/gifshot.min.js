/*Copyrights for code authored by Yahoo Inc. is licensed under the following terms:
MIT License
Copyright  2017 Yahoo Inc.
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

!function(a,b,c,d){function e(){return v.isValid()}function f(){return v.isValid()}function g(){var a={getUserMedia:!0};return v.isValid(a)}function h(a){var b=!1;if(t.isArray(a)&&a.length){if(t.each(a,function(a,c){t.isSupported.videoCodecs[c]&&(b=!0)}),!b)return!1}else if(t.isString(a)&&a.length&&!t.isSupported.videoCodecs[a])return!1;return v.isValid({getUserMedia:!0})}function i(){function a(a,b,c){var d,e;for(l=a,m=b,n=c,o=new Array(p),d=0;p>d;d++)o[d]=new Array(4),e=o[d],e[0]=e[1]=e[2]=(d<<w+8)/p|0,R[d]=z/p|0,Q[d]=0}function b(){for(var a=[],b=new Array(p),c=0;p>c;c++)b[o[c][3]]=c;for(var d=0,e=0;p>e;e++){var f=b[e];a[d++]=o[f][0],a[d++]=o[f][1],a[d++]=o[f][2]}return a}function c(){var a,b,c,d,e,f,g,h;for(g=0,h=0,a=0;p>a;a++){for(e=o[a],c=a,d=e[1],b=a+1;p>b;b++)f=o[b],f[1]<d&&(c=b,d=f[1]);if(f=o[c],a!=c&&(b=f[0],f[0]=e[0],e[0]=b,b=f[1],f[1]=e[1],e[1]=b,b=f[2],f[2]=e[2],e[2]=b,b=f[3],f[3]=e[3],e[3]=b),d!=g){for(P[g]=h+a>>1,b=g+1;d>b;b++)P[b]=a;g=d,h=a}}for(P[g]=h+v>>1,b=g+1;256>b;b++)P[b]=v}function d(){var a,b,c,d,e,f,g,o,p,v,y,z,A,B;for(u>m&&(n=1),k=30+(n-1)/3,z=l,A=0,B=m,y=m/(3*n),v=y/x|0,o=K,f=H,g=f>>F,1>=g&&(g=0),a=0;g>a;a++)S[a]=o*((g*g-a*a)*M/(g*g));for(p=u>m?3:m%q!==0?3*q:m%r!==0?3*r:m%s!==0?3*s:3*t,a=0;y>a;)if(c=(255&z[A+0])<<w,d=(255&z[A+1])<<w,e=(255&z[A+2])<<w,b=j(c,d,e),i(o,b,c,d,e),0!==g&&h(g,b,c,d,e),A+=p,A>=B&&(A-=m),a++,0===v&&(v=1),a%v===0)for(o-=o/k,f-=f/I,g=f>>F,1>=g&&(g=0),b=0;g>b;b++)S[b]=o*((g*g-b*b)*M/(g*g))}function e(a,b,c){var d,e,f,g,h,i,j;for(h=1e3,j=-1,d=P[b],e=d-1;p>d||e>=0;)p>d&&(i=o[d],f=i[1]-b,f>=h?d=p:(d++,0>f&&(f=-f),g=i[0]-a,0>g&&(g=-g),f+=g,h>f&&(g=i[2]-c,0>g&&(g=-g),f+=g,h>f&&(h=f,j=i[3])))),e>=0&&(i=o[e],f=b-i[1],f>=h?e=-1:(e--,0>f&&(f=-f),g=i[0]-a,0>g&&(g=-g),f+=g,h>f&&(g=i[2]-c,0>g&&(g=-g),f+=g,h>f&&(h=f,j=i[3]))));return j}function f(){return d(),g(),c(),b()}function g(){var a;for(a=0;p>a;a++)o[a][0]>>=w,o[a][1]>>=w,o[a][2]>>=w,o[a][3]=a}function h(a,b,c,d,e){var f,g,h,i,j,k,l;for(h=b-a,-1>h&&(h=-1),i=b+a,i>p&&(i=p),f=b+1,g=b-1,k=1;i>f||g>h;){if(j=S[k++],i>f){l=o[f++];try{l[0]-=j*(l[0]-c)/O|0,l[1]-=j*(l[1]-d)/O|0,l[2]-=j*(l[2]-e)/O|0}catch(m){}}if(g>h){l=o[g--];try{l[0]-=j*(l[0]-c)/O|0,l[1]-=j*(l[1]-d)/O|0,l[2]-=j*(l[2]-e)/O|0}catch(m){}}}}function i(a,b,c,d,e){var f=o[b],g=a/K;f[0]-=g*(f[0]-c)|0,f[1]-=g*(f[1]-d)|0,f[2]-=g*(f[2]-e)|0}function j(a,b,c){var d,e,f,g,h,i,j,k,l,m;for(k=2147483647,l=k,i=-1,j=i,d=0;p>d;d++)m=o[d],e=m[0]-a,0>e&&(e=-e),f=m[1]-b,0>f&&(f=-f),e+=f,f=m[2]-c,0>f&&(f=-f),e+=f,k>e&&(k=e,i=d),g=e-(Q[d]>>y-w),l>g&&(l=g,j=d),h=R[d]>>B,R[d]-=h,Q[d]+=h<<A;return R[i]+=C,Q[i]-=D,j}var k,l,m,n,o,p=256,q=499,r=491,s=487,t=503,u=3*t,v=p-1,w=4,x=100,y=16,z=1<<y,A=10,B=10,C=z>>B,D=z<<A-B,E=p>>3,F=6,G=1<<F,H=E*G,I=30,J=10,K=1<<J,L=8,M=1<<L,N=J+L,O=1<<N,P=[],Q=[],R=[],S=[];a.apply(this,arguments);var T={};return T.map=e,T.process=f,T}function j(){var a=this;try{a.onmessage=function(a){var b,d=a.data||{};d.gifshot&&(b=c.run(d),postMessage(b))}}catch(b){}var c={dataToRGB:function(a,b,c){for(var d=b*c*4,e=0,f=[];d>e;)f.push(a[e++]),f.push(a[e++]),f.push(a[e++]),e++;return f},componentizedPaletteToArray:function(a){a=a||[];for(var b=[],c=0;c<a.length;c+=3){var d=a[c],e=a[c+1],f=a[c+2];b.push(d<<16|e<<8|f)}return b},processFrameWithQuantizer:function(a,b,c,d){for(var e=this.dataToRGB(a,b,c),f=new i(e,e.length,d),g=f.process(),h=new Uint32Array(this.componentizedPaletteToArray(g)),j=b*c,k=new Uint8Array(j),l=0,m=0;j>m;m++){var n=e[l++],o=e[l++],p=e[l++];k[m]=f.map(n,o,p)}return{pixels:k,palette:h}},run:function(a){a=a||{};var b=a,c=b.height,d=(b.palette,b.sampleInterval),e=b.width,f=a.data;return this.processFrameWithQuantizer(f,e,c,d)}};return c}function k(a,b,c,e){function f(a){var b=a.length;if(2>b||b>256||b&b-1)throw"Invalid code/color length, must be power of 2 and 2 .. 256.";return b}function g(a,b,c,e){function f(c){for(;n>=c;)a[b++]=255&o,o>>=8,n-=8,b===h+256&&(a[h]=255,h=b++)}function g(a){o|=a<<n,n+=m,f(8)}a[b++]=c;var h=b++,i=1<<c,j=i-1,k=i+1,l=k+1,m=c+1,n=0,o=0,p=e[0]&j,q={};g(i);for(var r=1,s=e.length;s>r;++r){var t=e[r]&j,u=p<<8|t,v=q[u];if(v===d){for(o|=p<<n,n+=m;n>=8;)a[b++]=255&o,o>>=8,n-=8,b===h+256&&(a[h]=255,h=b++);4096===l?(g(i),l=k+1,m=c+1,q={}):(l>=1<<m&&++m,q[u]=l++),p=t}else p=v}return g(p),g(k),f(1),h+1===b?a[h]=0:(a[h]=b-h-1,a[b++]=0),b}var h=0;e=e===d?{}:e;var i=e.loop===d?null:e.loop,j=e.palette===d?null:e.palette;if(0>=b||0>=c||b>65535||c>65535)throw"Width/Height invalid.";a[h++]=71,a[h++]=73,a[h++]=70,a[h++]=56,a[h++]=57,a[h++]=97;var k=0,l=0;if(a[h++]=255&b,a[h++]=b>>8&255,a[h++]=255&c,a[h++]=c>>8&255,a[h++]=(null!==j?128:0)|k,a[h++]=l,a[h++]=0,null!==i){if(0>i||i>65535)throw"Loop count invalid.";a[h++]=33,a[h++]=255,a[h++]=11,a[h++]=78,a[h++]=69,a[h++]=84,a[h++]=83,a[h++]=67,a[h++]=65,a[h++]=80,a[h++]=69,a[h++]=50,a[h++]=46,a[h++]=48,a[h++]=3,a[h++]=1,a[h++]=255&i,a[h++]=i>>8&255,a[h++]=0}var m=!1;this.addFrame=function(b,c,e,i,k,l){if(m===!0&&(--h,m=!1),l=l===d?{}:l,0>b||0>c||b>65535||c>65535)throw"x/y invalid.";if(0>=e||0>=i||e>65535||i>65535)throw"Width/Height invalid.";if(k.length<e*i)throw"Not enough pixels for the frame size.";var n=!0,o=l.palette;if((o===d||null===o)&&(n=!1,o=j),o===d||null===o)throw"Must supply either a local or global palette.";for(var p=f(o),q=0;p>>=1;)++q;p=1<<q;var r=l.delay===d?0:l.delay,s=l.disposal===d?0:l.disposal;if(0>s||s>3)throw"Disposal out of range.";var t=!1,u=0;if(l.transparent!==d&&null!==l.transparent&&(t=!0,u=l.transparent,0>u||u>=p))throw"Transparent color index.";if((0!==s||t||0!==r)&&(a[h++]=33,a[h++]=249,a[h++]=4,a[h++]=s<<2|(t===!0?1:0),a[h++]=255&r,a[h++]=r>>8&255,a[h++]=u,a[h++]=0),a[h++]=44,a[h++]=255&b,a[h++]=b>>8&255,a[h++]=255&c,a[h++]=c>>8&255,a[h++]=255&e,a[h++]=e>>8&255,a[h++]=255&i,a[h++]=i>>8&255,a[h++]=n===!0?128|q-1:0,n===!0)for(var v=0,w=o.length;w>v;++v){var x=o[v];a[h++]=x>>16&255,a[h++]=x>>8&255,a[h++]=255&x}h=g(a,h,2>q?2:q,k)},this.end=function(){return m===!1&&(a[h++]=59,m=!0),h}}function l(a,b){a.getBase64GIF(function(a){b({error:!1,errorCode:"",errorMsg:"",image:a})})}function m(){function a(){t.each(k,function(a,b){b&&(b.text?o.addFrame(b.img,g,b.text):o.addFrame(b,g))}),l(o,e)}var c=arguments.length>0&&arguments[0]!==d?arguments[0]:{},e=c.callback,f=c.images,g=c.options,h=c.imagesLength,i={getUserMedia:!0,"window.URL":!0},j=v.validate(i),k=[],m=0,n=void 0,o=void 0;return j.error?e(j):(o=new B(g),t.each(f,function(c,d){var f=d;d.src&&(f=f.src),t.isElement(f)?(g.crossOrigin&&(f.crossOrigin=g.crossOrigin),k[c]=f,m+=1,m===h&&a()):t.isString(f)&&(n=new Image,g.crossOrigin&&(n.crossOrigin=g.crossOrigin),function(b){d.text&&(b.text=d.text),b.onerror=function(){var a=void 0;return--h,0===h?(a={},a.error="None of the requested images was capable of being retrieved",e(a)):void 0},b.onload=function(){k[c]=d.text?{img:b,text:b.text}:b,m+=1,m===h&&a(),t.removeElement(b)},b.src=f}(n),t.setCSSAttr(n,{position:"fixed",opacity:"0"}),b.body.appendChild(n))}),void 0)}function n(a){a=t.isObject(a)?a:{},E.stopVideoStreaming(a)}function o(a,c){var d=a.options||{},e=d.images,f=d.video,g=Number(d.gifWidth),h=Number(d.gifHeight),i=(Number(d.numFrames),a.cameraStream),j=a.videoElement,k=a.videoWidth,l=a.videoHeight,m=D.getCropDimensions({videoWidth:k,videoHeight:l,gifHeight:h,gifWidth:g}),o=c;d.crop=m,d.videoElement=j,d.videoWidth=k,d.videoHeight=l,d.cameraStream=i,t.isElement(j)&&(j.width=g+m.width,j.height=h+m.height,d.webcamVideoElement||(t.setCSSAttr(j,{position:"fixed",opacity:"0"}),b.body.appendChild(j)),j.play(),D.getGIF(d,function(a){e&&e.length||f&&f.length||n(a),o(a)}))}function p(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{},b=a.callback,c=a.existingVideo,e=a.options,f={getUserMedia:!0,"window.URL":!0},g=v.validate(f),h=void 0,i=void 0;if(g.error)return b(g);if(t.isElement(c)&&c.src){if(i=c.src,h=t.getExtension(i),!t.isSupported.videoCodecs[h])return b(v.messages.videoCodecs)}else t.isArray(c)&&t.each(c,function(a,b){return h=b instanceof Blob?b.type.substr(b.type.lastIndexOf("/")+1,b.length):b.substr(b.lastIndexOf(".")+1,b.length),t.isSupported.videoCodecs[h]?(c=b,!1):void 0});E.startStreaming({completed:function(a){a.options=e||{},o(a,b)},existingVideo:c,crossOrigin:e.crossOrigin,options:e})}function q(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{},b=a.callback,c=a.lastCameraStream,e=a.options,g=a.webcamVideoElement;return f()?e.savedRenderingContexts.length?(D.getGIF(e,function(a){b(a)}),void 0):(E.startVideoStreaming(function(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{};a.options=e||{},o(a,b)},{lastCameraStream:c,callback:b,webcamVideoElement:g,crossOrigin:e.crossOrigin}),void 0):b(v.validate())}function r(a,b){if(b=t.isFunction(a)?a:b,a=t.isObject(a)?a:{},t.isFunction(b)){var c=t.mergeOptions(y,a)||{},d=a.cameraStream,e=c.images,f=e?e.length:0,g=c.video,h=c.webcamVideoElement;c=t.mergeOptions(c,{gifWidth:Math.floor(c.gifWidth),gifHeight:Math.floor(c.gifHeight)}),f?m({images:e,imagesLength:f,callback:b,options:c}):g?p({existingVideo:g,callback:b,options:c}):q({lastCameraStream:d,callback:b,webcamVideoElement:h,options:c})}}function s(a,b){if(b=t.isFunction(a)?a:b,a=t.isObject(a)?a:{},t.isFunction(b)){var c=t.mergeOptions(y,a),d=t.mergeOptions(c,{interval:.1,numFrames:1,gifWidth:Math.floor(c.gifWidth),gifHeight:Math.floor(c.gifHeight)});r(d,b)}}var t={URL:a.URL||a.webkitURL||a.mozURL||a.msURL,getUserMedia:function(){var a=c.getUserMedia||c.webkitGetUserMedia||c.mozGetUserMedia||c.msGetUserMedia;return a?a.bind(c):a}(),requestAnimFrame:a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame,requestTimeout:function(a,b){if(a=a||t.noop,b=b||0,!t.requestAnimFrame)return setTimeout(a,b);var c=(new Date).getTime(),d=new Object,e=t.requestAnimFrame,f=function g(){var f=(new Date).getTime(),h=f-c;h>=b?a.call():d.value=e(g)};return d.value=e(f),d},Blob:a.Blob||a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder||a.MSBlobBuilder,btoa:function(){var b=a.btoa||function(a){for(var b="",c=0,d=a.length,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=void 0,l=void 0;d>c;)f=a.charCodeAt(c++),g=a.charCodeAt(c++),h=a.charCodeAt(c++),i=f>>2,j=(3&f)<<4|g>>4,k=(15&g)<<2|h>>6,l=63&h,isNaN(g)?k=l=64:isNaN(h)&&(l=64),b=b+e.charAt(i)+e.charAt(j)+e.charAt(k)+e.charAt(l);return b};return b?b.bind(a):t.noop}(),isObject:function(a){return a&&"[object Object]"===Object.prototype.toString.call(a)},isEmptyObject:function(a){return t.isObject(a)&&!Object.keys(a).length},isArray:function(a){return a&&Array.isArray(a)},isFunction:function(a){return a&&"function"==typeof a},isElement:function(a){return a&&1===a.nodeType},isString:function(a){return"string"==typeof a||"[object String]"===Object.prototype.toString.call(a)},isSupported:{canvas:function(){var a=b.createElement("canvas");return a&&a.getContext&&a.getContext("2d")},webworkers:function(){return a.Worker},blob:function(){return t.Blob},Uint8Array:function(){return a.Uint8Array},Uint32Array:function(){return a.Uint32Array},videoCodecs:function(){var a=b.createElement("video"),c={mp4:!1,h264:!1,ogv:!1,ogg:!1,webm:!1};try{a&&a.canPlayType&&(c.mp4=""!==a.canPlayType('video/mp4; codecs="mp4v.20.8"'),c.h264=""!==(a.canPlayType('video/mp4; codecs="avc1.42E01E"')||a.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')),c.ogv=""!==a.canPlayType('video/ogg; codecs="theora"'),c.ogg=""!==a.canPlayType('video/ogg; codecs="theora"'),c.webm=-1!==a.canPlayType('video/webm; codecs="vp8, vorbis"'))}catch(d){}return c}()},noop:function(){},each:function(a,b){var c=void 0,d=void 0;if(t.isArray(a))for(c=-1,d=a.length;++c<d&&b(c,a[c])!==!1;);else if(t.isObject(a))for(c in a)if(a.hasOwnProperty(c)&&b(c,a[c])===!1)break},mergeOptions:function(a,b){if(t.isObject(a)&&t.isObject(b)&&Object.keys){var c={};return t.each(a,function(b){c[b]=a[b]}),t.each(b,function(d){var e=b[d];c[d]=t.isObject(e)?a[d]?t.mergeOptions(a[d],e):e:e}),c}},setCSSAttr:function(a,b,c){t.isElement(a)&&(t.isString(b)&&t.isString(c)?a.style[b]=c:t.isObject(b)&&t.each(b,function(b,c){a.style[b]=c}))},removeElement:function(a){t.isElement(a)&&a.parentNode&&a.parentNode.removeChild(a)},createWebWorker:function(a){if(!t.isString(a))return{};try{var b=new t.Blob([a],{type:"text/javascript"}),c=t.URL.createObjectURL(b),d=new Worker(c);return{objectUrl:c,worker:d}}catch(e){return""+e}},getExtension:function(a){return a.substr(a.lastIndexOf(".")+1,a.length)},getFontSize:function(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{};if(!b.body||a.resizeFont===!1)return a.fontSize;var c=a.text,e=a.gifWidth,f=parseInt(a.fontSize,10),g=parseInt(a.minFontSize,10),h=b.createElement("div"),i=b.createElement("span");for(h.setAttribute("width",e),h.appendChild(i),i.innerHTML=c,i.style.fontSize=f+"px",i.style.textIndent="-9999px",i.style.visibility="hidden",b.body.appendChild(i);i.offsetWidth>e&&f>=g;)i.style.fontSize=--f+"px";return b.body.removeChild(i),f+"px"},webWorkerError:!1},u=Object.freeze({"default":t}),v={validate:function(a){a=t.isObject(a)?a:{};var b={};return t.each(v.validators,function(c,d){var e=d.errorCode;return a[e]||d.condition?void 0:(b=d,b.error=!0,!1)}),delete b.condition,b},isValid:function G(a){var b=v.validate(a),G=b.error!==!0?!0:!1;return G},validators:[{condition:t.isFunction(t.getUserMedia),errorCode:"getUserMedia",errorMsg:"The getUserMedia API is not supported in your browser"},{condition:t.isSupported.canvas(),errorCode:"canvas",errorMsg:"Canvas elements are not supported in your browser"},{condition:t.isSupported.webworkers(),errorCode:"webworkers",errorMsg:"The Web Workers API is not supported in your browser"},{condition:t.isFunction(t.URL),errorCode:"window.URL",errorMsg:"The window.URL API is not supported in your browser"},{condition:t.isSupported.blob(),errorCode:"window.Blob",errorMsg:"The window.Blob File API is not supported in your browser"},{condition:t.isSupported.Uint8Array(),errorCode:"window.Uint8Array",errorMsg:"The window.Uint8Array function constructor is not supported in your browser"},{condition:t.isSupported.Uint32Array(),errorCode:"window.Uint32Array",errorMsg:"The window.Uint32Array function constructor is not supported in your browser"}],messages:{videoCodecs:{errorCode:"videocodec",errorMsg:"The video codec you are trying to use is not supported in your browser"}}},w=Object.freeze({"default":v}),x=function(){},y={sampleInterval:10,numWorkers:2,filter:"",gifWidth:200,gifHeight:200,interval:.1,numFrames:10,frameDuration:1,keepCameraOn:!1,images:[],video:null,webcamVideoElement:null,cameraStream:null,text:"",fontWeight:"normal",fontSize:"16px",minFontSize:"10px",resizeFont:!1,fontFamily:"sans-serif",fontColor:"#ffffff",textAlign:"center",textBaseline:"bottom",textXCoordinate:null,textYCoordinate:null,progressCallback:x,completeCallback:x,saveRenderingContexts:!1,savedRenderingContexts:[],crossOrigin:"Anonymous"},z=Object.freeze({"default":y}),A=function(){},B=function(a){this.canvas=null,this.ctx=null,this.repeat=0,this.frames=[],this.numRenderedFrames=0,this.onRenderCompleteCallback=A,this.onRenderProgressCallback=A,this.workers=[],this.availableWorkers=[],this.generatingGIF=!1,this.options=a,this.initializeWebWorkers(a)};B.prototype={workerMethods:j(),initializeWebWorkers:function(a){var c=this,d=i.toString()+"("+j.toString()+"());",e=void 0,f=void 0,g=void 0,h=void 0,k=-1,l="";for(h=a.numWorkers;++k<h;)e=t.createWebWorker(d),t.isObject(e)?(f=e.objectUrl,g=e.worker,c.workers.push({worker:g,objectUrl:f}),c.availableWorkers.push(g)):(l=e,t.webWorkerError=!!e);this.workerError=l,this.canvas=b.createElement("canvas"),this.canvas.width=a.gifWidth,this.canvas.height=a.gifHeight,this.ctx=this.canvas.getContext("2d"),this.frames=[]},getWorker:function(){return this.availableWorkers.pop()},freeWorker:function(a){this.availableWorkers.push(a)},byteMap:function(){for(var a=[],b=0;256>b;b++)a[b]=String.fromCharCode(b);return a}(),bufferToString:function(a){for(var b=a.length,c="",d=-1;++d<b;)c+=this.byteMap[a[d]];return c},onFrameFinished:function(a){var b=this,c=b.frames,d=b.options,e=!!(d.images||[]).length,f=c.every(function(a){return!a.beingProcessed&&a.done});b.numRenderedFrames++,e&&a(b.numRenderedFrames/c.length),b.onRenderProgressCallback(.75*b.numRenderedFrames/c.length),f?b.generatingGIF||b.generateGIF(c,b.onRenderCompleteCallback):t.requestTimeout(function(){b.processNextFrame()},1)},processFrame:function(a){var b=this,c=(this.options,this.options),e=c.progressCallback,f=c.sampleInterval,g=this.frames,h=void 0,i=void 0,j=function(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{},c=a.data;delete h.data,h.pixels=Array.prototype.slice.call(c.pixels),h.palette=Array.prototype.slice.call(c.palette),h.done=!0,h.beingProcessed=!1,b.freeWorker(i),b.onFrameFinished(e)};return h=g[a],h.beingProcessed||h.done?(this.onFrameFinished(),void 0):(h.sampleInterval=f,h.beingProcessed=!0,h.gifshot=!0,i=this.getWorker(),i?(i.onmessage=j,i.postMessage(h)):j({data:b.workerMethods.run(h)}),void 0)},startRendering:function(a){this.onRenderCompleteCallback=a;for(var b=0;b<this.options.numWorkers&&b<this.frames.length;b++)this.processFrame(b)},processNextFrame:function(){for(var a=-1,b=0;b<this.frames.length;b++){var c=this.frames[b];if(!c.done&&!c.beingProcessed){a=b;break}}a>=0&&this.processFrame(a)},generateGIF:function(a,b){var c=[],d={loop:this.repeat},e=this.options,f=e.interval,g=e.frameDuration,h=e.images,i=!!h.length,j=e.gifHeight,l=e.gifWidth,m=new k(c,l,j,d),n=this.onRenderProgressCallback,o=i?100*f:0,p=void 0,q=void 0;this.generatingGIF=!0,t.each(a,function(b,c){var d=c.palette;n(.75+.25*c.position*1/a.length);for(var e=0;g>e;e++)m.addFrame(0,0,l,j,c.pixels,{palette:d,delay:o})}),m.end(),n(1),this.frames=[],this.generatingGIF=!1,t.isFunction(b)&&(p=this.bufferToString(c),q="data:image/gif;base64,"+t.btoa(p),b(q))},setRepeat:function(a){this.repeat=a},addFrame:function(a,b){b=t.isObject(b)?b:{};var c=this,d=c.ctx,e=c.options,f=e.gifWidth,g=e.gifHeight,h=t.getFontSize(b),i=b,j=i.filter,k=i.fontColor,l=i.fontFamily,m=i.fontWeight,n=(i.gifHeight,i.gifWidth,i.text),o=i.textAlign,p=i.textBaseline,q=b.textXCoordinate?b.textXCoordinate:"left"===o?1:"right"===o?f:f/2,r=b.textYCoordinate?b.textYCoordinate:"top"===p?1:"center"===p?g/2:g,s=m+" "+h+" "+l,u=void 0;try{d.filter=j,d.drawImage(a,0,0,f,g),n&&(d.font=s,d.fillStyle=k,d.textAlign=o,d.textBaseline=p,d.fillText(n,q,r)),u=d.getImageData(0,0,f,g),c.addFrameImageData(u)}catch(v){return""+v}},addFrameImageData:function(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{},b=this.frames,c=a.data;this.frames.push({data:c,width:a.width,height:a.height,palette:null,dithering:null,done:!1,beingProcessed:!1,position:b.length})},onRenderProgress:function(a){this.onRenderProgressCallback=a},isRendering:function(){return this.generatingGIF},getBase64GIF:function(a){var b=this,c=function(c){b.destroyWorkers(),t.requestTimeout(function(){a(c)},0)};b.startRendering(c)},destroyWorkers:function(){if(!this.workerError){var a=this.workers;t.each(a,function(a,b){var c=b.worker,d=b.objectUrl;c.terminate(),t.URL.revokeObjectURL(d)})}}};var C=function(){},D={getGIF:function(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{},c=arguments[1];c=t.isFunction(c)?c:C;var e=b.createElement("canvas"),f=void 0,g=a.images,h=!!g.length,i=a.cameraStream,j=a.crop,k=a.filter,l=a.fontColor,m=a.fontFamily,n=a.fontWeight,o=a.keepCameraOn,p=(a.numWorkers,a.progressCallback),q=a.saveRenderingContexts,r=a.savedRenderingContexts,s=a.text,u=a.textAlign,v=a.textBaseline,w=a.videoElement,x=a.videoHeight,y=a.videoWidth,z=a.webcamVideoElement,A=Number(a.gifWidth),D=Number(a.gifHeight),E=Number(a.interval),F=(Number(a.sampleInterval),h?0:1e3*E),G=[],H=r.length?r.length:a.numFrames,I=H,J=new B(a),K=t.getFontSize(a),L=a.textXCoordinate?a.textXCoordinate:"left"===u?1:"right"===u?A:A/2,M=a.textYCoordinate?a.textYCoordinate:"top"===v?1:"center"===v?D/2:D,N=n+" "+K+" "+m,O=j?Math.floor(j.scaledWidth/2):0,P=j?y-j.scaledWidth:0,Q=j?Math.floor(j.scaledHeight/2):0,R=j?x-j.scaledHeight:0,S=function T(){function a(){try{P>y&&(P=y),R>x&&(R=x),0>O&&(O=0),0>Q&&(Q=0),f.filter=k,f.drawImage(w,O,Q,P,R,0,0,A,D),b()}catch(c){if("NS_ERROR_NOT_AVAILABLE"!==c.name)throw c;t.requestTimeout(a,100)}}function b(){var a=void 0;q&&G.push(f.getImageData(0,0,A,D)),s&&(f.font=N,f.fillStyle=l,f.textAlign=u,f.textBaseline=v,f.fillText(s,L,M)),a=f.getImageData(0,0,A,D),J.addFrameImageData(a),I=d,p((H-I)/H),d>0&&t.requestTimeout(T,F),I||J.getBase64GIF(function(a){c({error:!1,errorCode:"",errorMsg:"",image:a,cameraStream:i,videoElement:w,webcamVideoElement:z,savedRenderingContexts:G,keepCameraOn:o})})}var d=I-1;r.length?(f.putImageData(r[H-I],0,0),b()):a()};H=H!==d?H:10,E=E!==d?E:.1,e.width=A,e.height=D,f=e.getContext("2d"),function U(){return r.length||0!==w.currentTime?(S(),void 0):(t.requestTimeout(U,100),void 0)}()},getCropDimensions:function(){var a=arguments.length>0&&arguments[0]!==d?arguments[0]:{},b=a.videoWidth,c=a.videoHeight,e=a.gifWidth,f=a.gifHeight,g={width:0,height:0,scaledWidth:0,scaledHeight:0};return b>c?(g.width=Math.round(b*(f/c))-e,g.scaledWidth=Math.round(g.width*(c/f))):(g.height=Math.round(c*(e/b))-f,g.scaledHeight=Math.round(g.height*(b/e))),g}},E={loadedData:!1,defaultVideoDimensions:{width:640,height:480},findVideoSize:function H(a){H.attempts=H.attempts||0;var b=a.cameraStream,c=a.completedCallback,d=a.videoElement;d&&(d.videoWidth>0&&d.videoHeight>0?(d.removeEventListener("loadeddata",E.findVideoSize),c({videoElement:d,cameraStream:b,videoWidth:d.videoWidth,videoHeight:d.videoHeight})):H.attempts<10?(H.attempts+=1,t.requestTimeout(function(){E.findVideoSize(a)},400)):c({videoElement:d,cameraStream:b,videoWidth:E.defaultVideoDimensions.width,videoHeight:E.defaultVideoDimensions.height}))},onStreamingTimeout:function(a){t.isFunction(a)&&a({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - Timed out while trying to start streaming",image:null,cameraStream:{}})},stream:function(a){var b=t.isArray(a.existingVideo)?a.existingVideo[0]:a.existingVideo,c=a.cameraStream,d=a.completedCallback,e=a.streamedCallback,f=a.videoElement;if(t.isFunction(e)&&e(),b){if(t.isString(b))f.src=b,f.innerHTML='<source src="'+b+'" type="video/'+t.getExtension(b)+'" />';else if(b instanceof Blob){try{f.src=t.URL.createObjectURL(b)}catch(g){}f.innerHTML='<source src="'+b+'" type="'+b.type+'" />'}}else if(f.mozSrcObject)f.mozSrcObject=c;else if(t.URL)try{f.srcObject=c,f.src=t.URL.createObjectURL(c)}catch(g){f.srcObject=c}f.play(),t.requestTimeout(function h(){h.count=h.count||0,E.loadedData===!0?(E.findVideoSize({videoElement:f,cameraStream:c,completedCallback:d}),E.loadedData=!1):(h.count+=1,h.count>10?E.findVideoSize({videoElement:f,cameraStream:c,completedCallback:d}):h())},0)},startStreaming:function(a){var c=t.isFunction(a.error)?a.error:t.noop,d=t.isFunction(a.streamed)?a.streamed:t.noop,e=t.isFunction(a.completed)?a.completed:t.noop,f=a.crossOrigin,g=a.existingVideo,h=a.lastCameraStream,i=a.options,j=a.webcamVideoElement,k=t.isElement(g)?g:j?j:b.createElement("video");f&&(k.crossOrigin=i.crossOrigin),k.autoplay=!0,k.loop=!0,k.muted=!0,k.addEventListener("loadeddata",function(){E.loadedData=!0,i.offset&&(k.currentTime=i.offset)}),g?E.stream({videoElement:k,existingVideo:g,completedCallback:e}):h?E.stream({videoElement:k,cameraStream:h,streamedCallback:d,completedCallback:e}):t.getUserMedia({video:!0},function(a){E.stream({videoElement:k,cameraStream:a,streamedCallback:d,completedCallback:e})},c)},startVideoStreaming:function(a){var b=arguments.length>1&&arguments[1]!==d?arguments[1]:{},c=b.timeout!==d?b.timeout:0,e=b.callback,f=b.webcamVideoElement,g=void 0;c>0&&(g=t.requestTimeout(function(){E.onStreamingTimeout(e)},1e4)),E.startStreaming({error:function(){e({error:!0,errorCode:"getUserMedia",errorMsg:"There was an issue with the getUserMedia API - the user probably denied permission",image:null,cameraStream:{}})},streamed:function(){clearTimeout(g)},completed:function(){var b=arguments.length>0&&arguments[0]!==d?arguments[0]:{},c=b.cameraStream,e=b.videoElement,f=b.videoHeight,g=b.videoWidth;a({cameraStream:c,videoElement:e,videoHeight:f,videoWidth:g})},lastCameraStream:b.lastCameraStream,webcamVideoElement:f,crossOrigin:b.crossOrigin,options:b})},stopVideoStreaming:function(a){a=t.isObject(a)?a:{};var b=a,c=b.keepCameraOn,d=b.videoElement,e=b.webcamVideoElement,f=a.cameraStream||{},g=f.getTracks?f.getTracks()||[]:[],h=!!g.length,i=g[0];!c&&h&&t.isFunction(i.stop)&&i.stop(),t.isElement(d)&&!e&&(d.pause(),t.isFunction(t.URL.revokeObjectURL)&&!t.webWorkerError&&d.src&&t.URL.revokeObjectURL(d.src),t.removeElement(d))}},F={utils:u,error:w,defaultOptions:z,createGIF:r,takeSnapShot:s,stopVideoStreaming:n,isSupported:e,isWebCamGIFSupported:f,isExistingVideoGIFSupported:h,isExistingImagesGIFSupported:g,VERSION:"0.4.4"};"function"==typeof define&&define.amd?define([],function(){return F}):"undefined"!=typeof exports?module.exports=F:a.gifshot=F}("undefined"!=typeof window?window:{},"undefined"!=typeof document?document:{createElement:function(){}},"undefined"!=typeof window?window.navigator:{})