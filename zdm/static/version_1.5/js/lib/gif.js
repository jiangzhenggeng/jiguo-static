(function(a){if(typeof exports=="object"&&typeof module!="undefined")module.exports=a();else if(typeof define=="function"&&define.amd)define([],a);else{var b;typeof window!="undefined"?b=window:typeof global!="undefined"?b=global:typeof self!="undefined"?b=self:b=this,b.GIF=a()}})(function(){var a,b,c;return function d(a,b,c){function e(g,h){if(!b[g]){if(!a[g]){var i=typeof require=="function"&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=b[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,d,a,b,c)}return b[g].exports}var f=typeof require=="function"&&require;for(var g=0;g<c.length;g++)e(c[g]);return e}({1:[function(a,b,c){function d(){this._events=this._events||{},this._maxListeners=this._maxListeners||undefined}function e(a){return typeof a=="function"}function f(a){return typeof a=="number"}function g(a){return typeof a=="object"&&a!==null}function h(a){return a===void 0}b.exports=d,d.EventEmitter=d,d.prototype._events=undefined,d.prototype._maxListeners=undefined,d.defaultMaxListeners=10,d.prototype.setMaxListeners=function(a){if(!f(a)||a<0||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,i,j;this._events||(this._events={});if(a==="error")if(!this._events.error||g(this._events.error)&&!this._events.error.length){b=arguments[1];if(b instanceof Error)throw b;var k=new Error('Uncaught, unspecified "error" event. ('+b+")");throw k.context=b,k}c=this._events[a];if(h(c))return!1;if(e(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),c.apply(this,f)}else if(g(c)){f=Array.prototype.slice.call(arguments,1),j=c.slice(),d=j.length;for(i=0;i<d;i++)j[i].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e(b.listener)?b.listener:b),this._events[a]?g(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,g(this._events[a])&&!this._events[a].warned&&(h(this._maxListeners)?c=d.defaultMaxListeners:c=this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),typeof console.trace=="function"&&console.trace())),this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,h;if(!e(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;c=this._events[a],f=c.length,d=-1;if(c===b||e(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(g(c)){for(h=f;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){d=h;break}if(d<0)return this;c.length===1?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[a]&&delete this._events[a],this;if(arguments.length===0){for(b in this._events){if(b==="removeListener")continue;this.removeAllListeners(b)}return this.removeAllListeners("removeListener"),this._events={},this}c=this._events[a];if(e(c))this.removeListener(a,c);else if(c)while(c.length)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return!this._events||!this._events[a]?b=[]:e(this._events[a])?b=[this._events[a]]:b=this._events[a].slice(),b},d.prototype.listenerCount=function(a){if(this._events){var b=this._events[a];if(e(b))return 1;if(b)return b.length}return 0},d.listenerCount=function(a,b){return a.listenerCount(b)}},{}],2:[function(a,b,c){var d,e,f,g,h;h=navigator.userAgent.toLowerCase(),g=navigator.platform.toLowerCase(),d=h.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],f=d[1]==="ie"&&document.documentMode,e={name:d[1]==="version"?d[3]:d[1],version:f||parseFloat(d[1]==="opera"&&d[4]?d[4]:d[2]),platform:{name:h.match(/ip(?:ad|od|hone)/)?"ios":(h.match(/(?:webos|android)/)||g.match(/mac|win|linux/)||["other"])[0]}},e[e.name]=!0,e[e.name+parseInt(e.version,10)]=!0,e.platform[e.platform.name]=!0,b.exports=e},{}],3:[function(a,b,c){var d,e,f,g=function(a,b){function c(){this.constructor=a}for(var d in b)h.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},h={}.hasOwnProperty,i=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},j=[].slice;d=a("events").EventEmitter,f=a("./browser.coffee"),e=function(a){function b(a){var b,d,e;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(a);for(d in c)e=c[d],(b=this.options)[d]==null&&(b[d]=e)}var c,d;g(b,a);var e=function(){var a=document.scripts,b=a[a.length-1],c=b.src;return c.substring(0,c.lastIndexOf("/")+1)}();return c={workerScript:e+"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},d={delay:500,copy:!1},b.prototype.setOption=function(a,b){this.options[a]=b;if(this._canvas!=null&&(a==="width"||a==="height"))return this._canvas[a]=b},b.prototype.setOptions=function(a){var b,c,d;c=[];for(b in a){if(!h.call(a,b))continue;d=a[b],c.push(this.setOption(b,d))}return c},b.prototype.addFrame=function(a,b){var c,e;b==null&&(b={}),c={},c.transparent=this.options.transparent;for(e in d)c[e]=b[e]||d[e];this.options.width==null&&this.setOption("width",a.width),this.options.height==null&&this.setOption("height",a.height);if(typeof ImageData!="undefined"&&ImageData!==null&&a instanceof ImageData)c.data=a.data;else if(typeof CanvasRenderingContext2D!="undefined"&&CanvasRenderingContext2D!==null&&a instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext!="undefined"&&WebGLRenderingContext!==null&&a instanceof WebGLRenderingContext)b.copy?c.data=this.getContextData(a):c.context=a;else{if(a.childNodes==null)throw new Error("Invalid image");b.copy?c.data=this.getImageData(a):c.image=a}return this.frames.push(c)},b.prototype.render=function(){var a,b,c,d;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var b,c,d;d=[];for(a=b=0,c=this.frames.length;0<=c?b<c:b>c;a=0<=c?++b:--b)d.push(null);return d}.call(this),c=this.spawnWorkers();if(this.options.globalPalette===!0)this.renderNextFrame();else for(a=b=0,d=c;0<=d?b<d:b>d;a=0<=d?++b:--b)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},b.prototype.abort=function(){var a;for(;;){a=this.activeWorkers.shift();if(a==null)break;this.log("killing active worker"),a.terminate()}return this.running=!1,this.emit("abort")},b.prototype.spawnWorkers=function(){var a,b,c,d;return b=Math.min(this.options.workers,this.frames.length),function(){d=[];for(var a=c=this.freeWorkers.length;c<=b?a<b:a>b;c<=b?a++:a--)d.push(a);return d}.apply(this).forEach(function(a){return function(b){var c;return a.log("spawning worker "+b),c=new Worker(a.options.workerScript),c.onmessage=function(b){return a.activeWorkers.splice(a.activeWorkers.indexOf(c),1),a.freeWorkers.push(c),a.frameFinished(b.data)},a.freeWorkers.push(c)}}(this)),b},b.prototype.frameFinished=function(a){var b,c,d;this.log("frame "+a.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[a.index]=a;if(this.options.globalPalette===!0){this.options.globalPalette=a.globalPalette,this.log("global palette analyzed");if(this.frames.length>2)for(b=c=1,d=this.freeWorkers.length;1<=d?c<d:c>d;b=1<=d?++c:--c)this.renderNextFrame()}return i.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},b.prototype.finishRendering=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p;h=0,n=this.imageParts;for(e=0,i=n.length;e<i;e++)b=n[e],h+=(b.data.length-1)*b.pageSize+b.cursor;h+=b.pageSize-b.cursor,this.log("rendering finished - filesize "+Math.round(h/1e3)+"kb"),a=new Uint8Array(h),l=0,o=this.imageParts;for(f=0,j=o.length;f<j;f++){b=o[f],p=b.data;for(c=g=0,k=p.length;g<k;c=++g)m=p[c],a.set(m,l),c===b.data.length-1?l+=b.cursor:l+=b.pageSize}return d=new Blob([a],{type:"image/gif"}),this.emit("finished",d,a)},b.prototype.renderNextFrame=function(){var a,b,c;if(this.freeWorkers.length===0)throw new Error("No free workers");if(this.nextFrame>=this.frames.length)return;return a=this.frames[this.nextFrame++],c=this.freeWorkers.shift(),b=this.getTask(a),this.log("starting frame "+(b.index+1)+" of "+this.frames.length),this.activeWorkers.push(c),c.postMessage(b)},b.prototype.getContextData=function(a){return a.getImageData(0,0,this.options.width,this.options.height).data},b.prototype.getImageData=function(a){var b;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),b=this._canvas.getContext("2d"),b.setFill=this.options.background,b.fillRect(0,0,this.options.width,this.options.height),b.drawImage(a,0,0),this.getContextData(b)},b.prototype.getTask=function(a){var b,c;b=this.frames.indexOf(a),c={index:b,last:b===this.frames.length-1,delay:a.delay,transparent:a.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:f.name==="chrome"};if(a.data!=null)c.data=a.data;else if(a.context!=null)c.data=this.getContextData(a.context);else{if(a.image==null)throw new Error("Invalid frame");c.data=this.getImageData(a.image)}return c},b.prototype.log=function(){var a;a=1<=arguments.length?j.call(arguments,0):[];if(!this.options.debug)return;return console.log.apply(console,a)},b}(d),b.exports=e},{"./browser.coffee":2,events:1}]},{},[3])(3)})