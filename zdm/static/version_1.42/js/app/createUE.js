define(["jquery","ueditor","zeroclipboard"],function(a,b,c){function e(e){window.ZeroClipboard=c;var f=b.getEditor(e,{serverUrl:d,onready:function(){var b='<div class="tooltip" style="display: none;"><div class="tooltip_inner"></div><i class="tooltip_arrow"></i></div>';a("body").append(b);var c=a(".tooltip");a(".edui-toolbar > .edui-box").hover(function(b){c.show().find(".tooltip_inner").html(a(this).find("[title]").eq(0).attr("title"));var d=a(this).offset(),e=d.left-c.width()/2+a(this).width()/2,f=d.top-a(this).height()/2-15;c.css("left",e).css("top",f)},function(){c.hide()})}});return f}function f(c,e){var f=b.getEditor(c,{serverUrl:d});f.addListener("afterSetContent afterPaste",function(b,c){function d(a){if(a=="")return!0;var b=[],c=["pic.jiguo.com","s1.jiguo.com"];return a.replace(/<img[^>]*src\s*=(\'|\")(.+?)\1/ig,function(a,d,e,f){var g=e;e=e.toLocaleLowerCase();if(e.substr(0,1)=="/"&&e.substr(0,2)!="//")return;if(e.substr(0,8)!="https://"&&e.substr(0,7)!="http://")return;var h=!1;for(var i=0;i<c.length;i++)e.indexOf(c[i])!==-1&&(h=!0);h===!1&&b.push(g)}),b}var e=d(this.getContent());e.length&&(a(this.document).find("head").append("<style>.edui-image-not-jiguo-zdm-addr{border:5px solid red;}</style>"),a(this.body).find("img[src]").each(function(){for(var b=0;b<e.length;b++)a(this).attr("src")==e[b]&&a(this).addClass("edui-image-not-jiguo-zdm-addr")}))}),f.setContent(e)}var d="/protected/extensions/editor/php/controller.php?uid=11&code=c20ad4d76fe97759aa27a0c99bff6710";return b.registerUI("catchbutton",function(a,c){var d=this;a.registerCommand(c,{execCommand:function(){d.fireEvent("catchRemoteImage")}});var e=new b.ui.Button({name:c,title:"图片远程抓取",onclick:function(){a.execCommand(c)}});return a.addListener("selectionchange",function(){var b=a.queryCommandState(c);b==-1?(e.setDisabled(!0),e.setChecked(!1)):(e.setDisabled(!1),e.setChecked(b))}),e}),{init:e,setContent:f}})