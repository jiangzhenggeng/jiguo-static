define(["jquery","layer","template","app/common"],function(a,b,c,d){function e(a){var b=c("history-list-tpl",a.result),e=a.result.win_num,f=a.result.win_amount||0,g="共中签"+e+"次，中签总金额"+f+"元";d.showBox(g,"800px","500px",b,function(){})}function f(a){d.confirm("请确认有充足货源再发布？","/admin2/work/PublishApply",{mid:a})}function g(a){d.confirm("确定发布未中签消息吗？","/admin2/work/PublishFailedMessage",{mid:a})}function h(b){d.ajax("post","/admin2/work/GetMetaSpec",{meta_id:b},"json",function(b){d.showBox("强制添加","660px","600px",c("user-list-tpl",b.result),function(){a("body").on("click","#spec .meta-type",function(){a(this).addClass("on").siblings().removeClass("on")}),b.result.no_spec==1&&a("#spec").find("span").trigger("click"),a("#authorBtn").on("click",function(){var b=a(this).prev().val().trim();d.ajax("post","/admin2/ajax/GetUserInfo",{username:b},"json",function(b){a("#userBox").html(c("user-tpl",b))})}),i()})})}function i(){a("body").on("click","[data-choose-author]",function(){if(!a("#spec div").hasClass("on"))return b.msg("请选择型号"),!1;var c=a("#spec .on input").val(),e=a(this).next().val().trim(),f={storage_id:c,uid:e};d.ajax("post","/admin2/work/EventAddApply",f,"json",function(){b.closeAll(),b.msg("操作成功",function(){window.location.reload()})})})}function j(a,c){b.confirm("您确定取消吗？",{bth:["确定","取消"]},function(){d.ajax("post","/admin2/work/RemoveApplyUser",{id:a},"json",function(){b.msg("操作成功",function(){window.location.reload()})})})}function k(a,c){b.prompt({title:"请填写押金",value:a},function(a,e){var f={deposit:a,id:c};d.ajax("post","/admin2/work/ChangeDeposit",f,"json",function(){b.close(e),b.msg("操作成功",function(){window.location.reload()})})})}function l(b){var b=a.extend({chooseBtn:"#chooseAll",checkboxes:"#todo-list .icon",operaBtn:"#operaAll",operaAttr:"data-opera",warningAttr:"data-warning"},b),c=a(b.checkboxes).length,d=0;a(b.chooseBtn).on("change",function(){a(b.checkboxes).prop("checked",a(this).is(":checked")),a(b.chooseBtn).is(":checked")?(d=c,a(b.operaBtn).removeAttr(b.warningAttr).attr(b.operaAttr,"")):(d=0,a(b.operaBtn).removeAttr(b.operaAttr).attr(b.warningAttr,""))}),a("body").on("change",b.checkboxes,function(){var e=this;a(e).prop("checked")?d++:(d--,a(b.chooseBtn).prop("checked",!1)),d==c&&(a(b.chooseBtn).prop("checked",!0),a(b.operaBtn).removeAttr(b.warningAttr).attr(b.operaAttr,"")),d>=1?a(b.operaBtn).removeAttr(b.warningAttr).attr(b.operaAttr,""):a(b.operaBtn).removeAttr(b.operaAttr).attr(b.warningAttr,"")})}return{lookHistory:e,publish:f,publishno:g,addUser:h,deleteUser:j,changeDeposit:k,pass:l}})