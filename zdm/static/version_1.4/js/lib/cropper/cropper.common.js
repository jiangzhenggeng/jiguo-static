/*!
 * Cropper.js v1.1.2
 * https://github.com/fengyuanchen/cropperjs
 *
 * Copyright (c) 2015-2017 Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2017-10-18T13:27:02.189Z
 */

function _toConsumableArray(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function isNumber(a){return typeof a=="number"&&!isNaN(a)}function isUndefined(a){return typeof a=="undefined"}function isObject(a){return(typeof a=="undefined"?"undefined":_typeof(a))==="object"&&a!==null}function isPlainObject(a){if(!isObject(a))return!1;try{var b=a.constructor,c=b.prototype;return b&&c&&hasOwnProperty.call(c,"isPrototypeOf")}catch(d){return!1}}function isFunction(a){return typeof a=="function"}function each(a,b){if(a&&isFunction(b))if(Array.isArray(a)||isNumber(a.length)){var c=a.length,d=void 0;for(d=0;d<c;d+=1)if(b.call(a,a[d],d,a)===!1)break}else isObject(a)&&Object.keys(a).forEach(function(c){b.call(a,a[c],c,a)});return a}function extend(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];if(isObject(a)&&c.length>0){if(Object.assign)return Object.assign.apply(Object,[a].concat(c));c.forEach(function(b){isObject(b)&&Object.keys(b).forEach(function(c){a[c]=b[c]})})}return a}function proxy(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}}function normalizeDecimalNumber(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e11;return REGEXP_DECIMALS.test(a)?Math.round(a*b)/b:a}function setStyle(a,b){var c=a.style;each(b,function(a,b){REGEXP_SUFFIX.test(b)&&isNumber(a)&&(a+="px"),c[b]=a})}function hasClass(a,b){return a.classList?a.classList.contains(b):a.className.indexOf(b)>-1}function addClass(a,b){if(!b)return;if(isNumber(a.length)){each(a,function(a){addClass(a,b)});return}if(a.classList){a.classList.add(b);return}var c=a.className.trim();c?c.indexOf(b)<0&&(a.className=c+" "+b):a.className=b}function removeClass(a,b){if(!b)return;if(isNumber(a.length)){each(a,function(a){removeClass(a,b)});return}if(a.classList){a.classList.remove(b);return}a.className.indexOf(b)>=0&&(a.className=a.className.replace(b,""))}function toggleClass(a,b,c){if(!b)return;if(isNumber(a.length)){each(a,function(a){toggleClass(a,b,c)});return}c?addClass(a,b):removeClass(a,b)}function hyphenate(a){return a.replace(REGEXP_HYPHENATE,"$1-$2").toLowerCase()}function getData(a,b){return isObject(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-"+hyphenate(b))}function setData(a,b,c){isObject(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-"+hyphenate(b),c)}function removeData(a,b){if(isObject(a[b]))delete a[b];else if(a.dataset)try{delete a.dataset[b]}catch(c){a.dataset[b]=null}else a.removeAttribute("data-"+hyphenate(b))}function removeListener(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!isFunction(c))return;var e=b.trim().split(REGEXP_SPACES);if(e.length>1){each(e,function(b){removeListener(a,b,c)});return}isFunction(c.onceListener)&&(c=c.onceListener,delete c.onceListener),a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)}function addListener(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!isFunction(c))return;var e=b.trim().split(REGEXP_SPACES);if(e.length>1){each(e,function(b){addListener(a,b,c)});return}if(d.once){var f=c,g=function h(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return removeListener(a,b,h),f.apply(a,d)};f.onceListener=g,c=g}a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)}function dispatchEvent(a,b,c){if(a.dispatchEvent){var d=void 0;return isFunction(Event)&&isFunction(CustomEvent)?isUndefined(c)?d=new Event(b,{bubbles:!0,cancelable:!0}):d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):isUndefined(c)?(d=document.createEvent("Event"),d.initEvent(b,!0,!0)):(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!0,c)),a.dispatchEvent(d)}return a.fireEvent?a.fireEvent("on"+b):!0}function getOffset(a){var b=document.documentElement,c=a.getBoundingClientRect();return{left:c.left+((global.scrollX||b&&b.scrollLeft||0)-(b&&b.clientLeft||0)),top:c.top+((global.scrollY||b&&b.scrollTop||0)-(b&&b.clientTop||0))}}function empty(a){while(a.firstChild)a.removeChild(a.firstChild)}function isCrossOriginURL(a){var b=a.match(REGEXP_ORIGINS);return b&&(b[1]!==location.protocol||b[2]!==location.hostname||b[3]!==location.port)}function addTimestamp(a){var b="timestamp="+(new Date).getTime();return a+(a.indexOf("?")===-1?"?":"&")+b}function getTransforms(a){var b=a.rotate,c=a.scaleX,d=a.scaleY,e=a.translateX,f=a.translateY,g=[];isNumber(e)&&e!==0&&g.push("translateX("+e+"px)"),isNumber(f)&&f!==0&&g.push("translateY("+f+"px)"),isNumber(b)&&b!==0&&g.push("rotate("+b+"deg)"),isNumber(c)&&c!==1&&g.push("scaleX("+c+")"),isNumber(d)&&d!==1&&g.push("scaleY("+d+")");var h=g.length?g.join(" "):"none";return{WebkitTransform:h,msTransform:h,transform:h}}function getImageNaturalSizes(a,b){if(a.naturalWidth&&!IS_SAFARI_OR_UIWEBVIEW){b(a.naturalWidth,a.naturalHeight);return}var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.src=a.src}function getMaxZoomRatio(a){var b=extend({},a),c=[];return each(a,function(a,d){delete b[d],each(b,function(b){var d=Math.abs(a.startX-b.startX),e=Math.abs(a.startY-b.startY),f=Math.abs(a.endX-b.endX),g=Math.abs(a.endY-b.endY),h=Math.sqrt(d*d+e*e),i=Math.sqrt(f*f+g*g),j=(i-h)/h;c.push(j)})}),c.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),c[0]}function getPointer(a,b){var c=a.pageX,d=a.pageY,e={endX:c,endY:d};return b?e:extend({startX:c,startY:d},e)}function getPointersCenter(a){var b=0,c=0,d=0;return each(a,function(a){var e=a.startX,f=a.startY;b+=e,c+=f,d+=1}),b/=d,c/=d,{pageX:b,pageY:c}}function getContainSizes(a){var b=a.aspectRatio,c=a.height,d=a.width,e=function(b){return isFinite(b)&&b>0};return e(d)&&e(c)?c*b>d?c=d/b:d=c*b:e(d)?c=d/b:e(c)&&(d=c*b),{width:d,height:c}}function getRotatedSizes(a){var b=a.width,c=a.height,d=a.degree;d=Math.abs(d);if(d%180===90)return{width:c,height:b};var e=d%90*Math.PI/180,f=Math.sin(e),g=Math.cos(e);return{width:b*g+c*f,height:b*f+c*g}}function getSourceCanvas(a,b,c,d){var e=b.naturalWidth,f=b.naturalHeight,g=b.rotate,h=b.scaleX,i=b.scaleY,j=c.aspectRatio,k=c.naturalWidth,l=c.naturalHeight,m=d.fillColor,n=m===undefined?"transparent":m,o=d.imageSmoothingEnabled,p=o===undefined?!0:o,q=d.imageSmoothingQuality,r=q===undefined?"low":q,s=d.maxWidth,t=s===undefined?Infinity:s,u=d.maxHeight,v=u===undefined?Infinity:u,w=d.minWidth,x=w===undefined?0:w,y=d.minHeight,z=y===undefined?0:y,A=document.createElement("canvas"),B=A.getContext("2d"),C=getContainSizes({aspectRatio:j,width:t,height:v}),D=getContainSizes({aspectRatio:j,width:x,height:z}),E=Math.min(C.width,Math.max(D.width,k)),F=Math.min(C.height,Math.max(D.height,l)),G=[-e/2,-f/2,e,f];return A.width=normalizeDecimalNumber(E),A.height=normalizeDecimalNumber(F),B.fillStyle=n,B.fillRect(0,0,E,F),B.save(),B.translate(E/2,F/2),B.rotate(g*Math.PI/180),B.scale(h,i),B.imageSmoothingEnabled=p,B.imageSmoothingQuality=r,B.drawImage.apply(B,[a].concat(_toConsumableArray(G.map(function(a){return Math.floor(normalizeDecimalNumber(a))})))),B.restore(),A}function getStringFromCharCode(a,b,c){var d="",e=void 0;c+=b;for(e=b;e<c;e+=1)d+=fromCharCode(a.getUint8(e));return d}function dataURLToArrayBuffer(a){var b=a.replace(REGEXP_DATA_URL_HEAD,""),c=atob(b),d=new ArrayBuffer(c.length),e=new Uint8Array(d);return each(e,function(a,b){e[b]=c.charCodeAt(b)}),d}function arrayBufferToDataURL(a,b){var c=new Uint8Array(a),d="";return each(c,function(a){d+=fromCharCode(a)}),"data:"+b+";base64,"+btoa(d)}function getOrientation(a){var b=new DataView(a),c=void 0,d=void 0,e=void 0,f=void 0;if(b.getUint8(0)===255&&b.getUint8(1)===216){var g=b.byteLength,h=2;while(h<g){if(b.getUint8(h)===255&&b.getUint8(h+1)===225){e=h;break}h+=1}}if(e){var i=e+4,j=e+10;if(getStringFromCharCode(b,i,4)==="Exif"){var k=b.getUint16(j);d=k===18761;if(d||k===19789)if(b.getUint16(j+2,d)===42){var l=b.getUint32(j+4,d);l>=8&&(f=j+l)}}}if(f){var m=b.getUint16(f,d),n=void 0,o=void 0;for(o=0;o<m;o+=1){n=f+o*12+2;if(b.getUint16(n,d)===274){n+=8,c=b.getUint16(n,d),b.setUint16(n,1,d);break}}}return c}function parseOrientation(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=90,d=-1;break;case 6:b=90;break;case 7:b=90,c=-1;break;case 8:b=-90;break;default:}return{rotate:b,scaleX:c,scaleY:d}}function _toConsumableArray$1(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var global=typeof window!="undefined"?window:{},NAMESPACE="cropper",ACTION_ALL="all",ACTION_CROP="crop",ACTION_MOVE="move",ACTION_ZOOM="zoom",ACTION_EAST="e",ACTION_WEST="w",ACTION_SOUTH="s",ACTION_NORTH="n",ACTION_NORTH_EAST="ne",ACTION_NORTH_WEST="nw",ACTION_SOUTH_EAST="se",ACTION_SOUTH_WEST="sw",CLASS_CROP=NAMESPACE+"-crop",CLASS_DISABLED=NAMESPACE+"-disabled",CLASS_HIDDEN=NAMESPACE+"-hidden",CLASS_HIDE=NAMESPACE+"-hide",CLASS_INVISIBLE=NAMESPACE+"-invisible",CLASS_MODAL=NAMESPACE+"-modal",CLASS_MOVE=NAMESPACE+"-move",DATA_ACTION="action",DATA_PREVIEW="preview",DRAG_MODE_CROP="crop",DRAG_MODE_MOVE="move",DRAG_MODE_NONE="none",EVENT_CROP="crop",EVENT_CROP_END="cropend",EVENT_CROP_MOVE="cropmove",EVENT_CROP_START="cropstart",EVENT_DBLCLICK="dblclick",EVENT_ERROR="error",EVENT_LOAD="load",EVENT_POINTER_DOWN=global.PointerEvent?"pointerdown":"touchstart mousedown",EVENT_POINTER_MOVE=global.PointerEvent?"pointermove":"touchmove mousemove",EVENT_POINTER_UP=global.PointerEvent?" pointerup pointercancel":"touchend touchcancel mouseup",EVENT_READY="ready",EVENT_RESIZE="resize",EVENT_WHEEL="wheel mousewheel DOMMouseScroll",EVENT_ZOOM="zoom",REGEXP_ACTIONS=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,REGEXP_DATA_URL=/^data:/,REGEXP_DATA_URL_JPEG=/^data:image\/jpeg;base64,/,REGEXP_TAG_NAME=/^(img|canvas)$/i,DEFAULTS={viewMode:0,dragMode:DRAG_MODE_CROP,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',_typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},isNaN=Number.isNaN||global.isNaN,hasOwnProperty=Object.prototype.hasOwnProperty,REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/i,REGEXP_SUFFIX=/^(width|height|left|top|marginLeft|marginTop)$/,REGEXP_HYPHENATE=/([a-z\d])([A-Z])/g,REGEXP_SPACES=/\s+/,location=global.location,REGEXP_ORIGINS=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,navigator=global.navigator,IS_SAFARI_OR_UIWEBVIEW=navigator&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(navigator.userAgent),isFinite=Number.isFinite||global.isFinite,fromCharCode=String.fromCharCode,REGEXP_DATA_URL_HEAD=/^data:.*,/,render={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var b=this.element,c=this.options,d=this.container,e=this.cropper;addClass(e,CLASS_HIDDEN),removeClass(b,CLASS_HIDDEN);var f={width:Math.max(d.offsetWidth,Number(c.minContainerWidth)||200),height:Math.max(d.offsetHeight,Number(c.minContainerHeight)||100)};this.containerData=f,setStyle(e,{width:f.width,height:f.height}),addClass(b,CLASS_HIDDEN),removeClass(e,CLASS_HIDDEN)},initCanvas:function(){var b=this.containerData,c=this.imageData,d=this.options.viewMode,e=Math.abs(c.rotate)%180===90,f=e?c.naturalHeight:c.naturalWidth,g=e?c.naturalWidth:c.naturalHeight,h=f/g,i=b.width,j=b.height;b.height*h>b.width?d===3?i=b.height*h:j=b.width/h:d===3?j=b.width/h:i=b.height*h;var k={aspectRatio:h,naturalWidth:f,naturalHeight:g,width:i,height:j};k.left=(b.width-i)/2,k.top=(b.height-j)/2,k.oldLeft=k.left,k.oldTop=k.top,this.canvasData=k,this.limited=d===1||d===2,this.limitCanvas(!0,!0),this.initialImageData=extend({},c),this.initialCanvasData=extend({},k)},limitCanvas:function(b,c){var d=this.options,e=this.containerData,f=this.canvasData,g=this.cropBoxData,h=d.viewMode,i=f.aspectRatio,j=this.cropped&&g;if(b){var k=Number(d.minCanvasWidth)||0,l=Number(d.minCanvasHeight)||0;h>1?(k=Math.max(k,e.width),l=Math.max(l,e.height),h===3&&(l*i>k?k=l*i:l=k/i)):h>0&&(k?k=Math.max(k,j?g.width:0):l?l=Math.max(l,j?g.height:0):j&&(k=g.width,l=g.height,l*i>k?k=l*i:l=k/i));var m=getContainSizes({aspectRatio:i,width:k,height:l});k=m.width,l=m.height,f.minWidth=k,f.minHeight=l,f.maxWidth=Infinity,f.maxHeight=Infinity}if(c)if(h){var n=e.width-f.width,o=e.height-f.height;f.minLeft=Math.min(0,n),f.minTop=Math.min(0,o),f.maxLeft=Math.max(0,n),f.maxTop=Math.max(0,o),j&&this.limited&&(f.minLeft=Math.min(g.left,g.left+(g.width-f.width)),f.minTop=Math.min(g.top,g.top+(g.height-f.height)),f.maxLeft=g.left,f.maxTop=g.top,h===2&&(f.width>=e.width&&(f.minLeft=Math.min(0,n),f.maxLeft=Math.max(0,n)),f.height>=e.height&&(f.minTop=Math.min(0,o),f.maxTop=Math.max(0,o))))}else f.minLeft=-f.width,f.minTop=-f.height,f.maxLeft=e.width,f.maxTop=e.height},renderCanvas:function(b,c){var d=this.canvasData,e=this.imageData;if(c){var f=getRotatedSizes({width:e.naturalWidth*Math.abs(e.scaleX),height:e.naturalHeight*Math.abs(e.scaleY),degree:e.rotate}),g=f.width,h=f.height,i=d.width*(g/d.naturalWidth),j=d.height*(h/d.naturalHeight);d.left-=(i-d.width)/2,d.top-=(j-d.height)/2,d.width=i,d.height=j,d.aspectRatio=g/h,d.naturalWidth=g,d.naturalHeight=h,this.limitCanvas(!0,!1)}if(d.width>d.maxWidth||d.width<d.minWidth)d.left=d.oldLeft;if(d.height>d.maxHeight||d.height<d.minHeight)d.top=d.oldTop;d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth),d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight),this.limitCanvas(!1,!0),d.left=Math.min(Math.max(d.left,d.minLeft),d.maxLeft),d.top=Math.min(Math.max(d.top,d.minTop),d.maxTop),d.oldLeft=d.left,d.oldTop=d.top,setStyle(this.canvas,extend({width:d.width,height:d.height},getTransforms({translateX:d.left,translateY:d.top}))),this.renderImage(b),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(b){var c=this.canvasData,d=this.imageData,e=d.naturalWidth*(c.width/c.naturalWidth),f=d.naturalHeight*(c.height/c.naturalHeight);extend(d,{width:e,height:f,left:(c.width-e)/2,top:(c.height-f)/2}),setStyle(this.image,extend({width:d.width,height:d.height},getTransforms(extend({translateX:d.left,translateY:d.top},d)))),b&&this.output()},initCropBox:function(){var b=this.options,c=this.canvasData,d=b.aspectRatio,e=Number(b.autoCropArea)||.8,f={width:c.width,height:c.height};d&&(c.height*d>c.width?f.height=f.width/d:f.width=f.height*d),this.cropBoxData=f,this.limitCropBox(!0,!0),f.width=Math.min(Math.max(f.width,f.minWidth),f.maxWidth),f.height=Math.min(Math.max(f.height,f.minHeight),f.maxHeight),f.width=Math.max(f.minWidth,f.width*e),f.height=Math.max(f.minHeight,f.height*e),f.left=c.left+(c.width-f.width)/2,f.top=c.top+(c.height-f.height)/2,f.oldLeft=f.left,f.oldTop=f.top,this.initialCropBoxData=extend({},f)},limitCropBox:function(b,c){var d=this.options,e=this.containerData,f=this.canvasData,g=this.cropBoxData,h=this.limited,i=d.aspectRatio;if(b){var j=Number(d.minCropBoxWidth)||0,k=Number(d.minCropBoxHeight)||0,l=Math.min(e.width,h?f.width:e.width),m=Math.min(e.height,h?f.height:e.height);j=Math.min(j,e.width),k=Math.min(k,e.height),i&&(j&&k?k*i>j?k=j/i:j=k*i:j?k=j/i:k&&(j=k*i),m*i>l?m=l/i:l=m*i),g.minWidth=Math.min(j,l),g.minHeight=Math.min(k,m),g.maxWidth=l,g.maxHeight=m}c&&(h?(g.minLeft=Math.max(0,f.left),g.minTop=Math.max(0,f.top),g.maxLeft=Math.min(e.width,f.left+f.width)-g.width,g.maxTop=Math.min(e.height,f.top+f.height)-g.height):(g.minLeft=0,g.minTop=0,g.maxLeft=e.width-g.width,g.maxTop=e.height-g.height))},renderCropBox:function(){var b=this.options,c=this.containerData,d=this.cropBoxData;if(d.width>d.maxWidth||d.width<d.minWidth)d.left=d.oldLeft;if(d.height>d.maxHeight||d.height<d.minHeight)d.top=d.oldTop;d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth),d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight),this.limitCropBox(!1,!0),d.left=Math.min(Math.max(d.left,d.minLeft),d.maxLeft),d.top=Math.min(Math.max(d.top,d.minTop),d.maxTop),d.oldLeft=d.left,d.oldTop=d.top,b.movable&&b.cropBoxMovable&&setData(this.face,DATA_ACTION,d.width>=c.width&&d.height>=c.height?ACTION_MOVE:ACTION_ALL),setStyle(this.cropBox,extend({width:d.width,height:d.height},getTransforms({translateX:d.left,translateY:d.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete&&dispatchEvent(this.element,EVENT_CROP,this.getData())}},preview={initPreview:function(){var b=this.crossOrigin,c=this.options.preview,d=b?this.crossOriginUrl:this.url,e=document.createElement("img");b&&(e.crossOrigin=b),e.src=d,this.viewBox.appendChild(e),this.image2=e;if(!c)return;var f=c.querySelector?[c]:document.querySelectorAll(c);this.previews=f,each(f,function(a){var c=document.createElement("img");setData(a,DATA_PREVIEW,{width:a.offsetWidth,height:a.offsetHeight,html:a.innerHTML}),b&&(c.crossOrigin=b),c.src=d,c.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',empty(a),a.appendChild(c)})},resetPreview:function(){each(this.previews,function(a){var b=getData(a,DATA_PREVIEW);setStyle(a,{width:b.width,height:b.height}),a.innerHTML=b.html,removeData(a,DATA_PREVIEW)})},preview:function(){var b=this.imageData,c=this.canvasData,d=this.cropBoxData,e=d.width,f=d.height,g=b.width,h=b.height,i=d.left-c.left-b.left,j=d.top-c.top-b.top;if(!this.cropped||this.disabled)return;setStyle(this.image2,extend({width:g,height:h},getTransforms(extend({translateX:-i,translateY:-j},b)))),each(this.previews,function(a){var c=getData(a,DATA_PREVIEW),d=c.width,k=c.height,l=d,m=k,n=1;e&&(n=d/e,m=f*n),f&&m>k&&(n=k/f,l=e*n,m=k),setStyle(a,{width:l,height:m}),setStyle(a.getElementsByTagName("img")[0],extend({width:g*n,height:h*n},getTransforms(extend({translateX:-i*n,translateY:-j*n},b))))})}},events={bind:function(){var b=this.element,c=this.options,d=this.cropper;isFunction(c.cropstart)&&addListener(b,EVENT_CROP_START,c.cropstart),isFunction(c.cropmove)&&addListener(b,EVENT_CROP_MOVE,c.cropmove),isFunction(c.cropend)&&addListener(b,EVENT_CROP_END,c.cropend),isFunction(c.crop)&&addListener(b,EVENT_CROP,c.crop),isFunction(c.zoom)&&addListener(b,EVENT_ZOOM,c.zoom),addListener(d,EVENT_POINTER_DOWN,this.onCropStart=proxy(this.cropStart,this)),c.zoomable&&c.zoomOnWheel&&addListener(d,EVENT_WHEEL,this.onWheel=proxy(this.wheel,this)),c.toggleDragModeOnDblclick&&addListener(d,EVENT_DBLCLICK,this.onDblclick=proxy(this.dblclick,this)),addListener(document,EVENT_POINTER_MOVE,this.onCropMove=proxy(this.cropMove,this)),addListener(document,EVENT_POINTER_UP,this.onCropEnd=proxy(this.cropEnd,this)),c.responsive&&addListener(global,EVENT_RESIZE,this.onResize=proxy(this.resize,this))},unbind:function(){var b=this.element,c=this.options,d=this.cropper;isFunction(c.cropstart)&&removeListener(b,EVENT_CROP_START,c.cropstart),isFunction(c.cropmove)&&removeListener(b,EVENT_CROP_MOVE,c.cropmove),isFunction(c.cropend)&&removeListener(b,EVENT_CROP_END,c.cropend),isFunction(c.crop)&&removeListener(b,EVENT_CROP,c.crop),isFunction(c.zoom)&&removeListener(b,EVENT_ZOOM,c.zoom),removeListener(d,EVENT_POINTER_DOWN,this.onCropStart),c.zoomable&&c.zoomOnWheel&&removeListener(d,EVENT_WHEEL,this.onWheel),c.toggleDragModeOnDblclick&&removeListener(d,EVENT_DBLCLICK,this.onDblclick),removeListener(document,EVENT_POINTER_MOVE,this.onCropMove),removeListener(document,EVENT_POINTER_UP,this.onCropEnd),c.responsive&&removeListener(global,EVENT_RESIZE,this.onResize)}},handlers={resize:function(){var b=this.options,c=this.container,d=this.containerData,e=Number(b.minContainerWidth)||200,f=Number(b.minContainerHeight)||100;if(this.disabled||d.width<=e||d.height<=f)return;var g=c.offsetWidth/d.width;if(g!==1||c.offsetHeight!==d.height){var h=void 0,i=void 0;b.restore&&(h=this.getCanvasData(),i=this.getCropBoxData()),this.render(),b.restore&&(this.setCanvasData(each(h,function(a,b){h[b]=a*g})),this.setCropBoxData(each(i,function(a,b){i[b]=a*g})))}},dblclick:function(){if(this.disabled||this.options.dragMode===DRAG_MODE_NONE)return;this.setDragMode(hasClass(this.dragBox,CLASS_CROP)?DRAG_MODE_MOVE:DRAG_MODE_CROP)},wheel:function(b){var c=this,d=Number(this.options.wheelZoomRatio)||.1,e=1;if(this.disabled)return;b.preventDefault();if(this.wheeling)return;this.wheeling=!0,setTimeout(function(){c.wheeling=!1},50),b.deltaY?e=b.deltaY>0?1:-1:b.wheelDelta?e=-b.wheelDelta/120:b.detail&&(e=b.detail>0?1:-1),this.zoom(-e*d,b)},cropStart:function(b){if(this.disabled)return;var c=this.options,d=this.pointers,e=void 0;b.changedTouches?each(b.changedTouches,function(a){d[a.identifier]=getPointer(a)}):d[b.pointerId||0]=getPointer(b),Object.keys(d).length>1&&c.zoomable&&c.zoomOnTouch?e=ACTION_ZOOM:e=getData(b.target,DATA_ACTION);if(!REGEXP_ACTIONS.test(e))return;if(dispatchEvent(this.element,EVENT_CROP_START,{originalEvent:b,action:e})===!1)return;b.preventDefault(),this.action=e,this.cropping=!1,e===ACTION_CROP&&(this.cropping=!0,addClass(this.dragBox,CLASS_MODAL))},cropMove:function(b){var c=this.action;if(this.disabled||!c)return;var d=this.pointers;b.preventDefault();if(dispatchEvent(this.element,EVENT_CROP_MOVE,{originalEvent:b,action:c})===!1)return;b.changedTouches?each(b.changedTouches,function(a){extend(d[a.identifier],getPointer(a,!0))}):extend(d[b.pointerId||0],getPointer(b,!0)),this.change(b)},cropEnd:function(b){if(this.disabled)return;var c=this.action,d=this.pointers;b.changedTouches?each(b.changedTouches,function(a){delete d[a.identifier]}):delete d[b.pointerId||0];if(!c)return;b.preventDefault(),Object.keys(d).length||(this.action=""),this.cropping&&(this.cropping=!1,toggleClass(this.dragBox,CLASS_MODAL,this.cropped&&this.options.modal)),dispatchEvent(this.element,EVENT_CROP_END,{originalEvent:b,action:c})}},change={change:function(b){var c=this.options,d=this.canvasData,e=this.containerData,f=this.cropBoxData,g=this.pointers,h=this.action,i=c.aspectRatio,j=f.left,k=f.top,l=f.width,m=f.height,n=j+l,o=k+m,p=0,q=0,r=e.width,s=e.height,t=!0,u=void 0;!i&&b.shiftKey&&(i=l&&m?l/m:1),this.limited&&(p=f.minLeft,q=f.minTop,r=p+Math.min(e.width,d.width,d.left+d.width),s=q+Math.min(e.height,d.height,d.top+d.height));var v=g[Object.keys(g)[0]],w={x:v.endX-v.startX,y:v.endY-v.startY},x=function(b){switch(b){case ACTION_EAST:n+w.x>r&&(w.x=r-n);break;case ACTION_WEST:j+w.x<p&&(w.x=p-j);break;case ACTION_NORTH:k+w.y<q&&(w.y=q-k);break;case ACTION_SOUTH:o+w.y>s&&(w.y=s-o);break;default:}};switch(h){case ACTION_ALL:j+=w.x,k+=w.y;break;case ACTION_EAST:if(w.x>=0&&(n>=r||i&&(k<=q||o>=s))){t=!1;break}x(ACTION_EAST),l+=w.x,i&&(m=l/i,k-=w.x/i/2),l<0&&(h=ACTION_WEST,l=0);break;case ACTION_NORTH:if(w.y<=0&&(k<=q||i&&(j<=p||n>=r))){t=!1;break}x(ACTION_NORTH),m-=w.y,k+=w.y,i&&(l=m*i,j+=w.y*i/2),m<0&&(h=ACTION_SOUTH,m=0);break;case ACTION_WEST:if(w.x<=0&&(j<=p||i&&(k<=q||o>=s))){t=!1;break}x(ACTION_WEST),l-=w.x,j+=w.x,i&&(m=l/i,k+=w.x/i/2),l<0&&(h=ACTION_EAST,l=0);break;case ACTION_SOUTH:if(w.y>=0&&(o>=s||i&&(j<=p||n>=r))){t=!1;break}x(ACTION_SOUTH),m+=w.y,i&&(l=m*i,j-=w.y*i/2),m<0&&(h=ACTION_NORTH,m=0);break;case ACTION_NORTH_EAST:if(i){if(w.y<=0&&(k<=q||n>=r)){t=!1;break}x(ACTION_NORTH),m-=w.y,k+=w.y,l=m*i}else x(ACTION_NORTH),x(ACTION_EAST),w.x>=0?n<r?l+=w.x:w.y<=0&&k<=q&&(t=!1):l+=w.x,w.y<=0?k>q&&(m-=w.y,k+=w.y):(m-=w.y,k+=w.y);l<0&&m<0?(h=ACTION_SOUTH_WEST,m=0,l=0):l<0?(h=ACTION_NORTH_WEST,l=0):m<0&&(h=ACTION_SOUTH_EAST,m=0);break;case ACTION_NORTH_WEST:if(i){if(w.y<=0&&(k<=q||j<=p)){t=!1;break}x(ACTION_NORTH),m-=w.y,k+=w.y,l=m*i,j+=w.y*i}else x(ACTION_NORTH),x(ACTION_WEST),w.x<=0?j>p?(l-=w.x,j+=w.x):w.y<=0&&k<=q&&(t=!1):(l-=w.x,j+=w.x),w.y<=0?k>q&&(m-=w.y,k+=w.y):(m-=w.y,k+=w.y);l<0&&m<0?(h=ACTION_SOUTH_EAST,m=0,l=0):l<0?(h=ACTION_NORTH_EAST,l=0):m<0&&(h=ACTION_SOUTH_WEST,m=0);break;case ACTION_SOUTH_WEST:if(i){if(w.x<=0&&(j<=p||o>=s)){t=!1;break}x(ACTION_WEST),l-=w.x,j+=w.x,m=l/i}else x(ACTION_SOUTH),x(ACTION_WEST),w.x<=0?j>p?(l-=w.x,j+=w.x):w.y>=0&&o>=s&&(t=!1):(l-=w.x,j+=w.x),w.y>=0?o<s&&(m+=w.y):m+=w.y;l<0&&m<0?(h=ACTION_NORTH_EAST,m=0,l=0):l<0?(h=ACTION_SOUTH_EAST,l=0):m<0&&(h=ACTION_NORTH_WEST,m=0);break;case ACTION_SOUTH_EAST:if(i){if(w.x>=0&&(n>=r||o>=s)){t=!1;break}x(ACTION_EAST),l+=w.x,m=l/i}else x(ACTION_SOUTH),x(ACTION_EAST),w.x>=0?n<r?l+=w.x:w.y>=0&&o>=s&&(t=!1):l+=w.x,w.y>=0?o<s&&(m+=w.y):m+=w.y;l<0&&m<0?(h=ACTION_NORTH_WEST,m=0,l=0):l<0?(h=ACTION_SOUTH_WEST,l=0):m<0&&(h=ACTION_NORTH_EAST,m=0);break;case ACTION_MOVE:this.move(w.x,w.y),t=!1;break;case ACTION_ZOOM:this.zoom(getMaxZoomRatio(g),b),t=!1;break;case ACTION_CROP:if(!w.x||!w.y){t=!1;break}u=getOffset(this.cropper),j=v.startX-u.left,k=v.startY-u.top,l=f.minWidth,m=f.minHeight,w.x>0?h=w.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST:w.x<0&&(j-=l,h=w.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST),w.y<0&&(k-=m),this.cropped||(removeClass(this.cropBox,CLASS_HIDDEN),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break;default:}t&&(f.width=l,f.height=m,f.left=j,f.top=k,this.action=h,this.renderCropBox()),each(g,function(a){a.startX=a.endX,a.startY=a.endY})}},methods={crop:function(){return this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&addClass(this.dragBox,CLASS_MODAL),removeClass(this.cropBox,CLASS_HIDDEN)),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=extend({},this.initialImageData),this.canvasData=extend({},this.initialCanvasData),this.cropBoxData=extend({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(extend(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),removeClass(this.dragBox,CLASS_MODAL),addClass(this.cropBox,CLASS_HIDDEN)),this},replace:function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return!this.disabled&&b&&(this.isImg&&(this.element.src=b),c?(this.url=b,this.image.src=b,this.ready&&(this.image2.src=b,each(this.previews,function(a){a.getElementsByTagName("img")[0].src=b}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(b))),this},enable:function(){return this.ready&&(this.disabled=!1,removeClass(this.cropper,CLASS_DISABLED)),this},disable:function(){return this.ready&&(this.disabled=!0,addClass(this.cropper,CLASS_DISABLED)),this},destroy:function(){var b=this.element,c=this.image;return this.loaded?(this.isImg&&this.replaced&&(b.src=this.originalUrl),this.unbuild(),removeClass(b,CLASS_HIDDEN)):this.isImg?removeListener(b,EVENT_LOAD,this.onStart):c&&c.parentNode.removeChild(c),removeData(b,NAMESPACE),this},move:function(b,c){var d=this.canvasData,e=d.left,f=d.top;return this.moveTo(isUndefined(b)?b:e+Number(b),isUndefined(c)?c:f+Number(c))},moveTo:function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:b,d=this.canvasData,e=!1;return b=Number(b),c=Number(c),this.ready&&!this.disabled&&this.options.movable&&(isNumber(b)&&(d.left=b,e=!0),isNumber(c)&&(d.top=c,e=!0),e&&this.renderCanvas(!0)),this},zoom:function(b,c){var d=this.canvasData;return b=Number(b),b<0?b=1/(1-b):b=1+b,this.zoomTo(d.width*b/d.naturalWidth,c)},zoomTo:function(b,c){var d=this.options,e=this.canvasData,f=e.width,g=e.height,h=e.naturalWidth,i=e.naturalHeight;b=Number(b);if(b>=0&&this.ready&&!this.disabled&&d.zoomable){var j=h*b,k=i*b;if(dispatchEvent(this.element,EVENT_ZOOM,{originalEvent:c,oldRatio:f/h,ratio:j/h})===!1)return this;if(c){var l=this.pointers,m=getOffset(this.cropper),n=l&&Object.keys(l).length?getPointersCenter(l):{pageX:c.pageX,pageY:c.pageY};e.left-=(j-f)*((n.pageX-m.left-e.left)/f),e.top-=(k-g)*((n.pageY-m.top-e.top)/g)}else e.left-=(j-f)/2,e.top-=(k-g)/2;e.width=j,e.height=k,this.renderCanvas(!0)}return this},rotate:function(b){return this.rotateTo((this.imageData.rotate||0)+Number(b))},rotateTo:function(b){return b=Number(b),isNumber(b)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=b%360,this.renderCanvas(!0,!0)),this},scaleX:function(b){var c=this.imageData.scaleY;return this.scale(b,isNumber(c)?c:1)},scaleY:function(b){var c=this.imageData.scaleX;return this.scale(isNumber(c)?c:1,b)},scale:function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:b,d=this.imageData,e=!1;return b=Number(b),c=Number(c),this.ready&&!this.disabled&&this.options.scalable&&(isNumber(b)&&(d.scaleX=b,e=!0),isNumber(c)&&(d.scaleY=c,e=!0),e&&this.renderCanvas(!0,!0)),this},getData:function(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,c=this.options,d=this.imageData,e=this.canvasData,f=this.cropBoxData,g=void 0;if(this.ready&&this.cropped){g={x:f.left-e.left,y:f.top-e.top,width:f.width,height:f.height};var h=d.width/d.naturalWidth;each(g,function(a,c){a/=h,g[c]=b?Math.round(a):a})}else g={x:0,y:0,width:0,height:0};return c.rotatable&&(g.rotate=d.rotate||0),c.scalable&&(g.scaleX=d.scaleX||1,g.scaleY=d.scaleY||1),g},setData:function(b){var c=this.options,d=this.imageData,e=this.canvasData,f={};isFunction(b)&&(b=b.call(this.element));if(this.ready&&!this.disabled&&isPlainObject(b)){var g=!1;c.rotatable&&isNumber(b.rotate)&&b.rotate!==d.rotate&&(d.rotate=b.rotate,g=!0),c.scalable&&(isNumber(b.scaleX)&&b.scaleX!==d.scaleX&&(d.scaleX=b.scaleX,g=!0),isNumber(b.scaleY)&&b.scaleY!==d.scaleY&&(d.scaleY=b.scaleY,g=!0)),g&&this.renderCanvas(!0,!0);var h=d.width/d.naturalWidth;isNumber(b.x)&&(f.left=b.x*h+e.left),isNumber(b.y)&&(f.top=b.y*h+e.top),isNumber(b.width)&&(f.width=b.width*h),isNumber(b.height)&&(f.height=b.height*h),this.setCropBoxData(f)}return this},getContainerData:function(){return this.ready?extend({},this.containerData):{}},getImageData:function(){return this.loaded?extend({},this.imageData):{}},getCanvasData:function(){var b=this.canvasData,c={};return this.ready&&each(["left","top","width","height","naturalWidth","naturalHeight"],function(a){c[a]=b[a]}),c},setCanvasData:function(b){var c=this.canvasData,d=c.aspectRatio;return isFunction(b)&&(b=b.call(this.element)),this.ready&&!this.disabled&&isPlainObject(b)&&(isNumber(b.left)&&(c.left=b.left),isNumber(b.top)&&(c.top=b.top),isNumber(b.width)?(c.width=b.width,c.height=b.width/d):isNumber(b.height)&&(c.height=b.height,c.width=b.height*d),this.renderCanvas(!0)),this},getCropBoxData:function(){var b=this.cropBoxData,c=void 0;return this.ready&&this.cropped&&(c={left:b.left,top:b.top,width:b.width,height:b.height}),c||{}},setCropBoxData:function(b){var c=this.cropBoxData,d=this.options.aspectRatio,e=void 0,f=void 0;return isFunction(b)&&(b=b.call(this.element)),this.ready&&this.cropped&&!this.disabled&&isPlainObject(b)&&(isNumber(b.left)&&(c.left=b.left),isNumber(b.top)&&(c.top=b.top),isNumber(b.width)&&b.width!==c.width&&(e=!0,c.width=b.width),isNumber(b.height)&&b.height!==c.height&&(f=!0,c.height=b.height),d&&(e?c.height=c.width/d:f&&(c.width=c.height*d)),this.renderCropBox()),this},getCroppedCanvas:function(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.ready||!global.HTMLCanvasElement)return null;var c=this.canvasData,d=getSourceCanvas(this.image,this.imageData,c,b);if(!this.cropped)return d;var e=this.getData(),f=e.x,g=e.y,h=e.width,i=e.height,j=h/i,k=getContainSizes({aspectRatio:j,width:b.maxWidth||Infinity,height:b.maxHeight||Infinity}),l=getContainSizes({aspectRatio:j,width:b.minWidth||0,height:b.minHeight||0}),m=getContainSizes({aspectRatio:j,width:b.width||h,height:b.height||i}),n=m.width,o=m.height;n=Math.min(k.width,Math.max(l.width,n)),o=Math.min(k.height,Math.max(l.height,o));var p=document.createElement("canvas"),q=p.getContext("2d");p.width=normalizeDecimalNumber(n),p.height=normalizeDecimalNumber(o),q.fillStyle=b.fillColor||"transparent",q.fillRect(0,0,n,o);var r=b.imageSmoothingEnabled,s=r===undefined?!0:r,t=b.imageSmoothingQuality;q.imageSmoothingEnabled=s,t&&(q.imageSmoothingQuality=t);var u=d.width,v=d.height,w=f,x=g,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0;w<=-h||w>u?(w=0,y=0,A=0,C=0):w<=0?(A=-w,w=0,y=Math.min(u,h+w),C=y):w<=u&&(A=0,y=Math.min(h,u-w),C=y),y<=0||x<=-i||x>v?(x=0,z=0,B=0,D=0):x<=0?(B=-x,x=0,z=Math.min(v,i+x),D=z):x<=v&&(B=0,z=Math.min(i,v-x),D=z);var E=[w,x,y,z];if(C>0&&D>0){var F=n/h;E.push(A*F,B*F,C*F,D*F)}return q.drawImage.apply(q,[d].concat(_toConsumableArray$1(E.map(function(a){return Math.floor(normalizeDecimalNumber(a))})))),p},setAspectRatio:function(b){var c=this.options;return!this.disabled&&!isUndefined(b)&&(c.aspectRatio=Math.max(0,b)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(b){var c=this.options,d=this.dragBox,e=this.face;if(this.loaded&&!this.disabled){var f=b===DRAG_MODE_CROP,g=c.movable&&b===DRAG_MODE_MOVE;b=f||g?b:DRAG_MODE_NONE,setData(d,DATA_ACTION,b),toggleClass(d,CLASS_CROP,f),toggleClass(d,CLASS_MOVE,g),c.cropBoxMovable||(setData(e,DATA_ACTION,b),toggleClass(e,CLASS_CROP,f),toggleClass(e,CLASS_MOVE,g))}return this}},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),AnotherCropper=global.Cropper,Cropper=function(){function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_classCallCheck(this,a);if(!b||!REGEXP_TAG_NAME.test(b.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=b,this.options=extend({},DEFAULTS,isPlainObject(c)&&c),this.complete=!1,this.cropped=!1,this.disabled=!1,this.isImg=!1,this.limited=!1,this.loaded=!1,this.ready=!1,this.replaced=!1,this.wheeling=!1,this.originalUrl="",this.canvasData=null,this.cropBoxData=null,this.previews=null,this.pointers={},this.init()}return _createClass(a,[{key:"init",value:function(){var b=this.element,c=b.tagName.toLowerCase(),d=void 0;if(getData(b,NAMESPACE))return;setData(b,NAMESPACE,this);if(c==="img"){this.isImg=!0,d=b.getAttribute("src")||"",this.originalUrl=d;if(!d)return;d=b.src}else c==="canvas"&&global.HTMLCanvasElement&&(d=b.toDataURL());this.load(d)}},{key:"load",value:function(b){var c=this;if(!b)return;this.url=b,this.imageData={};var d=this.element,e=this.options;if(!e.checkOrientation||!global.ArrayBuffer){this.clone();return}if(REGEXP_DATA_URL.test(b)){REGEXP_DATA_URL_JPEG.test(b)?this.read(dataURLToArrayBuffer(b)):this.clone();return}var f=new XMLHttpRequest;f.onerror=function(){c.clone()},f.onload=function(){c.read(f.response)},e.checkCrossOrigin&&isCrossOriginURL(b)&&d.crossOrigin&&(b=addTimestamp(b)),f.open("get",b),f.responseType="arraybuffer",f.withCredentials=d.crossOrigin==="use-credentials",f.send()}},{key:"read",value:function(b){var c=this.options,d=this.imageData,e=getOrientation(b),f=0,g=1,h=1;if(e>1){this.url=arrayBufferToDataURL(b,"image/jpeg");var i=parseOrientation(e);f=i.rotate,g=i.scaleX,h=i.scaleY}c.rotatable&&(d.rotate=f),c.scalable&&(d.scaleX=g,d.scaleY=h),this.clone()}},{key:"clone",value:function(){var b=this.element,c=this.url,d=void 0,e=void 0;this.options.checkCrossOrigin&&isCrossOriginURL(c)&&(d=b.crossOrigin,d?e=c:(d="anonymous",e=addTimestamp(c))),this.crossOrigin=d,this.crossOriginUrl=e;var f=document.createElement("img");d&&(f.crossOrigin=d),f.src=e||c;var g=proxy(this.start,this),h=proxy(this.stop,this);this.image=f,this.onStart=g,this.onStop=h,this.isImg?b.complete?this.start():addListener(b,EVENT_LOAD,g):(addListener(f,EVENT_LOAD,g),addListener(f,EVENT_ERROR,h),addClass(f,CLASS_HIDE),b.parentNode.insertBefore(f,b.nextSibling))}},{key:"start",value:function(b){var c=this,d=this.isImg?this.element:this.image;b&&(removeListener(d,EVENT_LOAD,this.onStart),removeListener(d,EVENT_ERROR,this.onStop)),getImageNaturalSizes(d,function(a,b){extend(c.imageData,{naturalWidth:a,naturalHeight:b,aspectRatio:a/b}),c.loaded=!0,c.build()})}},{key:"stop",value:function(){var b=this.image;removeListener(b,EVENT_LOAD,this.onStart),removeListener(b,EVENT_ERROR,this.onStop),b.parentNode.removeChild(b),this.image=null}},{key:"build",value:function(){var b=this;if(!this.loaded)return;this.ready&&this.unbuild();var c=this.element,d=this.options,e=this.image,f=c.parentNode,g=document.createElement("div");g.innerHTML=TEMPLATE;var h=g.querySelector("."+NAMESPACE+"-container"),i=h.querySelector("."+NAMESPACE+"-canvas"),j=h.querySelector("."+NAMESPACE+"-drag-box"),k=h.querySelector("."+NAMESPACE+"-crop-box"),l=k.querySelector("."+NAMESPACE+"-face");this.container=f,this.cropper=h,this.canvas=i,this.dragBox=j,this.cropBox=k,this.viewBox=h.querySelector("."+NAMESPACE+"-view-box"),this.face=l,i.appendChild(e),addClass(c,CLASS_HIDDEN),f.insertBefore(h,c.nextSibling),this.isImg||removeClass(e,CLASS_HIDE),this.initPreview(),this.bind(),d.aspectRatio=Math.max(0,d.aspectRatio)||NaN,d.viewMode=Math.max(0,Math.min(3,Math.round(d.viewMode)))||0,this.cropped=d.autoCrop,d.autoCrop?d.modal&&addClass(j,CLASS_MODAL):addClass(k,CLASS_HIDDEN),d.guides||addClass(k.getElementsByClassName(NAMESPACE+"-dashed"),CLASS_HIDDEN),d.center||addClass(k.getElementsByClassName(NAMESPACE+"-center"),CLASS_HIDDEN),d.background&&addClass(h,NAMESPACE+"-bg"),d.highlight||addClass(l,CLASS_INVISIBLE),d.cropBoxMovable&&(addClass(l,CLASS_MOVE),setData(l,DATA_ACTION,ACTION_ALL)),d.cropBoxResizable||(addClass(k.getElementsByClassName(NAMESPACE+"-line"),CLASS_HIDDEN),addClass(k.getElementsByClassName(NAMESPACE+"-point"),CLASS_HIDDEN)),this.setDragMode(d.dragMode),this.render(),this.ready=!0,this.setData(d.data),this.completing=setTimeout(function(){isFunction(d.ready)&&addListener(c,EVENT_READY,d.ready,{once:!0}),dispatchEvent(c,EVENT_READY),dispatchEvent(c,EVENT_CROP,b.getData()),b.complete=!0},0)}},{key:"unbuild",value:function(){if(!this.ready)return;this.complete||clearTimeout(this.completing),this.ready=!1,this.complete=!1,this.initialImageData=null,this.initialCanvasData=null,this.initialCropBoxData=null,this.containerData=null,this.canvasData=null,this.cropBoxData=null,this.unbind(),this.resetPreview(),this.previews=null,this.viewBox=null,this.cropBox=null,this.dragBox=null,this.canvas=null,this.container=null,this.cropper.parentNode.removeChild(this.cropper),this.cropper=null}}],[{key:"noConflict",value:function(){return global.Cropper=AnotherCropper,a}},{key:"setDefaults",value:function(b){extend(DEFAULTS,isPlainObject(b)&&b)}}]),a}();extend(Cropper.prototype,render,preview,events,handlers,change,methods),module.exports=Cropper