/*!
 * Cropper.js v1.1.2
 * https://github.com/fengyuanchen/cropperjs
 *
 * Copyright (c) 2015-2017 Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2017-10-18T13:27:02.189Z
 */

(function(a,b){typeof exports=="object"&&typeof module!="undefined"?module.exports=b():typeof define=="function"&&define.amd?define([],b):a.Cropper=b()})(this,function(){function V(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function X(a){return typeof a=="number"&&!W(a)}function Y(a){return typeof a=="undefined"}function Z(a){return(typeof a=="undefined"?"undefined":U(a))==="object"&&a!==null}function _(a){if(!Z(a))return!1;try{var b=a.constructor,c=b.prototype;return b&&c&&$.call(c,"isPrototypeOf")}catch(d){return!1}}function ab(a){return typeof a=="function"}function bb(a,b){if(a&&ab(b))if(Array.isArray(a)||X(a.length)){var c=a.length,d=void 0;for(d=0;d<c;d+=1)if(b.call(a,a[d],d,a)===!1)break}else Z(a)&&Object.keys(a).forEach(function(c){b.call(a,a[c],c,a)});return a}function cb(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];if(Z(a)&&c.length>0){if(Object.assign)return Object.assign.apply(Object,[a].concat(c));c.forEach(function(b){Z(b)&&Object.keys(b).forEach(function(c){a[c]=b[c]})})}return a}function db(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}}function fb(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e11;return eb.test(a)?Math.round(a*b)/b:a}function hb(a,b){var c=a.style;bb(b,function(a,b){gb.test(b)&&X(a)&&(a+="px"),c[b]=a})}function ib(a,b){return a.classList?a.classList.contains(b):a.className.indexOf(b)>-1}function jb(a,b){if(!b)return;if(X(a.length)){bb(a,function(a){jb(a,b)});return}if(a.classList){a.classList.add(b);return}var c=a.className.trim();c?c.indexOf(b)<0&&(a.className=c+" "+b):a.className=b}function kb(a,b){if(!b)return;if(X(a.length)){bb(a,function(a){kb(a,b)});return}if(a.classList){a.classList.remove(b);return}a.className.indexOf(b)>=0&&(a.className=a.className.replace(b,""))}function lb(a,b,c){if(!b)return;if(X(a.length)){bb(a,function(a){lb(a,b,c)});return}c?jb(a,b):kb(a,b)}function nb(a){return a.replace(mb,"$1-$2").toLowerCase()}function ob(a,b){return Z(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-"+nb(b))}function pb(a,b,c){Z(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-"+nb(b),c)}function qb(a,b){if(Z(a[b]))delete a[b];else if(a.dataset)try{delete a.dataset[b]}catch(c){a.dataset[b]=null}else a.removeAttribute("data-"+nb(b))}function sb(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!ab(c))return;var e=b.trim().split(rb);if(e.length>1){bb(e,function(b){sb(a,b,c)});return}ab(c.onceListener)&&(c=c.onceListener,delete c.onceListener),a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)}function tb(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!ab(c))return;var e=b.trim().split(rb);if(e.length>1){bb(e,function(b){tb(a,b,c)});return}if(d.once){var f=c,g=function h(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return sb(a,b,h),f.apply(a,d)};f.onceListener=g,c=g}a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)}function ub(a,b,c){if(a.dispatchEvent){var d=void 0;return ab(Event)&&ab(CustomEvent)?Y(c)?d=new Event(b,{bubbles:!0,cancelable:!0}):d=new CustomEvent(b,{detail:c,bubbles:!0,cancelable:!0}):Y(c)?(d=document.createEvent("Event"),d.initEvent(b,!0,!0)):(d=document.createEvent("CustomEvent"),d.initCustomEvent(b,!0,!0,c)),a.dispatchEvent(d)}return a.fireEvent?a.fireEvent("on"+b):!0}function vb(b){var c=document.documentElement,d=b.getBoundingClientRect();return{left:d.left+((a.scrollX||c&&c.scrollLeft||0)-(c&&c.clientLeft||0)),top:d.top+((a.scrollY||c&&c.scrollTop||0)-(c&&c.clientTop||0))}}function wb(a){while(a.firstChild)a.removeChild(a.firstChild)}function zb(a){var b=a.match(yb);return b&&(b[1]!==xb.protocol||b[2]!==xb.hostname||b[3]!==xb.port)}function Ab(a){var b="timestamp="+(new Date).getTime();return a+(a.indexOf("?")===-1?"?":"&")+b}function Bb(a){var b=a.rotate,c=a.scaleX,d=a.scaleY,e=a.translateX,f=a.translateY,g=[];X(e)&&e!==0&&g.push("translateX("+e+"px)"),X(f)&&f!==0&&g.push("translateY("+f+"px)"),X(b)&&b!==0&&g.push("rotate("+b+"deg)"),X(c)&&c!==1&&g.push("scaleX("+c+")"),X(d)&&d!==1&&g.push("scaleY("+d+")");var h=g.length?g.join(" "):"none";return{WebkitTransform:h,msTransform:h,transform:h}}function Eb(a,b){if(a.naturalWidth&&!Db){b(a.naturalWidth,a.naturalHeight);return}var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.src=a.src}function Fb(a){var b=cb({},a),c=[];return bb(a,function(a,d){delete b[d],bb(b,function(b){var d=Math.abs(a.startX-b.startX),e=Math.abs(a.startY-b.startY),f=Math.abs(a.endX-b.endX),g=Math.abs(a.endY-b.endY),h=Math.sqrt(d*d+e*e),i=Math.sqrt(f*f+g*g),j=(i-h)/h;c.push(j)})}),c.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),c[0]}function Gb(a,b){var c=a.pageX,d=a.pageY,e={endX:c,endY:d};return b?e:cb({startX:c,startY:d},e)}function Hb(a){var b=0,c=0,d=0;return bb(a,function(a){var e=a.startX,f=a.startY;b+=e,c+=f,d+=1}),b/=d,c/=d,{pageX:b,pageY:c}}function Jb(a){var b=a.aspectRatio,c=a.height,d=a.width,e=function(b){return Ib(b)&&b>0};return e(d)&&e(c)?c*b>d?c=d/b:d=c*b:e(d)?c=d/b:e(c)&&(d=c*b),{width:d,height:c}}function Kb(a){var b=a.width,c=a.height,d=a.degree;d=Math.abs(d);if(d%180===90)return{width:c,height:b};var e=d%90*Math.PI/180,f=Math.sin(e),g=Math.cos(e);return{width:b*g+c*f,height:b*f+c*g}}function Lb(a,b,c,d){var e=b.naturalWidth,f=b.naturalHeight,g=b.rotate,h=b.scaleX,i=b.scaleY,j=c.aspectRatio,k=c.naturalWidth,l=c.naturalHeight,m=d.fillColor,n=m===undefined?"transparent":m,o=d.imageSmoothingEnabled,p=o===undefined?!0:o,q=d.imageSmoothingQuality,r=q===undefined?"low":q,s=d.maxWidth,t=s===undefined?Infinity:s,u=d.maxHeight,v=u===undefined?Infinity:u,w=d.minWidth,x=w===undefined?0:w,y=d.minHeight,z=y===undefined?0:y,A=document.createElement("canvas"),B=A.getContext("2d"),C=Jb({aspectRatio:j,width:t,height:v}),D=Jb({aspectRatio:j,width:x,height:z}),E=Math.min(C.width,Math.max(D.width,k)),F=Math.min(C.height,Math.max(D.height,l)),G=[-e/2,-f/2,e,f];return A.width=fb(E),A.height=fb(F),B.fillStyle=n,B.fillRect(0,0,E,F),B.save(),B.translate(E/2,F/2),B.rotate(g*Math.PI/180),B.scale(h,i),B.imageSmoothingEnabled=p,B.imageSmoothingQuality=r,B.drawImage.apply(B,[a].concat(V(G.map(function(a){return Math.floor(fb(a))})))),B.restore(),A}function Nb(a,b,c){var d="",e=void 0;c+=b;for(e=b;e<c;e+=1)d+=Mb(a.getUint8(e));return d}function Pb(a){var b=a.replace(Ob,""),c=atob(b),d=new ArrayBuffer(c.length),e=new Uint8Array(d);return bb(e,function(a,b){e[b]=c.charCodeAt(b)}),d}function Qb(a,b){var c=new Uint8Array(a),d="";return bb(c,function(a){d+=Mb(a)}),"data:"+b+";base64,"+btoa(d)}function Rb(a){var b=new DataView(a),c=void 0,d=void 0,e=void 0,f=void 0;if(b.getUint8(0)===255&&b.getUint8(1)===216){var g=b.byteLength,h=2;while(h<g){if(b.getUint8(h)===255&&b.getUint8(h+1)===225){e=h;break}h+=1}}if(e){var i=e+4,j=e+10;if(Nb(b,i,4)==="Exif"){var k=b.getUint16(j);d=k===18761;if(d||k===19789)if(b.getUint16(j+2,d)===42){var l=b.getUint32(j+4,d);l>=8&&(f=j+l)}}}if(f){var m=b.getUint16(f,d),n=void 0,o=void 0;for(o=0;o<m;o+=1){n=f+o*12+2;if(b.getUint16(n,d)===274){n+=8,c=b.getUint16(n,d),b.setUint16(n,1,d);break}}}return c}function Sb(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=90,d=-1;break;case 6:b=90;break;case 7:b=90,c=-1;break;case 8:b=-90;break;default:}return{rotate:b,scaleX:c,scaleY:d}}function Yb(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function _b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var a=typeof window!="undefined"?window:{},b="cropper",c="all",d="crop",e="move",f="zoom",g="e",h="w",i="s",j="n",k="ne",l="nw",m="se",n="sw",o=b+"-crop",p=b+"-disabled",q=b+"-hidden",r=b+"-hide",s=b+"-invisible",t=b+"-modal",u=b+"-move",v="action",w="preview",x="crop",y="move",z="none",A="crop",B="cropend",C="cropmove",D="cropstart",E="dblclick",F="error",G="load",H=a.PointerEvent?"pointerdown":"touchstart mousedown",I=a.PointerEvent?"pointermove":"touchmove mousemove",J=a.PointerEvent?" pointerup pointercancel":"touchend touchcancel mouseup",K="ready",L="resize",M="wheel mousewheel DOMMouseScroll",N="zoom",O=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,P=/^data:/,Q=/^data:image\/jpeg;base64,/,R=/^(img|canvas)$/i,S={viewMode:0,dragMode:x,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},T='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',U=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},W=Number.isNaN||a.isNaN,$=Object.prototype.hasOwnProperty,eb=/\.\d*(?:0|9){12}\d*$/i,gb=/^(width|height|left|top|marginLeft|marginTop)$/,mb=/([a-z\d])([A-Z])/g,rb=/\s+/,xb=a.location,yb=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,Cb=a.navigator,Db=Cb&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(Cb.userAgent),Ib=Number.isFinite||a.isFinite,Mb=String.fromCharCode,Ob=/^data:.*,/,Tb={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var b=this.element,c=this.options,d=this.container,e=this.cropper;jb(e,q),kb(b,q);var f={width:Math.max(d.offsetWidth,Number(c.minContainerWidth)||200),height:Math.max(d.offsetHeight,Number(c.minContainerHeight)||100)};this.containerData=f,hb(e,{width:f.width,height:f.height}),jb(b,q),kb(e,q)},initCanvas:function(){var b=this.containerData,c=this.imageData,d=this.options.viewMode,e=Math.abs(c.rotate)%180===90,f=e?c.naturalHeight:c.naturalWidth,g=e?c.naturalWidth:c.naturalHeight,h=f/g,i=b.width,j=b.height;b.height*h>b.width?d===3?i=b.height*h:j=b.width/h:d===3?j=b.width/h:i=b.height*h;var k={aspectRatio:h,naturalWidth:f,naturalHeight:g,width:i,height:j};k.left=(b.width-i)/2,k.top=(b.height-j)/2,k.oldLeft=k.left,k.oldTop=k.top,this.canvasData=k,this.limited=d===1||d===2,this.limitCanvas(!0,!0),this.initialImageData=cb({},c),this.initialCanvasData=cb({},k)},limitCanvas:function(b,c){var d=this.options,e=this.containerData,f=this.canvasData,g=this.cropBoxData,h=d.viewMode,i=f.aspectRatio,j=this.cropped&&g;if(b){var k=Number(d.minCanvasWidth)||0,l=Number(d.minCanvasHeight)||0;h>1?(k=Math.max(k,e.width),l=Math.max(l,e.height),h===3&&(l*i>k?k=l*i:l=k/i)):h>0&&(k?k=Math.max(k,j?g.width:0):l?l=Math.max(l,j?g.height:0):j&&(k=g.width,l=g.height,l*i>k?k=l*i:l=k/i));var m=Jb({aspectRatio:i,width:k,height:l});k=m.width,l=m.height,f.minWidth=k,f.minHeight=l,f.maxWidth=Infinity,f.maxHeight=Infinity}if(c)if(h){var n=e.width-f.width,o=e.height-f.height;f.minLeft=Math.min(0,n),f.minTop=Math.min(0,o),f.maxLeft=Math.max(0,n),f.maxTop=Math.max(0,o),j&&this.limited&&(f.minLeft=Math.min(g.left,g.left+(g.width-f.width)),f.minTop=Math.min(g.top,g.top+(g.height-f.height)),f.maxLeft=g.left,f.maxTop=g.top,h===2&&(f.width>=e.width&&(f.minLeft=Math.min(0,n),f.maxLeft=Math.max(0,n)),f.height>=e.height&&(f.minTop=Math.min(0,o),f.maxTop=Math.max(0,o))))}else f.minLeft=-f.width,f.minTop=-f.height,f.maxLeft=e.width,f.maxTop=e.height},renderCanvas:function(b,c){var d=this.canvasData,e=this.imageData;if(c){var f=Kb({width:e.naturalWidth*Math.abs(e.scaleX),height:e.naturalHeight*Math.abs(e.scaleY),degree:e.rotate}),g=f.width,h=f.height,i=d.width*(g/d.naturalWidth),j=d.height*(h/d.naturalHeight);d.left-=(i-d.width)/2,d.top-=(j-d.height)/2,d.width=i,d.height=j,d.aspectRatio=g/h,d.naturalWidth=g,d.naturalHeight=h,this.limitCanvas(!0,!1)}if(d.width>d.maxWidth||d.width<d.minWidth)d.left=d.oldLeft;if(d.height>d.maxHeight||d.height<d.minHeight)d.top=d.oldTop;d.width=Math.min(Math.max(d.width,d.minWidth),d.maxWidth),d.height=Math.min(Math.max(d.height,d.minHeight),d.maxHeight),this.limitCanvas(!1,!0),d.left=Math.min(Math.max(d.left,d.minLeft),d.maxLeft),d.top=Math.min(Math.max(d.top,d.minTop),d.maxTop),d.oldLeft=d.left,d.oldTop=d.top,hb(this.canvas,cb({width:d.width,height:d.height},Bb({translateX:d.left,translateY:d.top}))),this.renderImage(b),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(b){var c=this.canvasData,d=this.imageData,e=d.naturalWidth*(c.width/c.naturalWidth),f=d.naturalHeight*(c.height/c.naturalHeight);cb(d,{width:e,height:f,left:(c.width-e)/2,top:(c.height-f)/2}),hb(this.image,cb({width:d.width,height:d.height},Bb(cb({translateX:d.left,translateY:d.top},d)))),b&&this.output()},initCropBox:function(){var b=this.options,c=this.canvasData,d=b.aspectRatio,e=Number(b.autoCropArea)||.8,f={width:c.width,height:c.height};d&&(c.height*d>c.width?f.height=f.width/d:f.width=f.height*d),this.cropBoxData=f,this.limitCropBox(!0,!0),f.width=Math.min(Math.max(f.width,f.minWidth),f.maxWidth),f.height=Math.min(Math.max(f.height,f.minHeight),f.maxHeight),f.width=Math.max(f.minWidth,f.width*e),f.height=Math.max(f.minHeight,f.height*e),f.left=c.left+(c.width-f.width)/2,f.top=c.top+(c.height-f.height)/2,f.oldLeft=f.left,f.oldTop=f.top,this.initialCropBoxData=cb({},f)},limitCropBox:function(b,c){var d=this.options,e=this.containerData,f=this.canvasData,g=this.cropBoxData,h=this.limited,i=d.aspectRatio;if(b){var j=Number(d.minCropBoxWidth)||0,k=Number(d.minCropBoxHeight)||0,l=Math.min(e.width,h?f.width:e.width),m=Math.min(e.height,h?f.height:e.height);j=Math.min(j,e.width),k=Math.min(k,e.height),i&&(j&&k?k*i>j?k=j/i:j=k*i:j?k=j/i:k&&(j=k*i),m*i>l?m=l/i:l=m*i),g.minWidth=Math.min(j,l),g.minHeight=Math.min(k,m),g.maxWidth=l,g.maxHeight=m}c&&(h?(g.minLeft=Math.max(0,f.left),g.minTop=Math.max(0,f.top),g.maxLeft=Math.min(e.width,f.left+f.width)-g.width,g.maxTop=Math.min(e.height,f.top+f.height)-g.height):(g.minLeft=0,g.minTop=0,g.maxLeft=e.width-g.width,g.maxTop=e.height-g.height))},renderCropBox:function(){var b=this.options,d=this.containerData,f=this.cropBoxData;if(f.width>f.maxWidth||f.width<f.minWidth)f.left=f.oldLeft;if(f.height>f.maxHeight||f.height<f.minHeight)f.top=f.oldTop;f.width=Math.min(Math.max(f.width,f.minWidth),f.maxWidth),f.height=Math.min(Math.max(f.height,f.minHeight),f.maxHeight),this.limitCropBox(!1,!0),f.left=Math.min(Math.max(f.left,f.minLeft),f.maxLeft),f.top=Math.min(Math.max(f.top,f.minTop),f.maxTop),f.oldLeft=f.left,f.oldTop=f.top,b.movable&&b.cropBoxMovable&&pb(this.face,v,f.width>=d.width&&f.height>=d.height?e:c),hb(this.cropBox,cb({width:f.width,height:f.height},Bb({translateX:f.left,translateY:f.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete&&ub(this.element,A,this.getData())}},Ub={initPreview:function(){var b=this.crossOrigin,c=this.options.preview,d=b?this.crossOriginUrl:this.url,e=document.createElement("img");b&&(e.crossOrigin=b),e.src=d,this.viewBox.appendChild(e),this.image2=e;if(!c)return;var f=c.querySelector?[c]:document.querySelectorAll(c);this.previews=f,bb(f,function(a){var c=document.createElement("img");pb(a,w,{width:a.offsetWidth,height:a.offsetHeight,html:a.innerHTML}),b&&(c.crossOrigin=b),c.src=d,c.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',wb(a),a.appendChild(c)})},resetPreview:function(){bb(this.previews,function(a){var b=ob(a,w);hb(a,{width:b.width,height:b.height}),a.innerHTML=b.html,qb(a,w)})},preview:function(){var b=this.imageData,c=this.canvasData,d=this.cropBoxData,e=d.width,f=d.height,g=b.width,h=b.height,i=d.left-c.left-b.left,j=d.top-c.top-b.top;if(!this.cropped||this.disabled)return;hb(this.image2,cb({width:g,height:h},Bb(cb({translateX:-i,translateY:-j},b)))),bb(this.previews,function(a){var c=ob(a,w),d=c.width,k=c.height,l=d,m=k,n=1;e&&(n=d/e,m=f*n),f&&m>k&&(n=k/f,l=e*n,m=k),hb(a,{width:l,height:m}),hb(a.getElementsByTagName("img")[0],cb({width:g*n,height:h*n},Bb(cb({translateX:-i*n,translateY:-j*n},b))))})}},Vb={bind:function(){var c=this.element,d=this.options,e=this.cropper;ab(d.cropstart)&&tb(c,D,d.cropstart),ab(d.cropmove)&&tb(c,C,d.cropmove),ab(d.cropend)&&tb(c,B,d.cropend),ab(d.crop)&&tb(c,A,d.crop),ab(d.zoom)&&tb(c,N,d.zoom),tb(e,H,this.onCropStart=db(this.cropStart,this)),d.zoomable&&d.zoomOnWheel&&tb(e,M,this.onWheel=db(this.wheel,this)),d.toggleDragModeOnDblclick&&tb(e,E,this.onDblclick=db(this.dblclick,this)),tb(document,I,this.onCropMove=db(this.cropMove,this)),tb(document,J,this.onCropEnd=db(this.cropEnd,this)),d.responsive&&tb(a,L,this.onResize=db(this.resize,this))},unbind:function(){var c=this.element,d=this.options,e=this.cropper;ab(d.cropstart)&&sb(c,D,d.cropstart),ab(d.cropmove)&&sb(c,C,d.cropmove),ab(d.cropend)&&sb(c,B,d.cropend),ab(d.crop)&&sb(c,A,d.crop),ab(d.zoom)&&sb(c,N,d.zoom),sb(e,H,this.onCropStart),d.zoomable&&d.zoomOnWheel&&sb(e,M,this.onWheel),d.toggleDragModeOnDblclick&&sb(e,E,this.onDblclick),sb(document,I,this.onCropMove),sb(document,J,this.onCropEnd),d.responsive&&sb(a,L,this.onResize)}},Wb={resize:function(){var b=this.options,c=this.container,d=this.containerData,e=Number(b.minContainerWidth)||200,f=Number(b.minContainerHeight)||100;if(this.disabled||d.width<=e||d.height<=f)return;var g=c.offsetWidth/d.width;if(g!==1||c.offsetHeight!==d.height){var h=void 0,i=void 0;b.restore&&(h=this.getCanvasData(),i=this.getCropBoxData()),this.render(),b.restore&&(this.setCanvasData(bb(h,function(a,b){h[b]=a*g})),this.setCropBoxData(bb(i,function(a,b){i[b]=a*g})))}},dblclick:function(){if(this.disabled||this.options.dragMode===z)return;this.setDragMode(ib(this.dragBox,o)?y:x)},wheel:function(b){var c=this,d=Number(this.options.wheelZoomRatio)||.1,e=1;if(this.disabled)return;b.preventDefault();if(this.wheeling)return;this.wheeling=!0,setTimeout(function(){c.wheeling=!1},50),b.deltaY?e=b.deltaY>0?1:-1:b.wheelDelta?e=-b.wheelDelta/120:b.detail&&(e=b.detail>0?1:-1),this.zoom(-e*d,b)},cropStart:function(b){if(this.disabled)return;var c=this.options,e=this.pointers,g=void 0;b.changedTouches?bb(b.changedTouches,function(a){e[a.identifier]=Gb(a)}):e[b.pointerId||0]=Gb(b),Object.keys(e).length>1&&c.zoomable&&c.zoomOnTouch?g=f:g=ob(b.target,v);if(!O.test(g))return;if(ub(this.element,D,{originalEvent:b,action:g})===!1)return;b.preventDefault(),this.action=g,this.cropping=!1,g===d&&(this.cropping=!0,jb(this.dragBox,t))},cropMove:function(b){var c=this.action;if(this.disabled||!c)return;var d=this.pointers;b.preventDefault();if(ub(this.element,C,{originalEvent:b,action:c})===!1)return;b.changedTouches?bb(b.changedTouches,function(a){cb(d[a.identifier],Gb(a,!0))}):cb(d[b.pointerId||0],Gb(b,!0)),this.change(b)},cropEnd:function(b){if(this.disabled)return;var c=this.action,d=this.pointers;b.changedTouches?bb(b.changedTouches,function(a){delete d[a.identifier]}):delete d[b.pointerId||0];if(!c)return;b.preventDefault(),Object.keys(d).length||(this.action=""),this.cropping&&(this.cropping=!1,lb(this.dragBox,t,this.cropped&&this.options.modal)),ub(this.element,B,{originalEvent:b,action:c})}},Xb={change:function(b){var o=this.options,p=this.canvasData,r=this.containerData,s=this.cropBoxData,t=this.pointers,u=this.action,v=o.aspectRatio,w=s.left,x=s.top,y=s.width,z=s.height,A=w+y,B=x+z,C=0,D=0,E=r.width,F=r.height,G=!0,H=void 0;!v&&b.shiftKey&&(v=y&&z?y/z:1),this.limited&&(C=s.minLeft,D=s.minTop,E=C+Math.min(r.width,p.width,p.left+p.width),F=D+Math.min(r.height,p.height,p.top+p.height));var I=t[Object.keys(t)[0]],J={x:I.endX-I.startX,y:I.endY-I.startY},K=function(b){switch(b){case g:A+J.x>E&&(J.x=E-A);break;case h:w+J.x<C&&(J.x=C-w);break;case j:x+J.y<D&&(J.y=D-x);break;case i:B+J.y>F&&(J.y=F-B);break;default:}};switch(u){case c:w+=J.x,x+=J.y;break;case g:if(J.x>=0&&(A>=E||v&&(x<=D||B>=F))){G=!1;break}K(g),y+=J.x,v&&(z=y/v,x-=J.x/v/2),y<0&&(u=h,y=0);break;case j:if(J.y<=0&&(x<=D||v&&(w<=C||A>=E))){G=!1;break}K(j),z-=J.y,x+=J.y,v&&(y=z*v,w+=J.y*v/2),z<0&&(u=i,z=0);break;case h:if(J.x<=0&&(w<=C||v&&(x<=D||B>=F))){G=!1;break}K(h),y-=J.x,w+=J.x,v&&(z=y/v,x+=J.x/v/2),y<0&&(u=g,y=0);break;case i:if(J.y>=0&&(B>=F||v&&(w<=C||A>=E))){G=!1;break}K(i),z+=J.y,v&&(y=z*v,w-=J.y*v/2),z<0&&(u=j,z=0);break;case k:if(v){if(J.y<=0&&(x<=D||A>=E)){G=!1;break}K(j),z-=J.y,x+=J.y,y=z*v}else K(j),K(g),J.x>=0?A<E?y+=J.x:J.y<=0&&x<=D&&(G=!1):y+=J.x,J.y<=0?x>D&&(z-=J.y,x+=J.y):(z-=J.y,x+=J.y);y<0&&z<0?(u=n,z=0,y=0):y<0?(u=l,y=0):z<0&&(u=m,z=0);break;case l:if(v){if(J.y<=0&&(x<=D||w<=C)){G=!1;break}K(j),z-=J.y,x+=J.y,y=z*v,w+=J.y*v}else K(j),K(h),J.x<=0?w>C?(y-=J.x,w+=J.x):J.y<=0&&x<=D&&(G=!1):(y-=J.x,w+=J.x),J.y<=0?x>D&&(z-=J.y,x+=J.y):(z-=J.y,x+=J.y);y<0&&z<0?(u=m,z=0,y=0):y<0?(u=k,y=0):z<0&&(u=n,z=0);break;case n:if(v){if(J.x<=0&&(w<=C||B>=F)){G=!1;break}K(h),y-=J.x,w+=J.x,z=y/v}else K(i),K(h),J.x<=0?w>C?(y-=J.x,w+=J.x):J.y>=0&&B>=F&&(G=!1):(y-=J.x,w+=J.x),J.y>=0?B<F&&(z+=J.y):z+=J.y;y<0&&z<0?(u=k,z=0,y=0):y<0?(u=m,y=0):z<0&&(u=l,z=0);break;case m:if(v){if(J.x>=0&&(A>=E||B>=F)){G=!1;break}K(g),y+=J.x,z=y/v}else K(i),K(g),J.x>=0?A<E?y+=J.x:J.y>=0&&B>=F&&(G=!1):y+=J.x,J.y>=0?B<F&&(z+=J.y):z+=J.y;y<0&&z<0?(u=l,z=0,y=0):y<0?(u=n,y=0):z<0&&(u=k,z=0);break;case e:this.move(J.x,J.y),G=!1;break;case f:this.zoom(Fb(t),b),G=!1;break;case d:if(!J.x||!J.y){G=!1;break}H=vb(this.cropper),w=I.startX-H.left,x=I.startY-H.top,y=s.minWidth,z=s.minHeight,J.x>0?u=J.y>0?m:k:J.x<0&&(w-=y,u=J.y>0?n:l),J.y<0&&(x-=z),this.cropped||(kb(this.cropBox,q),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break;default:}G&&(s.width=y,s.height=z,s.left=w,s.top=x,this.action=u,this.renderCropBox()),bb(t,function(a){a.startX=a.endX,a.startY=a.endY})}},Zb={crop:function(){return this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&jb(this.dragBox,t),kb(this.cropBox,q)),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=cb({},this.initialImageData),this.canvasData=cb({},this.initialCanvasData),this.cropBoxData=cb({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(cb(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),kb(this.dragBox,t),jb(this.cropBox,q)),this},replace:function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return!this.disabled&&b&&(this.isImg&&(this.element.src=b),c?(this.url=b,this.image.src=b,this.ready&&(this.image2.src=b,bb(this.previews,function(a){a.getElementsByTagName("img")[0].src=b}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(b))),this},enable:function(){return this.ready&&(this.disabled=!1,kb(this.cropper,p)),this},disable:function(){return this.ready&&(this.disabled=!0,jb(this.cropper,p)),this},destroy:function(){var c=this.element,d=this.image;return this.loaded?(this.isImg&&this.replaced&&(c.src=this.originalUrl),this.unbuild(),kb(c,q)):this.isImg?sb(c,G,this.onStart):d&&d.parentNode.removeChild(d),qb(c,b),this},move:function(b,c){var d=this.canvasData,e=d.left,f=d.top;return this.moveTo(Y(b)?b:e+Number(b),Y(c)?c:f+Number(c))},moveTo:function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:b,d=this.canvasData,e=!1;return b=Number(b),c=Number(c),this.ready&&!this.disabled&&this.options.movable&&(X(b)&&(d.left=b,e=!0),X(c)&&(d.top=c,e=!0),e&&this.renderCanvas(!0)),this},zoom:function(b,c){var d=this.canvasData;return b=Number(b),b<0?b=1/(1-b):b=1+b,this.zoomTo(d.width*b/d.naturalWidth,c)},zoomTo:function(b,c){var d=this.options,e=this.canvasData,f=e.width,g=e.height,h=e.naturalWidth,i=e.naturalHeight;b=Number(b);if(b>=0&&this.ready&&!this.disabled&&d.zoomable){var j=h*b,k=i*b;if(ub(this.element,N,{originalEvent:c,oldRatio:f/h,ratio:j/h})===!1)return this;if(c){var l=this.pointers,m=vb(this.cropper),n=l&&Object.keys(l).length?Hb(l):{pageX:c.pageX,pageY:c.pageY};e.left-=(j-f)*((n.pageX-m.left-e.left)/f),e.top-=(k-g)*((n.pageY-m.top-e.top)/g)}else e.left-=(j-f)/2,e.top-=(k-g)/2;e.width=j,e.height=k,this.renderCanvas(!0)}return this},rotate:function(b){return this.rotateTo((this.imageData.rotate||0)+Number(b))},rotateTo:function(b){return b=Number(b),X(b)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=b%360,this.renderCanvas(!0,!0)),this},scaleX:function(b){var c=this.imageData.scaleY;return this.scale(b,X(c)?c:1)},scaleY:function(b){var c=this.imageData.scaleX;return this.scale(X(c)?c:1,b)},scale:function(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:b,d=this.imageData,e=!1;return b=Number(b),c=Number(c),this.ready&&!this.disabled&&this.options.scalable&&(X(b)&&(d.scaleX=b,e=!0),X(c)&&(d.scaleY=c,e=!0),e&&this.renderCanvas(!0,!0)),this},getData:function(){var b=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,c=this.options,d=this.imageData,e=this.canvasData,f=this.cropBoxData,g=void 0;if(this.ready&&this.cropped){g={x:f.left-e.left,y:f.top-e.top,width:f.width,height:f.height};var h=d.width/d.naturalWidth;bb(g,function(a,c){a/=h,g[c]=b?Math.round(a):a})}else g={x:0,y:0,width:0,height:0};return c.rotatable&&(g.rotate=d.rotate||0),c.scalable&&(g.scaleX=d.scaleX||1,g.scaleY=d.scaleY||1),g},setData:function(b){var c=this.options,d=this.imageData,e=this.canvasData,f={};ab(b)&&(b=b.call(this.element));if(this.ready&&!this.disabled&&_(b)){var g=!1;c.rotatable&&X(b.rotate)&&b.rotate!==d.rotate&&(d.rotate=b.rotate,g=!0),c.scalable&&(X(b.scaleX)&&b.scaleX!==d.scaleX&&(d.scaleX=b.scaleX,g=!0),X(b.scaleY)&&b.scaleY!==d.scaleY&&(d.scaleY=b.scaleY,g=!0)),g&&this.renderCanvas(!0,!0);var h=d.width/d.naturalWidth;X(b.x)&&(f.left=b.x*h+e.left),X(b.y)&&(f.top=b.y*h+e.top),X(b.width)&&(f.width=b.width*h),X(b.height)&&(f.height=b.height*h),this.setCropBoxData(f)}return this},getContainerData:function(){return this.ready?cb({},this.containerData):{}},getImageData:function(){return this.loaded?cb({},this.imageData):{}},getCanvasData:function(){var b=this.canvasData,c={};return this.ready&&bb(["left","top","width","height","naturalWidth","naturalHeight"],function(a){c[a]=b[a]}),c},setCanvasData:function(b){var c=this.canvasData,d=c.aspectRatio;return ab(b)&&(b=b.call(this.element)),this.ready&&!this.disabled&&_(b)&&(X(b.left)&&(c.left=b.left),X(b.top)&&(c.top=b.top),X(b.width)?(c.width=b.width,c.height=b.width/d):X(b.height)&&(c.height=b.height,c.width=b.height*d),this.renderCanvas(!0)),this},getCropBoxData:function(){var b=this.cropBoxData,c=void 0;return this.ready&&this.cropped&&(c={left:b.left,top:b.top,width:b.width,height:b.height}),c||{}},setCropBoxData:function(b){var c=this.cropBoxData,d=this.options.aspectRatio,e=void 0,f=void 0;return ab(b)&&(b=b.call(this.element)),this.ready&&this.cropped&&!this.disabled&&_(b)&&(X(b.left)&&(c.left=b.left),X(b.top)&&(c.top=b.top),X(b.width)&&b.width!==c.width&&(e=!0,c.width=b.width),X(b.height)&&b.height!==c.height&&(f=!0,c.height=b.height),d&&(e?c.height=c.width/d:f&&(c.width=c.height*d)),this.renderCropBox()),this},getCroppedCanvas:function(){var c=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.ready||!a.HTMLCanvasElement)return null;var d=this.canvasData,e=Lb(this.image,this.imageData,d,c);if(!this.cropped)return e;var f=this.getData(),g=f.x,h=f.y,i=f.width,j=f.height,k=i/j,l=Jb({aspectRatio:k,width:c.maxWidth||Infinity,height:c.maxHeight||Infinity}),m=Jb({aspectRatio:k,width:c.minWidth||0,height:c.minHeight||0}),n=Jb({aspectRatio:k,width:c.width||i,height:c.height||j}),o=n.width,p=n.height;o=Math.min(l.width,Math.max(m.width,o)),p=Math.min(l.height,Math.max(m.height,p));var q=document.createElement("canvas"),r=q.getContext("2d");q.width=fb(o),q.height=fb(p),r.fillStyle=c.fillColor||"transparent",r.fillRect(0,0,o,p);var s=c.imageSmoothingEnabled,t=s===undefined?!0:s,u=c.imageSmoothingQuality;r.imageSmoothingEnabled=t,u&&(r.imageSmoothingQuality=u);var v=e.width,w=e.height,x=g,y=h,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0,E=void 0;x<=-i||x>v?(x=0,z=0,B=0,D=0):x<=0?(B=-x,x=0,z=Math.min(v,i+x),D=z):x<=v&&(B=0,z=Math.min(i,v-x),D=z),z<=0||y<=-j||y>w?(y=0,A=0,C=0,E=0):y<=0?(C=-y,y=0,A=Math.min(w,j+y),E=A):y<=w&&(C=0,A=Math.min(j,w-y),E=A);var F=[x,y,z,A];if(D>0&&E>0){var G=o/i;F.push(B*G,C*G,D*G,E*G)}return r.drawImage.apply(r,[e].concat(Yb(F.map(function(a){return Math.floor(fb(a))})))),q},setAspectRatio:function(b){var c=this.options;return!this.disabled&&!Y(b)&&(c.aspectRatio=Math.max(0,b)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(b){var c=this.options,d=this.dragBox,e=this.face;if(this.loaded&&!this.disabled){var f=b===x,g=c.movable&&b===y;b=f||g?b:z,pb(d,v,b),lb(d,o,f),lb(d,u,g),c.cropBoxMovable||(pb(e,v,b),lb(e,o,f),lb(e,u,g))}return this}},$b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ac=a.Cropper,bc=function(){function d(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};_b(this,d);if(!a||!R.test(a.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=a,this.options=cb({},S,_(b)&&b),this.complete=!1,this.cropped=!1,this.disabled=!1,this.isImg=!1,this.limited=!1,this.loaded=!1,this.ready=!1,this.replaced=!1,this.wheeling=!1,this.originalUrl="",this.canvasData=null,this.cropBoxData=null,this.previews=null,this.pointers={},this.init()}return $b(d,[{key:"init",value:function(){var d=this.element,e=d.tagName.toLowerCase(),f=void 0;if(ob(d,b))return;pb(d,b,this);if(e==="img"){this.isImg=!0,f=d.getAttribute("src")||"",this.originalUrl=f;if(!f)return;f=d.src}else e==="canvas"&&a.HTMLCanvasElement&&(f=d.toDataURL());this.load(f)}},{key:"load",value:function(c){var d=this;if(!c)return;this.url=c,this.imageData={};var e=this.element,f=this.options;if(!f.checkOrientation||!a.ArrayBuffer){this.clone();return}if(P.test(c)){Q.test(c)?this.read(Pb(c)):this.clone();return}var g=new XMLHttpRequest;g.onerror=function(){d.clone()},g.onload=function(){d.read(g.response)},f.checkCrossOrigin&&zb(c)&&e.crossOrigin&&(c=Ab(c)),g.open("get",c),g.responseType="arraybuffer",g.withCredentials=e.crossOrigin==="use-credentials",g.send()}},{key:"read",value:function(b){var c=this.options,d=this.imageData,e=Rb(b),f=0,g=1,h=1;if(e>1){this.url=Qb(b,"image/jpeg");var i=Sb(e);f=i.rotate,g=i.scaleX,h=i.scaleY}c.rotatable&&(d.rotate=f),c.scalable&&(d.scaleX=g,d.scaleY=h),this.clone()}},{key:"clone",value:function(){var b=this.element,c=this.url,d=void 0,e=void 0;this.options.checkCrossOrigin&&zb(c)&&(d=b.crossOrigin,d?e=c:(d="anonymous",e=Ab(c))),this.crossOrigin=d,this.crossOriginUrl=e;var f=document.createElement("img");d&&(f.crossOrigin=d),f.src=e||c;var g=db(this.start,this),h=db(this.stop,this);this.image=f,this.onStart=g,this.onStop=h,this.isImg?b.complete?this.start():tb(b,G,g):(tb(f,G,g),tb(f,F,h),jb(f,r),b.parentNode.insertBefore(f,b.nextSibling))}},{key:"start",value:function(b){var c=this,d=this.isImg?this.element:this.image;b&&(sb(d,G,this.onStart),sb(d,F,this.onStop)),Eb(d,function(a,b){cb(c.imageData,{naturalWidth:a,naturalHeight:b,aspectRatio:a/b}),c.loaded=!0,c.build()})}},{key:"stop",value:function(){var b=this.image;sb(b,G,this.onStart),sb(b,F,this.onStop),b.parentNode.removeChild(b),this.image=null}},{key:"build",value:function(){var d=this;if(!this.loaded)return;this.ready&&this.unbuild();var e=this.element,f=this.options,g=this.image,h=e.parentNode,i=document.createElement("div");i.innerHTML=T;var j=i.querySelector("."+b+"-container"),k=j.querySelector("."+b+"-canvas"),l=j.querySelector("."+b+"-drag-box"),m=j.querySelector("."+b+"-crop-box"),n=m.querySelector("."+b+"-face");this.container=h,this.cropper=j,this.canvas=k,this.dragBox=l,this.cropBox=m,this.viewBox=j.querySelector("."+b+"-view-box"),this.face=n,k.appendChild(g),jb(e,q),h.insertBefore(j,e.nextSibling),this.isImg||kb(g,r),this.initPreview(),this.bind(),f.aspectRatio=Math.max(0,f.aspectRatio)||NaN,f.viewMode=Math.max(0,Math.min(3,Math.round(f.viewMode)))||0,this.cropped=f.autoCrop,f.autoCrop?f.modal&&jb(l,t):jb(m,q),f.guides||jb(m.getElementsByClassName(b+"-dashed"),q),f.center||jb(m.getElementsByClassName(b+"-center"),q),f.background&&jb(j,b+"-bg"),f.highlight||jb(n,s),f.cropBoxMovable&&(jb(n,u),pb(n,v,c)),f.cropBoxResizable||(jb(m.getElementsByClassName(b+"-line"),q),jb(m.getElementsByClassName(b+"-point"),q)),this.setDragMode(f.dragMode),this.render(),this.ready=!0,this.setData(f.data),this.completing=setTimeout(function(){ab(f.ready)&&tb(e,K,f.ready,{once:!0}),ub(e,K),ub(e,A,d.getData()),d.complete=!0},0)}},{key:"unbuild",value:function(){if(!this.ready)return;this.complete||clearTimeout(this.completing),this.ready=!1,this.complete=!1,this.initialImageData=null,this.initialCanvasData=null,this.initialCropBoxData=null,this.containerData=null,this.canvasData=null,this.cropBoxData=null,this.unbind(),this.resetPreview(),this.previews=null,this.viewBox=null,this.cropBox=null,this.dragBox=null,this.canvas=null,this.container=null,this.cropper.parentNode.removeChild(this.cropper),this.cropper=null}}],[{key:"noConflict",value:function(){return a.Cropper=ac,d}},{key:"setDefaults",value:function(b){cb(S,_(b)&&b)}}]),d}();return cb(bc.prototype,Tb,Ub,Vb,Wb,Xb,Zb),bc})