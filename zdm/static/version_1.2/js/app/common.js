define(["jquery","layer","laydate"],function(a,b,c){function d(c,d,e,f,g){a.ajax({type:c,url:d,data:e,dataType:f||"JSON",success:function(a){a.success!="true"?b.msg(a.errorMsg||"操作失败"):g(a)}})}function e(a){var b=a.attr("data-value"),c=a.find("span").html(),d=a.parent().parent().parent();d.find("input").val(b),d.find(".Z-select-selected").find("span").html(c),d.trigger("blur"),a.attr("data-selected",""),a.siblings("li").removeAttr("data-selected")}function f(){a("body").on("focus","[data-z-select]",function(){a(this).find(".Z-select-list").show()}),a("body").on("blur","[data-z-select]",function(){a(this).find(".Z-select-list").hide()}),a("body").on("click","[data-z-select] li",function(){e(a(this))})}function g(a,b){var d={elem:a||"#start",format:"YYYY-MM-DD hh:mm:ss",min:"1970-01-1 23:59:59",max:"2099-06-16 23:59:59",istime:!0,istoday:!1,choose:function(a){e.min=a,e.start=a}},e={elem:b||"#end",format:"YYYY-MM-DD hh:mm:ss",min:"1970-01-1 23:59:59",max:"2099-06-16 23:59:59",istime:!0,istoday:!1,choose:function(a){d.max=a}};c(d),c(e)}function h(a,c,e,f){var a=a||"您确定吗？";b.confirm(a,{bth:["确定","取消"]},function(){f?f():d("post",c,e,"JSON",function(){b.msg("操作成功",function(){window.location.reload()})})})}function i(a,c,d,e,f){b.open({type:1,title:a,scrollbar:!0,area:[c,d],content:e,success:f})}function j(){a("body").on("click","[data-delete]",function(){a(this).parent().remove()})}function k(c,d,e,f){var g="http://zdm.jiguo.com/admin2/ajax/upload",h=new XMLHttpRequest;h.open("POST",g),h.send(c),h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){var c=JSON.parse(h.responseText);if(c.success!="true")b.msg(c.errorMsg);else{a("#imgLoading").remove();if(f){var g='<li><img src="'+c.result.url+'"><span data-delete>x</span><div class="Z-cover-hover">封面</div><input type="hidden" name="'+e+'" value="'+c.result.fileid+'"></li>';d.append(g)}else{var g='<li><img src="'+c.result.url+'"><span data-delete>x</span><input type="hidden" name="'+e+'" value="'+c.result.fileid+'"></li>';d.html(g)}j()}}}}function l(c,d,e){var f="http://zdm.jiguo.com/admin2/ajax/multipleupload",g=new XMLHttpRequest;g.open("POST",f),g.send(c),g.onreadystatechange=function(){if(g.readyState==4&&g.status==200){var c=JSON.parse(g.responseText);if(c.success!="true")b.msg(c.errorMsg);else{for(var f=0;f<c.result.length;f++){a("#imgLoading").remove();var h='<li><img src="'+c.result[f].url+'"><span data-delete>x</span><div class="Z-cover-hover">封面</div><input type="hidden" name="'+e+'" value="'+c.result[f].fileid+'"></li>';d.append(h)}j()}}}}function m(b,c,d){a("#"+b+"").find("input").change(function(){var b=a(this)[0].files;if(b.length<=0)return;var e='<li id="imgLoading"><img src="http://cdn.jiguo.com/p1/i/loading-icon.gif" class="img-loading"></li>',f=a(this).parent().prev();d?f.append(e):f.html(e);var g=new FormData;g.append("file",b[0]),k(g,f,c,d)})}function n(b,c){a("#"+b+"").find("input").change(function(){var b=this,d=a(b).parent().prev(),e=new FormData,f=a(this)[0].files;if(f.length<=0)return;a(f).each(function(b){var c='<li id="imgLoading"><img src="http://cdn.jiguo.com/p1/i/loading-icon.gif" class="img-loading"></li>';d.append(c),e.append("file"+b,a(this)[0])}),l(e,d,c)})}function o(){a("body").on("click",".Z-cover-hover",function(){a(this).addClass("Z-block").next().attr("name","product[cover]").attr("data-cover",""),a(this).parent().siblings().find(".Z-cover-hover").removeClass("Z-block").next().attr("name","product[pic][]").removeAttr("data-cover")})}return{chooseType:f,layerTime:g,confirm:h,showBox:i,ajax:d,upImage:m,upImageMultiple:n,removeImage:j,setCover:o}})