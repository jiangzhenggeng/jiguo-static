define(["jquery","layer","laydate"],function(a,b,c){function d(c,d,e,f,g){a.ajax({type:c,url:d,data:e,dataType:f||"JSON",success:function(a){a.success!="true"?b.msg(a.errorMsg||"操作失败"):g(a)}})}function e(a){var b=a.attr("data-value"),c=a.find("span").html(),d=a.parent().parent().parent();d.find("input").val(b),d.find(".Z-select-selected").find("span").html(c),d.trigger("blur"),a.attr("data-selected",""),a.siblings("li").removeAttr("data-selected")}function f(){a("body").on("focus","[data-z-select]",function(){a(this).find(".Z-select-list").show()}),a("body").on("blur","[data-z-select]",function(){a(this).find(".Z-select-list").hide()}),a("body").on("click","[data-z-select] li",function(){e(a(this))})}function g(a,b){var d={elem:a||"#start",format:"YYYY-MM-DD hh:mm:ss",min:"1970-01-1 23:59:59",max:"2099-06-16 23:59:59",istime:!0,istoday:!1,choose:function(a){e.min=a,e.start=a}},e={elem:b||"#end",format:"YYYY-MM-DD hh:mm:ss",min:"1970-01-1 23:59:59",max:"2099-06-16 23:59:59",istime:!0,istoday:!1,choose:function(a){d.max=a}};c(d),c(e)}function h(a,c,e,f){var a=a||"您确定吗？";b.confirm(a,{bth:["确定","取消"]},function(){f?f():(b.msg("操作中",{time:999999}),d("post",c,e,"JSON",function(){b.msg("操作成功",function(){window.location.reload()})}))})}function i(a,c,d,e,f){b.open({type:1,title:a,scrollbar:!0,area:[c,d],content:e,success:f})}function j(){a("body").on("click","[data-delete]",function(){a(this).parent().remove()})}function k(c,d,e,f,g){var h="http://zdm.jiguo.com/admin2/ajax/upload",i=new XMLHttpRequest;i.open("POST",h),i.send(c);var l=k.cropper||"";i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){var c=JSON.parse(i.responseText);if(c.success!="true")b.msg(c.errorMsg);else{a("#imgLoading").remove();if(f){var h='<li><img src="'+c.result.url+'"><span data-delete>x</span><input type="hidden" name="'+e+'" value="'+c.result.fileid+'">'+l+"</li>";d.append(h)}else{var h='<li><img src="'+c.result.url+'"><span data-delete>x</span><input type="hidden" name="'+e+'" value="'+c.result.fileid+'">'+l+"</li>";d.html(h)}j(),(g||function(){})()}}}}function l(c,d,e){var f="http://zdm.jiguo.com/admin2/ajax/multipleupload",g=new XMLHttpRequest;g.open("POST",f),g.send(c);var h=l.cropper||"";g.onreadystatechange=function(){if(g.readyState==4&&g.status==200){var c=JSON.parse(g.responseText);if(c.success!="true")b.msg(c.errorMsg);else{for(var f=0;f<c.result.length;f++){a("#imgLoading").remove();var i='<li><img src="'+c.result[f].url+'"><span data-delete>x</span><input type="hidden" name="'+e+'" value="'+c.result[f].fileid+'">'+h+"</li>";d.append(i)}j()}}}}function m(b,c,d){var e=k.cropper=m.cropper||"";a("#"+b+"").find("input").change(function(){var b=a(this)[0].files;if(b.length<=0)return;var f='<li id="imgLoading"><img src="http://cdn.jiguo.com/p1/i/loading-icon.gif" class="img-loading">'+e+"</li>",g=a(this).parent().prev();d?g.append(f):g.html(f);var h=new FormData;h.append("file",b[0]),k(h,g,c,d)})}function n(b,c){var d=n.cropper||"";a("#"+b+"").find("input").change(function(){var b=this,e=a(b).parent().prev(),f=new FormData,g=a(this)[0].files;if(g.length<=0)return;a(g).each(function(b){var c='<li id="imgLoading"><img src="http://cdn.jiguo.com/p1/i/loading-icon.gif" class="img-loading">'+d+"</li>";e.append(c),f.append("file"+b,a(this)[0])}),l.cropper=d,l(f,e,c)})}function o(b){a("body").on("click",".Z-cover-hover",function(){a(this).closest("ul").find(".Z-cover-hover").removeClass("Z-block-red"),a(this).addClass("Z-block-red"),a(b).val(a(this).closest("li").find('input[type="hidden"]').val())})}return{chooseType:f,layerTime:g,confirm:h,showBox:i,ajax:d,upImage:m,upImageMultiple:n,removeImage:j,setCover:o,upload:k}})