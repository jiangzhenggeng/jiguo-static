/*!
 * Cropper.js v1.1.2
 * https://github.com/fengyuanchen/cropperjs
 *
 * Copyright (c) 2015-2017 Chen Fengyuan
 * Released under the MIT license
 *
 * Date: 2017-10-18T13:27:02.189Z
 */

(function(a,b){typeof exports=="object"&&typeof module!="undefined"?module.exports=b():typeof define=="function"&&define.amd?define([],b):a.Cropper=b()})(this,function(){function a(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function b(a){return typeof a=="number"&&!Ib(a)}function c(a){return typeof a=="undefined"}function d(a){return(typeof a=="undefined"?"undefined":Hb(a))==="object"&&a!==null}function e(a){if(!d(a))return!1;try{var b=a.constructor,c=b.prototype;return b&&c&&Jb.call(c,"isPrototypeOf")}catch(e){return!1}}function f(a){return typeof a=="function"}function g(a,c){if(a&&f(c))if(Array.isArray(a)||b(a.length)){var e=a.length,g=void 0;for(g=0;g<e;g+=1)if(c.call(a,a[g],g,a)===!1)break}else d(a)&&Object.keys(a).forEach(function(b){c.call(a,a[b],b,a)});return a}function h(a){for(var b=arguments.length,c=Array(b>1?b-1:0),e=1;e<b;e++)c[e-1]=arguments[e];if(d(a)&&c.length>0){if(Object.assign)return Object.assign.apply(Object,[a].concat(c));c.forEach(function(b){d(b)&&Object.keys(b).forEach(function(c){a[c]=b[c]})})}return a}function i(a,b){for(var c=arguments.length,d=Array(c>2?c-2:0),e=2;e<c;e++)d[e-2]=arguments[e];return function(){for(var c=arguments.length,e=Array(c),f=0;f<c;f++)e[f]=arguments[f];return a.apply(b,d.concat(e))}}function j(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1e11;return Kb.test(a)?Math.round(a*b)/b:a}function k(a,c){var d=a.style;g(c,function(a,c){Lb.test(c)&&b(a)&&(a+="px"),d[c]=a})}function l(a,b){return a.classList?a.classList.contains(b):a.className.indexOf(b)>-1}function m(a,c){if(!c)return;if(b(a.length)){g(a,function(a){m(a,c)});return}if(a.classList){a.classList.add(c);return}var d=a.className.trim();d?d.indexOf(c)<0&&(a.className=d+" "+c):a.className=c}function n(a,c){if(!c)return;if(b(a.length)){g(a,function(a){n(a,c)});return}if(a.classList){a.classList.remove(c);return}a.className.indexOf(c)>=0&&(a.className=a.className.replace(c,""))}function o(a,c,d){if(!c)return;if(b(a.length)){g(a,function(a){o(a,c,d)});return}d?m(a,c):n(a,c)}function p(a){return a.replace(Mb,"$1-$2").toLowerCase()}function q(a,b){return d(a[b])?a[b]:a.dataset?a.dataset[b]:a.getAttribute("data-"+p(b))}function r(a,b,c){d(c)?a[b]=c:a.dataset?a.dataset[b]=c:a.setAttribute("data-"+p(b),c)}function s(a,b){if(d(a[b]))delete a[b];else if(a.dataset)try{delete a.dataset[b]}catch(c){a.dataset[b]=null}else a.removeAttribute("data-"+p(b))}function t(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!f(c))return;var e=b.trim().split(Nb);if(e.length>1){g(e,function(b){t(a,b,c)});return}f(c.onceListener)&&(c=c.onceListener,delete c.onceListener),a.removeEventListener?a.removeEventListener(b,c,d):a.detachEvent&&a.detachEvent("on"+b,c)}function u(a,b,c){var d=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};if(!f(c))return;var e=b.trim().split(Nb);if(e.length>1){g(e,function(b){u(a,b,c)});return}if(d.once){var h=c,i=function j(){for(var c=arguments.length,d=Array(c),e=0;e<c;e++)d[e]=arguments[e];return t(a,b,j),h.apply(a,d)};h.onceListener=i,c=i}a.addEventListener?a.addEventListener(b,c,d):a.attachEvent&&a.attachEvent("on"+b,c)}function v(a,b,d){if(a.dispatchEvent){var e=void 0;return f(Event)&&f(CustomEvent)?c(d)?e=new Event(b,{bubbles:!0,cancelable:!0}):e=new CustomEvent(b,{detail:d,bubbles:!0,cancelable:!0}):c(d)?(e=document.createEvent("Event"),e.initEvent(b,!0,!0)):(e=document.createEvent("CustomEvent"),e.initCustomEvent(b,!0,!0,d)),a.dispatchEvent(e)}return a.fireEvent?a.fireEvent("on"+b):!0}function w(a){var b=document.documentElement,c=a.getBoundingClientRect();return{left:c.left+((P.scrollX||b&&b.scrollLeft||0)-(b&&b.clientLeft||0)),top:c.top+((P.scrollY||b&&b.scrollTop||0)-(b&&b.clientTop||0))}}function x(a){while(a.firstChild)a.removeChild(a.firstChild)}function y(a){var b=a.match(Pb);return b&&(b[1]!==Ob.protocol||b[2]!==Ob.hostname||b[3]!==Ob.port)}function z(a){var b="timestamp="+(new Date).getTime();return a+(a.indexOf("?")===-1?"?":"&")+b}function A(a){var c=a.rotate,d=a.scaleX,e=a.scaleY,f=a.translateX,g=a.translateY,h=[];b(f)&&f!==0&&h.push("translateX("+f+"px)"),b(g)&&g!==0&&h.push("translateY("+g+"px)"),b(c)&&c!==0&&h.push("rotate("+c+"deg)"),b(d)&&d!==1&&h.push("scaleX("+d+")"),b(e)&&e!==1&&h.push("scaleY("+e+")");var i=h.length?h.join(" "):"none";return{WebkitTransform:i,msTransform:i,transform:i}}function B(a,b){if(a.naturalWidth&&!Rb){b(a.naturalWidth,a.naturalHeight);return}var c=document.createElement("img");c.onload=function(){b(c.width,c.height)},c.src=a.src}function C(a){var b=h({},a),c=[];return g(a,function(a,d){delete b[d],g(b,function(b){var d=Math.abs(a.startX-b.startX),e=Math.abs(a.startY-b.startY),f=Math.abs(a.endX-b.endX),g=Math.abs(a.endY-b.endY),h=Math.sqrt(d*d+e*e),i=Math.sqrt(f*f+g*g),j=(i-h)/h;c.push(j)})}),c.sort(function(a,b){return Math.abs(a)<Math.abs(b)}),c[0]}function D(a,b){var c=a.pageX,d=a.pageY,e={endX:c,endY:d};return b?e:h({startX:c,startY:d},e)}function E(a){var b=0,c=0,d=0;return g(a,function(a){var e=a.startX,f=a.startY;b+=e,c+=f,d+=1}),b/=d,c/=d,{pageX:b,pageY:c}}function F(a){var b=a.aspectRatio,c=a.height,d=a.width,e=function(a){return Sb(a)&&a>0};return e(d)&&e(c)?c*b>d?c=d/b:d=c*b:e(d)?c=d/b:e(c)&&(d=c*b),{width:d,height:c}}function G(a){var b=a.width,c=a.height,d=a.degree;d=Math.abs(d);if(d%180===90)return{width:c,height:b};var e=d%90*Math.PI/180,f=Math.sin(e),g=Math.cos(e);return{width:b*g+c*f,height:b*f+c*g}}function H(b,c,d,e){var f=c.naturalWidth,g=c.naturalHeight,h=c.rotate,i=c.scaleX,k=c.scaleY,l=d.aspectRatio,m=d.naturalWidth,n=d.naturalHeight,o=e.fillColor,p=o===undefined?"transparent":o,q=e.imageSmoothingEnabled,r=q===undefined?!0:q,s=e.imageSmoothingQuality,t=s===undefined?"low":s,u=e.maxWidth,v=u===undefined?Infinity:u,w=e.maxHeight,x=w===undefined?Infinity:w,y=e.minWidth,z=y===undefined?0:y,A=e.minHeight,B=A===undefined?0:A,C=document.createElement("canvas"),D=C.getContext("2d"),E=F({aspectRatio:l,width:v,height:x}),G=F({aspectRatio:l,width:z,height:B}),H=Math.min(E.width,Math.max(G.width,m)),I=Math.min(E.height,Math.max(G.height,n)),J=[-f/2,-g/2,f,g];return C.width=j(H),C.height=j(I),D.fillStyle=p,D.fillRect(0,0,H,I),D.save(),D.translate(H/2,I/2),D.rotate(h*Math.PI/180),D.scale(i,k),D.imageSmoothingEnabled=r,D.imageSmoothingQuality=t,D.drawImage.apply(D,[b].concat(a(J.map(function(a){return Math.floor(j(a))})))),D.restore(),C}function I(a,b,c){var d="",e=void 0;c+=b;for(e=b;e<c;e+=1)d+=Tb(a.getUint8(e));return d}function J(a){var b=a.replace(Ub,""),c=atob(b),d=new ArrayBuffer(c.length),e=new Uint8Array(d);return g(e,function(a,b){e[b]=c.charCodeAt(b)}),d}function K(a,b){var c=new Uint8Array(a),d="";return g(c,function(a){d+=Tb(a)}),"data:"+b+";base64,"+btoa(d)}function L(a){var b=new DataView(a),c=void 0,d=void 0,e=void 0,f=void 0;if(b.getUint8(0)===255&&b.getUint8(1)===216){var g=b.byteLength,h=2;while(h<g){if(b.getUint8(h)===255&&b.getUint8(h+1)===225){e=h;break}h+=1}}if(e){var i=e+4,j=e+10;if(I(b,i,4)==="Exif"){var k=b.getUint16(j);d=k===18761;if(d||k===19789)if(b.getUint16(j+2,d)===42){var l=b.getUint32(j+4,d);l>=8&&(f=j+l)}}}if(f){var m=b.getUint16(f,d),n=void 0,o=void 0;for(o=0;o<m;o+=1){n=f+o*12+2;if(b.getUint16(n,d)===274){n+=8,c=b.getUint16(n,d),b.setUint16(n,1,d);break}}}return c}function M(a){var b=0,c=1,d=1;switch(a){case 2:c=-1;break;case 3:b=-180;break;case 4:d=-1;break;case 5:b=90,d=-1;break;case 6:b=90;break;case 7:b=90,c=-1;break;case 8:b=-90;break;default:}return{rotate:b,scaleX:c,scaleY:d}}function N(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function O(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var P=typeof window!="undefined"?window:{},Q="cropper",R="all",S="crop",T="move",U="zoom",V="e",W="w",X="s",Y="n",Z="ne",$="nw",_="se",ab="sw",bb=Q+"-crop",cb=Q+"-disabled",db=Q+"-hidden",eb=Q+"-hide",fb=Q+"-invisible",gb=Q+"-modal",hb=Q+"-move",ib="action",jb="preview",kb="crop",lb="move",mb="none",nb="crop",ob="cropend",pb="cropmove",qb="cropstart",rb="dblclick",sb="error",tb="load",ub=P.PointerEvent?"pointerdown":"touchstart mousedown",vb=P.PointerEvent?"pointermove":"touchmove mousemove",wb=P.PointerEvent?" pointerup pointercancel":"touchend touchcancel mouseup",xb="ready",yb="resize",zb="wheel mousewheel DOMMouseScroll",Ab="zoom",Bb=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,Cb=/^data:/,Db=/^data:image\/jpeg;base64,/,Eb=/^(img|canvas)$/i,Fb={viewMode:0,dragMode:kb,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},Gb='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',Hb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(a){return typeof a}:function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ib=Number.isNaN||P.isNaN,Jb=Object.prototype.hasOwnProperty,Kb=/\.\d*(?:0|9){12}\d*$/i,Lb=/^(width|height|left|top|marginLeft|marginTop)$/,Mb=/([a-z\d])([A-Z])/g,Nb=/\s+/,Ob=P.location,Pb=/^(https?:)\/\/([^:/?#]+):?(\d*)/i,Qb=P.navigator,Rb=Qb&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(Qb.userAgent),Sb=Number.isFinite||P.isFinite,Tb=String.fromCharCode,Ub=/^data:.*,/,Vb={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var a=this.element,b=this.options,c=this.container,d=this.cropper;m(d,db),n(a,db);var e={width:Math.max(c.offsetWidth,Number(b.minContainerWidth)||200),height:Math.max(c.offsetHeight,Number(b.minContainerHeight)||100)};this.containerData=e,k(d,{width:e.width,height:e.height}),m(a,db),n(d,db)},initCanvas:function(){var a=this.containerData,b=this.imageData,c=this.options.viewMode,d=Math.abs(b.rotate)%180===90,e=d?b.naturalHeight:b.naturalWidth,f=d?b.naturalWidth:b.naturalHeight,g=e/f,i=a.width,j=a.height;a.height*g>a.width?c===3?i=a.height*g:j=a.width/g:c===3?j=a.width/g:i=a.height*g;var k={aspectRatio:g,naturalWidth:e,naturalHeight:f,width:i,height:j};k.left=(a.width-i)/2,k.top=(a.height-j)/2,k.oldLeft=k.left,k.oldTop=k.top,this.canvasData=k,this.limited=c===1||c===2,this.limitCanvas(!0,!0),this.initialImageData=h({},b),this.initialCanvasData=h({},k)},limitCanvas:function(a,b){var c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=c.viewMode,h=e.aspectRatio,i=this.cropped&&f;if(a){var j=Number(c.minCanvasWidth)||0,k=Number(c.minCanvasHeight)||0;g>1?(j=Math.max(j,d.width),k=Math.max(k,d.height),g===3&&(k*h>j?j=k*h:k=j/h)):g>0&&(j?j=Math.max(j,i?f.width:0):k?k=Math.max(k,i?f.height:0):i&&(j=f.width,k=f.height,k*h>j?j=k*h:k=j/h));var l=F({aspectRatio:h,width:j,height:k});j=l.width,k=l.height,e.minWidth=j,e.minHeight=k,e.maxWidth=Infinity,e.maxHeight=Infinity}if(b)if(g){var m=d.width-e.width,n=d.height-e.height;e.minLeft=Math.min(0,m),e.minTop=Math.min(0,n),e.maxLeft=Math.max(0,m),e.maxTop=Math.max(0,n),i&&this.limited&&(e.minLeft=Math.min(f.left,f.left+(f.width-e.width)),e.minTop=Math.min(f.top,f.top+(f.height-e.height)),e.maxLeft=f.left,e.maxTop=f.top,g===2&&(e.width>=d.width&&(e.minLeft=Math.min(0,m),e.maxLeft=Math.max(0,m)),e.height>=d.height&&(e.minTop=Math.min(0,n),e.maxTop=Math.max(0,n))))}else e.minLeft=-e.width,e.minTop=-e.height,e.maxLeft=d.width,e.maxTop=d.height},renderCanvas:function(a,b){var c=this.canvasData,d=this.imageData;if(b){var e=G({width:d.naturalWidth*Math.abs(d.scaleX),height:d.naturalHeight*Math.abs(d.scaleY),degree:d.rotate}),f=e.width,g=e.height,i=c.width*(f/c.naturalWidth),j=c.height*(g/c.naturalHeight);c.left-=(i-c.width)/2,c.top-=(j-c.height)/2,c.width=i,c.height=j,c.aspectRatio=f/g,c.naturalWidth=f,c.naturalHeight=g,this.limitCanvas(!0,!1)}if(c.width>c.maxWidth||c.width<c.minWidth)c.left=c.oldLeft;if(c.height>c.maxHeight||c.height<c.minHeight)c.top=c.oldTop;c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCanvas(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,k(this.canvas,h({width:c.width,height:c.height},A({translateX:c.left,translateY:c.top}))),this.renderImage(a),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(a){var b=this.canvasData,c=this.imageData,d=c.naturalWidth*(b.width/b.naturalWidth),e=c.naturalHeight*(b.height/b.naturalHeight);h(c,{width:d,height:e,left:(b.width-d)/2,top:(b.height-e)/2}),k(this.image,h({width:c.width,height:c.height},A(h({translateX:c.left,translateY:c.top},c)))),a&&this.output()},initCropBox:function(){var a=this.options,b=this.canvasData,c=a.aspectRatio,d=Number(a.autoCropArea)||.8,e={width:b.width,height:b.height};c&&(b.height*c>b.width?e.height=e.width/c:e.width=e.height*c),this.cropBoxData=e,this.limitCropBox(!0,!0),e.width=Math.min(Math.max(e.width,e.minWidth),e.maxWidth),e.height=Math.min(Math.max(e.height,e.minHeight),e.maxHeight),e.width=Math.max(e.minWidth,e.width*d),e.height=Math.max(e.minHeight,e.height*d),e.left=b.left+(b.width-e.width)/2,e.top=b.top+(b.height-e.height)/2,e.oldLeft=e.left,e.oldTop=e.top,this.initialCropBoxData=h({},e)},limitCropBox:function(a,b){var c=this.options,d=this.containerData,e=this.canvasData,f=this.cropBoxData,g=this.limited,h=c.aspectRatio;if(a){var i=Number(c.minCropBoxWidth)||0,j=Number(c.minCropBoxHeight)||0,k=Math.min(d.width,g?e.width:d.width),l=Math.min(d.height,g?e.height:d.height);i=Math.min(i,d.width),j=Math.min(j,d.height),h&&(i&&j?j*h>i?j=i/h:i=j*h:i?j=i/h:j&&(i=j*h),l*h>k?l=k/h:k=l*h),f.minWidth=Math.min(i,k),f.minHeight=Math.min(j,l),f.maxWidth=k,f.maxHeight=l}b&&(g?(f.minLeft=Math.max(0,e.left),f.minTop=Math.max(0,e.top),f.maxLeft=Math.min(d.width,e.left+e.width)-f.width,f.maxTop=Math.min(d.height,e.top+e.height)-f.height):(f.minLeft=0,f.minTop=0,f.maxLeft=d.width-f.width,f.maxTop=d.height-f.height))},renderCropBox:function(){var a=this.options,b=this.containerData,c=this.cropBoxData;if(c.width>c.maxWidth||c.width<c.minWidth)c.left=c.oldLeft;if(c.height>c.maxHeight||c.height<c.minHeight)c.top=c.oldTop;c.width=Math.min(Math.max(c.width,c.minWidth),c.maxWidth),c.height=Math.min(Math.max(c.height,c.minHeight),c.maxHeight),this.limitCropBox(!1,!0),c.left=Math.min(Math.max(c.left,c.minLeft),c.maxLeft),c.top=Math.min(Math.max(c.top,c.minTop),c.maxTop),c.oldLeft=c.left,c.oldTop=c.top,a.movable&&a.cropBoxMovable&&r(this.face,ib,c.width>=b.width&&c.height>=b.height?T:R),k(this.cropBox,h({width:c.width,height:c.height},A({translateX:c.left,translateY:c.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),this.complete&&v(this.element,nb,this.getData())}},Wb={initPreview:function(){var a=this.crossOrigin,b=this.options.preview,c=a?this.crossOriginUrl:this.url,d=document.createElement("img");a&&(d.crossOrigin=a),d.src=c,this.viewBox.appendChild(d),this.image2=d;if(!b)return;var e=b.querySelector?[b]:document.querySelectorAll(b);this.previews=e,g(e,function(b){var d=document.createElement("img");r(b,jb,{width:b.offsetWidth,height:b.offsetHeight,html:b.innerHTML}),a&&(d.crossOrigin=a),d.src=c,d.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',x(b),b.appendChild(d)})},resetPreview:function(){g(this.previews,function(a){var b=q(a,jb);k(a,{width:b.width,height:b.height}),a.innerHTML=b.html,s(a,jb)})},preview:function(){var a=this.imageData,b=this.canvasData,c=this.cropBoxData,d=c.width,e=c.height,f=a.width,i=a.height,j=c.left-b.left-a.left,l=c.top-b.top-a.top;if(!this.cropped||this.disabled)return;k(this.image2,h({width:f,height:i},A(h({translateX:-j,translateY:-l},a)))),g(this.previews,function(b){var c=q(b,jb),g=c.width,m=c.height,n=g,o=m,p=1;d&&(p=g/d,o=e*p),e&&o>m&&(p=m/e,n=d*p,o=m),k(b,{width:n,height:o}),k(b.getElementsByTagName("img")[0],h({width:f*p,height:i*p},A(h({translateX:-j*p,translateY:-l*p},a))))})}},Xb={bind:function(){var a=this.element,b=this.options,c=this.cropper;f(b.cropstart)&&u(a,qb,b.cropstart),f(b.cropmove)&&u(a,pb,b.cropmove),f(b.cropend)&&u(a,ob,b.cropend),f(b.crop)&&u(a,nb,b.crop),f(b.zoom)&&u(a,Ab,b.zoom),u(c,ub,this.onCropStart=i(this.cropStart,this)),b.zoomable&&b.zoomOnWheel&&u(c,zb,this.onWheel=i(this.wheel,this)),b.toggleDragModeOnDblclick&&u(c,rb,this.onDblclick=i(this.dblclick,this)),u(document,vb,this.onCropMove=i(this.cropMove,this)),u(document,wb,this.onCropEnd=i(this.cropEnd,this)),b.responsive&&u(P,yb,this.onResize=i(this.resize,this))},unbind:function(){var a=this.element,b=this.options,c=this.cropper;f(b.cropstart)&&t(a,qb,b.cropstart),f(b.cropmove)&&t(a,pb,b.cropmove),f(b.cropend)&&t(a,ob,b.cropend),f(b.crop)&&t(a,nb,b.crop),f(b.zoom)&&t(a,Ab,b.zoom),t(c,ub,this.onCropStart),b.zoomable&&b.zoomOnWheel&&t(c,zb,this.onWheel),b.toggleDragModeOnDblclick&&t(c,rb,this.onDblclick),t(document,vb,this.onCropMove),t(document,wb,this.onCropEnd),b.responsive&&t(P,yb,this.onResize)}},Yb={resize:function(){var a=this.options,b=this.container,c=this.containerData,d=Number(a.minContainerWidth)||200,e=Number(a.minContainerHeight)||100;if(this.disabled||c.width<=d||c.height<=e)return;var f=b.offsetWidth/c.width;if(f!==1||b.offsetHeight!==c.height){var h=void 0,i=void 0;a.restore&&(h=this.getCanvasData(),i=this.getCropBoxData()),this.render(),a.restore&&(this.setCanvasData(g(h,function(a,b){h[b]=a*f})),this.setCropBoxData(g(i,function(a,b){i[b]=a*f})))}},dblclick:function(){if(this.disabled||this.options.dragMode===mb)return;this.setDragMode(l(this.dragBox,bb)?lb:kb)},wheel:function(a){var b=this,c=Number(this.options.wheelZoomRatio)||.1,d=1;if(this.disabled)return;a.preventDefault();if(this.wheeling)return;this.wheeling=!0,setTimeout(function(){b.wheeling=!1},50),a.deltaY?d=a.deltaY>0?1:-1:a.wheelDelta?d=-a.wheelDelta/120:a.detail&&(d=a.detail>0?1:-1),this.zoom(-d*c,a)},cropStart:function(a){if(this.disabled)return;var b=this.options,c=this.pointers,d=void 0;a.changedTouches?g(a.changedTouches,function(a){c[a.identifier]=D(a)}):c[a.pointerId||0]=D(a),Object.keys(c).length>1&&b.zoomable&&b.zoomOnTouch?d=U:d=q(a.target,ib);if(!Bb.test(d))return;if(v(this.element,qb,{originalEvent:a,action:d})===!1)return;a.preventDefault(),this.action=d,this.cropping=!1,d===S&&(this.cropping=!0,m(this.dragBox,gb))},cropMove:function(a){var b=this.action;if(this.disabled||!b)return;var c=this.pointers;a.preventDefault();if(v(this.element,pb,{originalEvent:a,action:b})===!1)return;a.changedTouches?g(a.changedTouches,function(a){h(c[a.identifier],D(a,!0))}):h(c[a.pointerId||0],D(a,!0)),this.change(a)},cropEnd:function(a){if(this.disabled)return;var b=this.action,c=this.pointers;a.changedTouches?g(a.changedTouches,function(a){delete c[a.identifier]}):delete c[a.pointerId||0];if(!b)return;a.preventDefault(),Object.keys(c).length||(this.action=""),this.cropping&&(this.cropping=!1,o(this.dragBox,gb,this.cropped&&this.options.modal)),v(this.element,ob,{originalEvent:a,action:b})}},Zb={change:function(a){var b=this.options,c=this.canvasData,d=this.containerData,e=this.cropBoxData,f=this.pointers,h=this.action,i=b.aspectRatio,j=e.left,k=e.top,l=e.width,m=e.height,o=j+l,p=k+m,q=0,r=0,s=d.width,t=d.height,u=!0,v=void 0;!i&&a.shiftKey&&(i=l&&m?l/m:1),this.limited&&(q=e.minLeft,r=e.minTop,s=q+Math.min(d.width,c.width,c.left+c.width),t=r+Math.min(d.height,c.height,c.top+c.height));var x=f[Object.keys(f)[0]],y={x:x.endX-x.startX,y:x.endY-x.startY},z=function(a){switch(a){case V:o+y.x>s&&(y.x=s-o);break;case W:j+y.x<q&&(y.x=q-j);break;case Y:k+y.y<r&&(y.y=r-k);break;case X:p+y.y>t&&(y.y=t-p);break;default:}};switch(h){case R:j+=y.x,k+=y.y;break;case V:if(y.x>=0&&(o>=s||i&&(k<=r||p>=t))){u=!1;break}z(V),l+=y.x,i&&(m=l/i,k-=y.x/i/2),l<0&&(h=W,l=0);break;case Y:if(y.y<=0&&(k<=r||i&&(j<=q||o>=s))){u=!1;break}z(Y),m-=y.y,k+=y.y,i&&(l=m*i,j+=y.y*i/2),m<0&&(h=X,m=0);break;case W:if(y.x<=0&&(j<=q||i&&(k<=r||p>=t))){u=!1;break}z(W),l-=y.x,j+=y.x,i&&(m=l/i,k+=y.x/i/2),l<0&&(h=V,l=0);break;case X:if(y.y>=0&&(p>=t||i&&(j<=q||o>=s))){u=!1;break}z(X),m+=y.y,i&&(l=m*i,j-=y.y*i/2),m<0&&(h=Y,m=0);break;case Z:if(i){if(y.y<=0&&(k<=r||o>=s)){u=!1;break}z(Y),m-=y.y,k+=y.y,l=m*i}else z(Y),z(V),y.x>=0?o<s?l+=y.x:y.y<=0&&k<=r&&(u=!1):l+=y.x,y.y<=0?k>r&&(m-=y.y,k+=y.y):(m-=y.y,k+=y.y);l<0&&m<0?(h=ab,m=0,l=0):l<0?(h=$,l=0):m<0&&(h=_,m=0);break;case $:if(i){if(y.y<=0&&(k<=r||j<=q)){u=!1;break}z(Y),m-=y.y,k+=y.y,l=m*i,j+=y.y*i}else z(Y),z(W),y.x<=0?j>q?(l-=y.x,j+=y.x):y.y<=0&&k<=r&&(u=!1):(l-=y.x,j+=y.x),y.y<=0?k>r&&(m-=y.y,k+=y.y):(m-=y.y,k+=y.y);l<0&&m<0?(h=_,m=0,l=0):l<0?(h=Z,l=0):m<0&&(h=ab,m=0);break;case ab:if(i){if(y.x<=0&&(j<=q||p>=t)){u=!1;break}z(W),l-=y.x,j+=y.x,m=l/i}else z(X),z(W),y.x<=0?j>q?(l-=y.x,j+=y.x):y.y>=0&&p>=t&&(u=!1):(l-=y.x,j+=y.x),y.y>=0?p<t&&(m+=y.y):m+=y.y;l<0&&m<0?(h=Z,m=0,l=0):l<0?(h=_,l=0):m<0&&(h=$,m=0);break;case _:if(i){if(y.x>=0&&(o>=s||p>=t)){u=!1;break}z(V),l+=y.x,m=l/i}else z(X),z(V),y.x>=0?o<s?l+=y.x:y.y>=0&&p>=t&&(u=!1):l+=y.x,y.y>=0?p<t&&(m+=y.y):m+=y.y;l<0&&m<0?(h=$,m=0,l=0):l<0?(h=ab,l=0):m<0&&(h=Z,m=0);break;case T:this.move(y.x,y.y),u=!1;break;case U:this.zoom(C(f),a),u=!1;break;case S:if(!y.x||!y.y){u=!1;break}v=w(this.cropper),j=x.startX-v.left,k=x.startY-v.top,l=e.minWidth,m=e.minHeight,y.x>0?h=y.y>0?_:Z:y.x<0&&(j-=l,h=y.y>0?ab:$),y.y<0&&(k-=m),this.cropped||(n(this.cropBox,db),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0));break;default:}u&&(e.width=l,e.height=m,e.left=j,e.top=k,this.action=h,this.renderCropBox()),g(f,function(a){a.startX=a.endX,a.startY=a.endY})}},$b={crop:function(){return this.ready&&!this.disabled&&(this.cropped||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&m(this.dragBox,gb),n(this.cropBox,db)),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=h({},this.initialImageData),this.canvasData=h({},this.initialCanvasData),this.cropBoxData=h({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(h(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),n(this.dragBox,gb),m(this.cropBox,db)),this},replace:function(a){var b=arguments.length>1&&arguments[1]!==undefined?arguments[1]:!1;return!this.disabled&&a&&(this.isImg&&(this.element.src=a),b?(this.url=a,this.image.src=a,this.ready&&(this.image2.src=a,g(this.previews,function(b){b.getElementsByTagName("img")[0].src=a}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.load(a))),this},enable:function(){return this.ready&&(this.disabled=!1,n(this.cropper,cb)),this},disable:function(){return this.ready&&(this.disabled=!0,m(this.cropper,cb)),this},destroy:function(){var a=this.element,b=this.image;return this.loaded?(this.isImg&&this.replaced&&(a.src=this.originalUrl),this.unbuild(),n(a,db)):this.isImg?t(a,tb,this.onStart):b&&b.parentNode.removeChild(b),s(a,Q),this},move:function(a,b){var d=this.canvasData,e=d.left,f=d.top;return this.moveTo(c(a)?a:e+Number(a),c(b)?b:f+Number(b))},moveTo:function(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a,d=this.canvasData,e=!1;return a=Number(a),c=Number(c),this.ready&&!this.disabled&&this.options.movable&&(b(a)&&(d.left=a,e=!0),b(c)&&(d.top=c,e=!0),e&&this.renderCanvas(!0)),this},zoom:function(a,b){var c=this.canvasData;return a=Number(a),a<0?a=1/(1-a):a=1+a,this.zoomTo(c.width*a/c.naturalWidth,b)},zoomTo:function(a,b){var c=this.options,d=this.canvasData,e=d.width,f=d.height,g=d.naturalWidth,h=d.naturalHeight;a=Number(a);if(a>=0&&this.ready&&!this.disabled&&c.zoomable){var i=g*a,j=h*a;if(v(this.element,Ab,{originalEvent:b,oldRatio:e/g,ratio:i/g})===!1)return this;if(b){var k=this.pointers,l=w(this.cropper),m=k&&Object.keys(k).length?E(k):{pageX:b.pageX,pageY:b.pageY};d.left-=(i-e)*((m.pageX-l.left-d.left)/e),d.top-=(j-f)*((m.pageY-l.top-d.top)/f)}else d.left-=(i-e)/2,d.top-=(j-f)/2;d.width=i,d.height=j,this.renderCanvas(!0)}return this},rotate:function(a){return this.rotateTo((this.imageData.rotate||0)+Number(a))},rotateTo:function(a){return a=Number(a),b(a)&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=a%360,this.renderCanvas(!0,!0)),this},scaleX:function(a){var c=this.imageData.scaleY;return this.scale(a,b(c)?c:1)},scaleY:function(a){var c=this.imageData.scaleX;return this.scale(b(c)?c:1,a)},scale:function(a){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:a,d=this.imageData,e=!1;return a=Number(a),c=Number(c),this.ready&&!this.disabled&&this.options.scalable&&(b(a)&&(d.scaleX=a,e=!0),b(c)&&(d.scaleY=c,e=!0),e&&this.renderCanvas(!0,!0)),this},getData:function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:!1,b=this.options,c=this.imageData,d=this.canvasData,e=this.cropBoxData,f=void 0;if(this.ready&&this.cropped){f={x:e.left-d.left,y:e.top-d.top,width:e.width,height:e.height};var h=c.width/c.naturalWidth;g(f,function(b,c){b/=h,f[c]=a?Math.round(b):b})}else f={x:0,y:0,width:0,height:0};return b.rotatable&&(f.rotate=c.rotate||0),b.scalable&&(f.scaleX=c.scaleX||1,f.scaleY=c.scaleY||1),f},setData:function(a){var c=this.options,d=this.imageData,g=this.canvasData,h={};f(a)&&(a=a.call(this.element));if(this.ready&&!this.disabled&&e(a)){var i=!1;c.rotatable&&b(a.rotate)&&a.rotate!==d.rotate&&(d.rotate=a.rotate,i=!0),c.scalable&&(b(a.scaleX)&&a.scaleX!==d.scaleX&&(d.scaleX=a.scaleX,i=!0),b(a.scaleY)&&a.scaleY!==d.scaleY&&(d.scaleY=a.scaleY,i=!0)),i&&this.renderCanvas(!0,!0);var j=d.width/d.naturalWidth;b(a.x)&&(h.left=a.x*j+g.left),b(a.y)&&(h.top=a.y*j+g.top),b(a.width)&&(h.width=a.width*j),b(a.height)&&(h.height=a.height*j),this.setCropBoxData(h)}return this},getContainerData:function(){return this.ready?h({},this.containerData):{}},getImageData:function(){return this.loaded?h({},this.imageData):{}},getCanvasData:function(){var a=this.canvasData,b={};return this.ready&&g(["left","top","width","height","naturalWidth","naturalHeight"],function(c){b[c]=a[c]}),b},setCanvasData:function(a){var c=this.canvasData,d=c.aspectRatio;return f(a)&&(a=a.call(this.element)),this.ready&&!this.disabled&&e(a)&&(b(a.left)&&(c.left=a.left),b(a.top)&&(c.top=a.top),b(a.width)?(c.width=a.width,c.height=a.width/d):b(a.height)&&(c.height=a.height,c.width=a.height*d),this.renderCanvas(!0)),this},getCropBoxData:function(){var a=this.cropBoxData,b=void 0;return this.ready&&this.cropped&&(b={left:a.left,top:a.top,width:a.width,height:a.height}),b||{}},setCropBoxData:function(a){var c=this.cropBoxData,d=this.options.aspectRatio,g=void 0,h=void 0;return f(a)&&(a=a.call(this.element)),this.ready&&this.cropped&&!this.disabled&&e(a)&&(b(a.left)&&(c.left=a.left),b(a.top)&&(c.top=a.top),b(a.width)&&a.width!==c.width&&(g=!0,c.width=a.width),b(a.height)&&a.height!==c.height&&(h=!0,c.height=a.height),d&&(g?c.height=c.width/d:h&&(c.width=c.height*d)),this.renderCropBox()),this},getCroppedCanvas:function(){var a=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.ready||!P.HTMLCanvasElement)return null;var b=this.canvasData,c=H(this.image,this.imageData,b,a);if(!this.cropped)return c;var d=this.getData(),e=d.x,f=d.y,g=d.width,h=d.height,i=g/h,k=F({aspectRatio:i,width:a.maxWidth||Infinity,height:a.maxHeight||Infinity}),l=F({aspectRatio:i,width:a.minWidth||0,height:a.minHeight||0}),m=F({aspectRatio:i,width:a.width||g,height:a.height||h}),n=m.width,o=m.height;n=Math.min(k.width,Math.max(l.width,n)),o=Math.min(k.height,Math.max(l.height,o));var p=document.createElement("canvas"),q=p.getContext("2d");p.width=j(n),p.height=j(o),q.fillStyle=a.fillColor||"transparent",q.fillRect(0,0,n,o);var r=a.imageSmoothingEnabled,s=r===undefined?!0:r,t=a.imageSmoothingQuality;q.imageSmoothingEnabled=s,t&&(q.imageSmoothingQuality=t);var u=c.width,v=c.height,w=e,x=f,y=void 0,z=void 0,A=void 0,B=void 0,C=void 0,D=void 0;w<=-g||w>u?(w=0,y=0,A=0,C=0):w<=0?(A=-w,w=0,y=Math.min(u,g+w),C=y):w<=u&&(A=0,y=Math.min(g,u-w),C=y),y<=0||x<=-h||x>v?(x=0,z=0,B=0,D=0):x<=0?(B=-x,x=0,z=Math.min(v,h+x),D=z):x<=v&&(B=0,z=Math.min(h,v-x),D=z);var E=[w,x,y,z];if(C>0&&D>0){var G=n/g;E.push(A*G,B*G,C*G,D*G)}return q.drawImage.apply(q,[c].concat(N(E.map(function(a){return Math.floor(j(a))})))),p},setAspectRatio:function(a){var b=this.options;return!this.disabled&&!c(a)&&(b.aspectRatio=Math.max(0,a)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(a){var b=this.options,c=this.dragBox,d=this.face;if(this.loaded&&!this.disabled){var e=a===kb,f=b.movable&&a===lb;a=e||f?a:mb,r(c,ib,a),o(c,bb,e),o(c,hb,f),b.cropBoxMovable||(r(d,ib,a),o(d,bb,e),o(d,hb,f))}return this}},_b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),ac=P.Cropper,bc=function(){function a(b){var c=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};O(this,a);if(!b||!Eb.test(b.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=b,this.options=h({},Fb,e(c)&&c),this.complete=!1,this.cropped=!1,this.disabled=!1,this.isImg=!1,this.limited=!1,this.loaded=!1,this.ready=!1,this.replaced=!1,this.wheeling=!1,this.originalUrl="",this.canvasData=null,this.cropBoxData=null,this.previews=null,this.pointers={},this.init()}return _b(a,[{key:"init",value:function(){var a=this.element,b=a.tagName.toLowerCase(),c=void 0;if(q(a,Q))return;r(a,Q,this);if(b==="img"){this.isImg=!0,c=a.getAttribute("src")||"",this.originalUrl=c;if(!c)return;c=a.src}else b==="canvas"&&P.HTMLCanvasElement&&(c=a.toDataURL());this.load(c)}},{key:"load",value:function(a){var b=this;if(!a)return;this.url=a,this.imageData={};var c=this.element,d=this.options;if(!d.checkOrientation||!P.ArrayBuffer){this.clone();return}if(Cb.test(a)){Db.test(a)?this.read(J(a)):this.clone();return}var e=new XMLHttpRequest;e.onerror=function(){b.clone()},e.onload=function(){b.read(e.response)},d.checkCrossOrigin&&y(a)&&c.crossOrigin&&(a=z(a)),e.open("get",a),e.responseType="arraybuffer",e.withCredentials=c.crossOrigin==="use-credentials",e.send()}},{key:"read",value:function(a){var b=this.options,c=this.imageData,d=L(a),e=0,f=1,g=1;if(d>1){this.url=K(a,"image/jpeg");var h=M(d);e=h.rotate,f=h.scaleX,g=h.scaleY}b.rotatable&&(c.rotate=e),b.scalable&&(c.scaleX=f,c.scaleY=g),this.clone()}},{key:"clone",value:function(){var a=this.element,b=this.url,c=void 0,d=void 0;this.options.checkCrossOrigin&&y(b)&&(c=a.crossOrigin,c?d=b:(c="anonymous",d=z(b))),this.crossOrigin=c,this.crossOriginUrl=d;var e=document.createElement("img");c&&(e.crossOrigin=c),e.src=d||b;var f=i(this.start,this),g=i(this.stop,this);this.image=e,this.onStart=f,this.onStop=g,this.isImg?a.complete?this.start():u(a,tb,f):(u(e,tb,f),u(e,sb,g),m(e,eb),a.parentNode.insertBefore(e,a.nextSibling))}},{key:"start",value:function(a){var b=this,c=this.isImg?this.element:this.image;a&&(t(c,tb,this.onStart),t(c,sb,this.onStop)),B(c,function(a,c){h(b.imageData,{naturalWidth:a,naturalHeight:c,aspectRatio:a/c}),b.loaded=!0,b.build()})}},{key:"stop",value:function(){var a=this.image;t(a,tb,this.onStart),t(a,sb,this.onStop),a.parentNode.removeChild(a),this.image=null}},{key:"build",value:function(){var a=this;if(!this.loaded)return;this.ready&&this.unbuild();var b=this.element,c=this.options,d=this.image,e=b.parentNode,g=document.createElement("div");g.innerHTML=Gb;var h=g.querySelector("."+Q+"-container"),i=h.querySelector("."+Q+"-canvas"),j=h.querySelector("."+Q+"-drag-box"),k=h.querySelector("."+Q+"-crop-box"),l=k.querySelector("."+Q+"-face");this.container=e,this.cropper=h,this.canvas=i,this.dragBox=j,this.cropBox=k,this.viewBox=h.querySelector("."+Q+"-view-box"),this.face=l,i.appendChild(d),m(b,db),e.insertBefore(h,b.nextSibling),this.isImg||n(d,eb),this.initPreview(),this.bind(),c.aspectRatio=Math.max(0,c.aspectRatio)||NaN,c.viewMode=Math.max(0,Math.min(3,Math.round(c.viewMode)))||0,this.cropped=c.autoCrop,c.autoCrop?c.modal&&m(j,gb):m(k,db),c.guides||m(k.getElementsByClassName(Q+"-dashed"),db),c.center||m(k.getElementsByClassName(Q+"-center"),db),c.background&&m(h,Q+"-bg"),c.highlight||m(l,fb),c.cropBoxMovable&&(m(l,hb),r(l,ib,R)),c.cropBoxResizable||(m(k.getElementsByClassName(Q+"-line"),db),m(k.getElementsByClassName(Q+"-point"),db)),this.setDragMode(c.dragMode),this.render(),this.ready=!0,this.setData(c.data),this.completing=setTimeout(function(){f(c.ready)&&u(b,xb,c.ready,{once:!0}),v(b,xb),v(b,nb,a.getData()),a.complete=!0},0)}},{key:"unbuild",value:function(){if(!this.ready)return;this.complete||clearTimeout(this.completing),this.ready=!1,this.complete=!1,this.initialImageData=null,this.initialCanvasData=null,this.initialCropBoxData=null,this.containerData=null,this.canvasData=null,this.cropBoxData=null,this.unbind(),this.resetPreview(),this.previews=null,this.viewBox=null,this.cropBox=null,this.dragBox=null,this.canvas=null,this.container=null,this.cropper.parentNode.removeChild(this.cropper),this.cropper=null}}],[{key:"noConflict",value:function(){return P.Cropper=ac,a}},{key:"setDefaults",value:function(a){h(Fb,e(a)&&a)}}]),a}();return h(bc.prototype,Vb,Wb,Xb,Yb,Zb,$b),bc})