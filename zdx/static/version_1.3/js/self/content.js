define(["jquery","layer","self/common","template","self/creatUE"],function(a,b,c,d,e){function f(){a(document).ready(function(){a.each(a(".Z-grab-NewsList li"),function(){var b=a(this).find("span.id").text();localStorage.getItem(b)&&a(this).find("img").removeClass("Z-vis")})})}function g(a){var c=a.find(".grab-layerTitle input").val(),d=0,e=/[\w\s\d\.]/;for(var f=0;f<c.length;f++)d+=e.test(c[f])?.5:1;return d>19?(b.msg("字数限制为19字,现输入"+d+"字"),c.focus(),!1):!0}function h(f){var h=a.extend({width:"60%",height:"70%",template:null,addurl:null},f),i=0;a(".addArticle,.Z-grab-NewsList li").on("click",function(h){a(this).find("img").removeClass("Z-vis"),i++;var j=a(this).find("span.id").text();localStorage.setItem(j,!0);var k=a(this).find("span.classId").text(),l=a(this).find("span.articleTitle").text(),m=a(this).find("span.mediaSource").text(),n=a(this).find("span.URL").text(),o=a(this).find("span.content").html();if(j)var p={tpl:i,listId:j,classId:k,articleTitle:l,mediaSource:m,URL:n,content:o};else p={tpl:i};c.showBox("编辑文章","60%","70%",d(f.template,p),function(a){e.init("Z-grab-textContentID-"+i+""),c.testTitle(a.find(".grab-layerTitle input")[0],19);if(a.find(".Z-grab-contentEdit input[name=id]").val()){var d=a.find(".Z-grab-classify").data("classid");a.find(".Z-grab-classify option[value="+d+"]").attr("selected","selected")}a.find("input[data-submit]").on("click",function(d){d.preventDefault();if(!g(a))return!1;var e=a.find(".Z-grab-contentEdit").serialize();c.ajax("post","http://wx.zhidx.com/zhidx/content/add",e,"json",function(){b.msg("操作成功",function(){b.closeAll(),window.location.reload()})})})})})}return{newsListClick:h,GetIsRead:f}})