define(["jquery","layer","self/common","template","self/drag"],function(a,b,c,d,e){function f(){var d=a("#xcxTitle"),e=a("#xcxTitle1"),f=a("#xcxTitle2"),g=a("#xcxTitle3"),h=a("#num");return c.length(d.val().trim())<=0||c.length(d.val().trim())>38?(d.focus(),b.msg("小程序标题请介于1-38字"),!1):c.length(e.val().trim())<=0||c.length(e.val().trim())>32?(e.focus(),b.msg("主标题请介于1-32字"),!1):c.length(f.val().trim())<=0||c.length(f.val().trim()).length>32?(f.focus(),b.msg("副标题请介于1-32字"),!1):c.length(g.val().trim())<=0||c.length(g.val().trim())>32?(f.focus(),b.msg("PC标题请介于1-32字"),!1):h.val().trim().length<=0?(b.msg("请填写期数"),h.focus(),!1):!0}function g(e,f){a.get("/zhidx/content/list",{classid:e},function(g){if(g.success="true"){for(var h=0;h<g.result.length;h++)a.inArray(parseInt(g.result[h].id),window.sendIdArray)<0?g.result[h].show=!0:g.result[h].show=!1;a("#left-list").html(d("left-list-tpl",g)),a("#selectTitle").val(e),f&&f(),c.pass()}else b.msg("参数错误")},"json")}function h(b){var c=a.extend({parentDom:"#right",parentItemDom:".right-item",data:null},b);if(a.inArray(parseInt(c.data.classId),window.sendSourceArray)<0){a(c.parentDom).append(d("right-list-tpl",{data:c.data})),window.sendSourceArray.push(parseInt(c.data.classId));for(var e=0;e<c.data.result.length;e++)window.sendIdArray.push(parseInt(c.data.result[e].id))}else{var f=null;a.each(window.sendSourceArray,function(a,b){return c.data.classId==b&&(f=a),f}),a(a(c.parentItemDom)[f]).append(d("right-list-item-tpl",{data:c.data}));for(var e=0;e<c.data.result.length;e++)window.sendIdArray.push(parseInt(c.data.result[e].id))}}function i(){var d=a("#selectTitle").val();g(d),window.category=[],a("#selectTitle option").each(function(b,c){var d=a(this).val(),e=a(this).text();window.category.push({classid:d,classname:e})}),a("#refresh").click(function(){g(a("#selectTitle").val(),function(){a(".joininfo").removeAttr("data-opera").attr("data-warning",""),a("#chooseAll").prop("checked",!1),b.msg("刷新成功")})}),a("#selectTitle").on("change",function(){g(a(this).val(),function(){a(".joininfo").removeAttr("data-opera").attr("data-warning","")})}),a("body").on("click","[data-warning]",function(){c.confirm("你还没有选中内容","","",function(){b.closeAll()})}),a("body").on("click","[data-opera]",function(){var c=[],d=a("#selectTitle").find("option:selected").text(),e=a("#selectTitle").val();a("#left-list .icon:checked").each(function(b,d){var e=a(this).parent().parent(),f=e.data("parentid"),g=e.data("id"),h=e.data("title");c[b]={classid:f,id:g,title:h},a(this).attr("disabled",!0)}),b.closeAll(),h({data:{result:c,className:d,classId:e}}),a(".icon").prop("checked",!1)}),a("body").on("click",".Z-delete",function(){var b=a(this).next("input").val(),c=a(this).parent(),d=c.parent().find(".drag-dom"),e=c.siblings("input").val();window.sendIdArray=window.sendIdArray.filter(function(a){return a!=b});if(d.length<=1){var f=c.parent().parent();f.remove(),window.sendSourceArray=window.sendSourceArray.filter(function(a){return a!=e})}else c.remove();g(e)}),a("#publish").on("click",function(){if(!f())return!1;var d=a("#creatForm").serialize();c.ajax("post","/zhidx/content/push",d,"json",function(){b.msg("操作成功",function(){window.location="/zhidx/article/down"})})})}return{init:i,showLeft:g,showRight:h}})