define(["jquery","layer","laydate"],function(a,b,c){function d(c,d,e,f,g){a.ajax({type:c,url:d,data:e,dataType:f||"JSON",success:function(a){a.success!="true"?b.msg(a.errorMsg||"系统错误"):g(a)}})}function f(a,b){var d={elem:a||"#start",format:"YYYY-MM-DD hh:mm:ss",min:"1970-01-1 23:59:59",max:"2099-06-16 23:59:59",istime:!0,istoday:!1,choose:function(a){e.min=a,e.start=a}},e={elem:b||"#end",format:"YYYY-MM-DD hh:mm:ss",min:"1970-01-1 23:59:59",max:"2099-06-16 23:59:59",istime:!0,istoday:!1,choose:function(a){d.max=a}};c(d),c(e)}function g(a,c,e,f){var a=a||"您确定吗？";b.confirm(a,{bth:["确定","取消"]},function(){f?f():d("post",c,e,"JSON",function(){b.msg("操作成功",function(){window.location.reload()})})})}function h(a,c,d,e,f){b.open({type:1,title:a,scrollbar:!0,zIndex:5,area:[c,d],content:e,success:f})}function i(a,c,d,e){b.open({title:a,type:2,move:!1,scrollbar:!1,area:[c,d],content:e})}function j(){a("body").on("click","[data-delete]",function(){a(this).parent().remove()})}function k(c,d,e,f){var g="http://wx.zhidx.com/zhidx/ajax/upload",h=new XMLHttpRequest;h.open("POST",g),h.send(c),h.onreadystatechange=function(){if(h.readyState==4&&h.status==200){var c=JSON.parse(h.responseText);if(c.success!="true")b.msg(c.errorMsg);else{a("#imgLoading").remove();if(f){var g='<li><img src="'+c.result.url+'"><span data-delete>x</span><div class="Z-cover-hover">封面</div><input type="hidden" name="'+e+'" value="'+c.result.fileid+'"></li>';d.append(g)}else{var g='<li><img src="'+c.result.url+'"><span data-delete>x</span><input type="hidden" name="'+e+'" value="'+c.result.fileid+'"></li>';d.html(g)}j()}}}}function l(b,c,d){a("#"+b+"").find("input").change(function(){var b=a(this)[0].files;if(b.length<=0)return;var e='<li id="imgLoading"><img src="http://cdn.jiguo.com/p1/i/loading-icon.gif" class="img-loading"></li>',f=a(this).parent().prev();d?f.append(e):f.html(e);var g=new FormData;g.append("file",b[0]),k(g,f,c,d)})}function m(b){var b=a.extend({chooseBtn:"#chooseAll",checkboxes:"#left .icon",operaBtn:".Z-content-middle  .joininfo",operaAttr:"data-opera",warningAttr:"data-warning"},b),c=a(b.checkboxes).length,d=0;a(b.chooseBtn).off("change").on("change",function(){var e=a("#left").find(".icon:not([disabled])");e.prop("checked",a(this).is(":checked")),a(b.chooseBtn).is(":checked")?(d=c,a(b.operaBtn).removeAttr(b.warningAttr).attr(b.operaAttr,"")):(d=0,a(b.operaBtn).removeAttr(b.operaAttr).attr(b.warningAttr,""))}),a("body").off("change").on("change",b.checkboxes,function(){var e=this;a(e).prop("checked")?d++:(d--,a(b.chooseBtn).prop("checked",!1)),d==c&&(a(b.chooseBtn).prop("checked",!0),a(b.operaBtn).removeAttr(b.warningAttr).attr(b.operaAttr,"")),d>=1?a(b.operaBtn).removeAttr(b.warningAttr).attr(b.operaAttr,""):a(b.operaBtn).removeAttr(b.operaAttr).attr(b.warningAttr,"")})}function n(b,c){a(b).find(".Z-contenteditable").blur(function(){var b=a(this).text().trim();if(b.length>c){var d=b.substring(c),e=b.substring(0,c);a(this).html(e+'<span class="Z-red">'+d+"</span>")}})}function o(){var a=null;return window.clipboardData&&window.clipboardData.getData?a=window.clipboardData.getData("Text"):a=e.originalEvent.clipboardData.getData("Text"),a}function p(b,c){a(b).parent().find(".length").text("");var d=a(b).val();if(d===undefined)return;d=d.trim();var e=0,f=/[\w\s\d\.]/;for(var g=0;g<d.length;g++)e+=f.test(d[g])?.5:1;a(b).parent().find(".length").text(e),e>c?a(b).parent().find(".length").addClass("Z-red"):a(b).parent().find(".length").removeClass("Z-red")}function q(b,c){p(b,c),a(b).keyup(function(){p(b,c)})}function r(a){var b=0,c=/[\w\s\d\.]/;for(var d=0;d<a.length;d++)b+=c.test(a[d])?.5:1;return b}return{ajax:d,layerTime:f,confirm:g,showBox:h,openUrl:i,upImage:l,pass:m,testLength:n,testTitle:q,length:r}})