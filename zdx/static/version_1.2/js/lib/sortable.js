(function(){var a,b,c,d,e=function(a,b){return function(){return a.apply(b,arguments)}},f=[].slice;a=jQuery,b=function(){function a(){}return a.transitions={webkitTransition:"webkitTransitionEnd",mozTransition:"mozTransitionEnd",oTransition:"oTransitionEnd",transition:"transitionend"},a.transition=function(a){var b,c,d,e;b=a[0],e=this.transitions;for(d in e){c=e[d];if(b.style[d]!=null)return c}},a.execute=function(a,b){var c;return c=this.transition(a),c!=null?a.one(c,b):b()},a}(),c=function(){function b(a,b,c){this.click=e(this.click,this),this.moved=e(this.moved,this),this.ended=e(this.ended,this),this.began=e(this.began,this),this.coordinate=e(this.coordinate,this),this.off=e(this.off,this),this.on=e(this.on,this),this.toggle=e(this.toggle,this),this.bind=e(this.bind,this),this.$container=a,this.selector=b,this.callbacks=c,this.toggle()}return b.prototype.bind=function(b){return b==null&&(b="on"),a(document)[b]("mousemove touchmove",this.moved),a(document)[b]("mouseup touchend touchcancel",this.ended)},b.prototype.toggle=function(a){return a==null&&(a="on"),this.$container[a]("mousedown touchstart",this.selector,this.began),this.$container[a]("click",this.selector,this.click)},b.prototype.on=function(){return this.toggle("on")},b.prototype.off=function(){return this.toggle("off")},b.prototype.coordinate=function(a){switch(a.type){case"touchstart":case"touchmove":case"touchend":case"touchcancel":return a.originalEvent.touches[0];default:return a}},b.prototype.began=function(b){var c;if(this.$target)return;return b.preventDefault(),b.stopPropagation(),this.bind("on"),this.$target=a(b.target).closest(this.$container.find(this.selector)),this.$target.addClass("dragging"),this.origin={x:this.coordinate(b).pageX-this.$target.position().left,y:this.coordinate(b).pageY-this.$target.position().top},(c=this.callbacks)!=null?typeof c.began=="function"?c.began(b):void 0:void 0},b.prototype.ended=function(a){var b;if(this.$target==null)return;return a.preventDefault(),a.stopPropagation(),this.bind("off"),this.$target.removeClass("dragging"),delete this.$target,delete this.origin,(b=this.callbacks)!=null?typeof b.ended=="function"?b.ended(a):void 0:void 0},b.prototype.moved=function(a){var b;if(this.$target==null)return;return a.preventDefault(),a.stopPropagation(),this.$target.css({left:this.coordinate(a).pageX-this.origin.x,top:this.coordinate(a).pageY-this.origin.y}),this.dragged=this.$target,(b=this.callbacks)!=null?typeof b.moved=="function"?b.moved(a):void 0:void 0},b.prototype.click=function(a){if(!this.dragged)return;return a.preventDefault(),a.stopPropagation(),delete this.dragged},b}(),d=function(){function b(c,d){return d==null&&(d={}),this.optimize=e(this.optimize,this),this.layout=e(this.layout,this),this.structure=e(this.structure,this),this.position=e(this.position,this),this.size=e(this.size,this),this.draggingMoved=e(this.draggingMoved,this),this.draggingEnded=e(this.draggingEnded,this),this.draggingBegan=e(this.draggingBegan,this),this.$sorted=e(this.$sorted,this),this.draggable=e(this.draggable,this),this.compare=e(this.compare,this),this.$=e(this.$,this),this.reordinalize=e(this.reordinalize,this),this.ordinalize=e(this.ordinalize,this),this.$el=c,this.settings=a.extend({},b.settings,d),this.ordinalize(this.$("> *")),this.settings.draggable!==!1&&this.draggable(),this}return b.settings={base:60,gutter:20,columns:12,draggable:{zIndex:800,selector:"> *"}},b.gridly=function(a,c){var d;return c==null&&(c={}),d=a.data("_gridly"),d||(d=new b(a,c),a.data("_gridly",d)),d},b.prototype.ordinalize=function(b){var c,d,e,f,g;g=[];for(d=e=0,f=b.length;0<=f?e<=f:e>=f;d=0<=f?++e:--e)c=a(b[d]),g.push(c.data("position",d));return g},b.prototype.reordinalize=function(a,b){return a.data("position",b)},b.prototype.$=function(a){return this.$el.find(a)},b.prototype.compare=function(a,b){return a.y>b.y+b.h?1:b.y>a.y+a.h?-1:a.x+a.w/2>b.x+b.w/2?1:b.x+b.w/2>a.x+a.w/2?-1:0},b.prototype.draggable=function(a){this._draggable==null&&(this._draggable=new c(this.$el,this.settings.draggable.selector,{began:this.draggingBegan,ended:this.draggingEnded,moved:this.draggingMoved}));if(a!=null)return this._draggable[a]()},b.prototype.$sorted=function(b){return(b||this.$("> *")).sort(function(b,c){var d,e,f,g,h,i;return d=a(b),e=a(c),f=d.data("position"),h=e.data("position"),g=parseInt(f),i=parseInt(h),f!=null&&h==null?-1:h!=null&&f==null?1:!f&&!h&&d.index()<e.index()?-1:!h&&!f&&e.index()<d.index()?1:g<i?-1:i<g?1:0})},b.prototype.draggingBegan=function(a){var b,c,d;return b=this.$sorted(),this.ordinalize(b),setTimeout(this.layout,0),(c=this.settings)!=null?(d=c.callbacks)!=null?typeof d.reordering=="function"?d.reordering(b):void 0:void 0:void 0},b.prototype.draggingEnded=function(a){var b,c,d;return b=this.$sorted(),this.ordinalize(b),setTimeout(this.layout,0),(c=this.settings)!=null?(d=c.callbacks)!=null?typeof d.reordered=="function"?d.reordered(b):void 0:void 0:void 0},b.prototype.draggingMoved=function(b){var c,d,e,f,g,h,i,j,k,l,m,n,o;c=a(b.target).closest(this.$(this.settings.draggable.selector)),d=this.$sorted(this.$(this.settings.draggable.selector)),i=this.structure(d).positions,h=g=c.data("position"),m=i.filter(function(a){return a.$element.is(c)});for(j=0,l=m.length;j<l;j++)e=m[j],e.x=c.position().left,e.y=c.position().top,e.w=c.data("width")||c.width(),e.h=c.data("height")||c.height();i.sort(this.compare),d=i.map(function(a){return a.$element}),d=((n=this.settings.callbacks)!=null?n.optimize:void 0)||this.optimize(d);for(f=k=0,o=d.length;0<=o?k<o:k>o;f=0<=o?++k:--k)this.reordinalize(a(d[f]),f);return this.layout()},b.prototype.size=function(a){return((a.data("width")||a.width())+this.settings.gutter)/(this.settings.base+this.settings.gutter)},b.prototype.position=function(a,b){var c,d,e,f,g,h,i,j,k;g=this.size(a),d=Infinity,c=0;for(e=h=0,j=b.length-g;0<=j?h<j:h>j;e=0<=j?++h:--h)f=Math.max.apply(Math,b.slice(e,e+g)),f<d&&(d=f,c=e);for(e=i=c,k=c+g;c<=k?i<k:i>k;e=c<=k?++i:--i)b[e]=d+(a.data("height")||a.height())+this.settings.gutter;return{x:c*(this.settings.base+this.settings.gutter),y:d}},b.prototype.structure=function(b){var c,d,e,f,g,h,i,j;b==null&&(b=this.$sorted()),h=[],d=function(){var a,b,c;c=[];for(e=a=0,b=this.settings.columns;0<=b?a<=b:a>=b;e=0<=b?++a:--a)c.push(0);return c}.call(this);for(f=i=0,j=b.length;0<=j?i<j:i>j;f=0<=j?++i:--i)c=a(b[f]),g=this.position(c,d),h.push({x:g.x,y:g.y,w:c.data("width")||c.width(),h:c.data("height")||c.height(),$element:c});return{height:Math.max.apply(Math,d),positions:h}},b.prototype.layout=function(){var b,c,d,e,f,g,h,i;c=((h=this.settings.callbacks)!=null?h.optimize:void 0)||this.optimize(this.$sorted()),f=this.structure(c);for(d=g=0,i=c.length;0<=i?g<i:g>i;d=0<=i?++g:--g){b=a(c[d]),e=f.positions[d];if(b.is(".dragging"))continue;b.css({position:"absolute",left:e.x,top:e.y})}return this.$el.css({height:f.height})},b.prototype.optimize=function(b){var c,d,e,f,g;e=[],c=0;while(b.length>0){c===this.settings.columns&&(c=0),d=0;for(d=f=0,g=b.length;0<=g?f<g:f>g;d=0<=g?++f:--f)if(c+this.size(a(b[d]))<=this.settings.columns)break;d===b.length&&(d=0,c=0),c+=this.size(a(b[d])),e.push(b.splice(d,1)[0])}return e},b}(),a.fn.extend({gridly:function(){var b,c;return b=arguments[0],c=2<=arguments.length?f.call(arguments,1):[],b==null&&(b={}),this.each(function(){var e,f,g;return e=a(this),g=a.extend({},a.fn.gridly.defaults,typeof b=="object"&&b),f=typeof b=="string"?b:b.action,f==null&&(f="layout"),d.gridly(e,g)[f](c)})}})}).call(this)