define(["require","jquery"],function(a,b){function c(c){var c=b(c);if(!c.length)return;(c.css("position")!="absolute"||c.css("position")!="relative")&&c.css("position","relative");var d="/api/other/AvatarUpdate?key="+Math.random(),e="file",f=c.width(),g=c.height(),h=document.createElement("iframe"),i="display:block;width:"+f+"px;height:"+g+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;z-index:100;";b(h).on("load",function(){var j=(+(new Date)).toString(36),k,l,m;l=h.contentDocument||h.contentWindow.document,m=l.body,k=l.createElement("div"),k.innerHTML='<form id="edui_form_'+j+'" target="edui_iframe_'+j+'" method="POST" enctype="multipart/form-data" action="'+d+'" '+'style="'+i+'">'+'<input id="edui_input_'+j+'" type="file" accept="image/jpg,image/jpeg,image/png,image/gif" multiple="true" name="'+e+'" '+'style="'+i+'">'+"</form>"+'<iframe id="edui_iframe_'+j+'" name="edui_iframe_'+j+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>',k.className="edui-",k.id="_iframeupload",m.style.cssText=i,m.style.width=f+"px",m.style.height=g+"px",m.appendChild(k),m.parentNode&&(m.parentNode.style.width=f+"px",m.parentNode.style.height=f+"px");var n=l.getElementById("edui_form_"+j),o=l.getElementById("edui_input_"+j),p=l.getElementById("edui_iframe_"+j);b(o).on("change",function(){function e(){var a,d,f,h=(p.contentDocument||p.contentWindow.document).body,i=h.innerText||h.textContent||"";try{d=(new Function("return "+i))()}catch(j){c.find("img").removeClass("loading").attr("src",g),alert("上传失败,请重新试试");return}var k=c.find("input[type=hidden]");if(!("url"in d.result))throw"没有url";k.length&&c.find("input[type=hidden]").val(d.result.url),c.find("img").attr("class","success").attr("src",d.result.url),n.reset(),b(p).off("load",e)}if(!o.value)return;o.focus();var f=c.find("img"),g=f.attr("src");f.addClass("loading").attr("src",a.toUrl("../../style/ext_img/loading-icon.gif")),b(p).on("load",e),n.action=d,n.submit()})}),h.style.cssText=i,c.append(h)}return{init:c}})