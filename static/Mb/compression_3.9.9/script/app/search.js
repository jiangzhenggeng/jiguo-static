define(["jquery","app/unitTool","app/tplEngine"],function(a,b,c){function d(b){var b=a.extend({size:4,key:"event",url:"/api/article/GetArticleList",boxDom:"#ajax-loading-home-box",fireDom:".loading-more",tplDom:"#ajax-loading-home-box-tpl",sendData:{}},b);this.options=b,this.options.boxDom=a(this.options.boxDom),this.options.fireDom=a(this.options.fireDom),this.options.tplDom=a(this.options.tplDom),this.options.noData=a(".no-data"),this.loading=!0;var d=a(".loading");this.tplFunCache=c.init(this.options.tplDom.html()),this.options.sendData.limit=0,this.options.sendData.size=b.size,this.options.sendData.sys="mb"}function e(b){var c=new d(b);return c.run(),a(window).scroll(function(){var b=a(document).scrollTop()+a(window).height()+200;c.loading&&b>c.options.fireDom.offset().top&&c.run()}),c}var f=a(window).height();return d.prototype.run=function(){var c=this;if(!c.loading)return!0;c.loading=!1,c.options.fireDom.show(),a.get(c.options.url,c.options.sendData,function(a){var d=b.getLength(a.result[c.options.key]);if(d){var e=c.tplFunCache({data:a.result[c.options.key]});c.options.boxDom.append(e),c.options.sendData.limit=b.has(a,"limit")?a.limit:0,d<c.options.sendData.size?(c.loading=!1,c.options.noData.show(),c.options.fireDom.hide()):(c.loading=!0,f>c.options.fireDom.offset().top&&c.run())}else c.options.noData.show(),c.options.fireDom.hide(),c.load=!1},"json")},{init:e,index:function(d){d.sendData=a.extend({},d.sendData),a.get("/api/search/index",d.sendData,function(d){var e=["blog","event","product"],f=!1;for(var g=0,h=e.length;g<h;g++)if(b.getLength(d.result[e[g]])){f=!0;var i=c.init(a("#search-"+e[g]+"-tpl").html(),{data:d.result[e[g]]});a("#search-"+e[g]).html(i),a("#seaech-"+e[g]+"-num").html(d.result[e[g]+"_num"]),a("#search-"+e[g]+"-warp").show()}else a("#search-"+e[g]+"-warp").hide();f?a(".no-search-data").hide():a(".no-search-data").show(),a("#search-result-body").fadeIn(120)},"json")}}})