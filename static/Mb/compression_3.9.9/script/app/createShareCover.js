define(["jquery","app/unitTool"],function(a,b){function c(){var a=window.navigator.userAgent.toLowerCase();return a.match(/MicroMessenger/i)=="micromessenger"?!0:!1}function d(){return function(a){return a=a||{},new Promise(function(b,c){var d=new Image;d.src="/api/html/ShowImgTool?url="+encodeURIComponent(a.src),d.onload=function(){b(d)},d.onerror=function(){c(d)}})}}function e(a){return a*3}function f(b){return new Promise(function(f,g){var h="share-canvasId"+String(Math.random()).replace(".","");a("body").prepend('<canvas id="'+h+'" width="'+e(311)+'" height="'+e(420)+'" style="position: fixed;left: -99999px"/>');var i=document.querySelector("#"+h);const j=i.getContext("2d");j.fillStyle="#ffffff",j.fillRect(0,0,e(311),e(420)),d()({src:"https://s2.jiguo.com/46f9f0bb-9ade-465b-91b7-e7e15feac725"}).then(function(a){return j.drawImage(a,0,0,e(311),e(420)),d()({src:b})}).then(function(a){return j.drawImage(a,e(102),e(284),e(106),e(106)),d()({src:"https://s2.jiguo.com/3bd66db1-a358-4f91-b78d-84e36a36b926"})}).then(function(a){j.drawImage(a,e(142),e(324),e(25),e(25))}).then(function(){var b="share-canvasId"+String(Math.random()).replace(".",""),d=i.toDataURL("image/png"),e="position: fixed;z-index: 9;left: 0;top: 0;width:100%;height:100%;";a("body").prepend('<div id="'+b+'"><div style="'+e+'background: rgba(0,0,0,0.5)"><img src="'+d+'" style="width: 83%;margin: auto;display: block;margin-top: 30px;"/><a href="'+d+'" download="tupian" style="background: #F66039;height: 40px;width: 83%;color: #fff;font-size: 14px;line-height: 40px;text-align: center;display: block;margin: auto;margin-top: 30px">'+(c()?"长按图片识别二维码":"保存二维码至相册")+"</a></div>"+""+'<div id="'+b+'-close" style="background:#fff;box-shadow: 0 0 1px 1px #9a9a9a;border-radius: 50%;text-align: center;line-height: 24px;width: 24px;height: 24px;color: #ababab;position: fixed;right: 20px;top: 20px;z-index: 9;box-sizing: content-box;">x</div></div>').on("click","#"+b+"-close",function(){a("#"+b).remove()})}).catch(function(a){g(a)})})}function g(){return new Promise(function(b){var c="share-canvasId"+String(Math.random()).replace(".",""),d='			<div id="'+c+'" style="background: rgba(0,0,0,0.5);left: 0;top: 0;width: 100%;height: 100%;z-index: 5;position: fixed;">				<div style="width:80%;background: #fff;border-radius:5px;position: absolute;left: 50%;top: 50%;transform: translateY(-50%) translateX(-50%);">					<div><img style="width: 85px;margin: 20px auto;display: block;" src="http://s1.jiguo.com/056a13fe-f162-4f3f-979b-75429b749223"/></div>					<div style="padding: 30px 30px;padding-top:5px;color: #999;font-size: 13px">						<p>“一键申请”玩法无需填写申请理由，试用名额将根据原创投稿质量、活跃度（申请记录、文章评论...）等维度筛选。</p>					</div>					<div id="'+c+'-btn" style="color: #FF5D44;text-align: center;line-height: 40px;border-top: 1px solid #ececec;">知道啦，继续申请</div>				</div>			</div>					';a("body").append(d),a("body").on("click","#"+c+"-btn",function(){b()}).on("click","#"+c+"-close",function(){a("#"+c).remove()})})}function h(c){var d=c.attr("data-mid");a.get("/api/event/apply",{mid:d},function(a){a.resultCode==0?window.location="/mb/event/apply/mid/"+d+".html?action=share-v2&attention="+a.result.is_follow_service+"&erweimaUrl="+encodeURIComponent(a.result.weixin_url):b.msg(a.errorMsg||"申请错误")},"json")}return{createShareCover:f,showFirstApplySempl:g,toApplySemplExec:h}})