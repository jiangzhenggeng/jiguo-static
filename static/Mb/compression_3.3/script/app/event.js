define(["jquery","index","app/login","layer","app/tplEngine","app/countdown","app/videoAdapt","app/theAnchor","app/lazyload"],function(a,b,c,d,e,f,g,h,i){function j(){var i=/(\d+)/.exec(window.location)[0],j=a(window).width()-24,k="<style>.mian-stream li.large .stream-box .stream-img{height:"+j*320/640+"px !important;}"+"</style>";a("head").eq(0).append(k),a("a[data-login]").removeAttr("data-alert");var l=a(window).height()*2;a(".event-desc").height(l),a(".read-more").on("click",function(){a(this).css("z-index",-100),a(".event-desc").height("auto")}),a(".desc-more img").each(function(){a(this).height(a(this).width()/a(this).data("width")*a(this).data("height"))}),a(".desc-more").height()<=l&&a(".read-more").trigger("click");if(a("#apply-report-list").length>0){var m=0,n=e.init(a("#apply-report-list-tpl").html());function o(){a.get("/api/event/Getarticle",{id:i,p:m,size:3},function(b){if(b.success=="true"){b.result.data.length<3&&a(".look-more-artical").removeClass("more").html("没有更多了~");var c=n({data:b.result.data});a("#apply-report-list").append(c)}else a("#apply-report-list").append('<span class="error">数据错误</span>')},"json")}o(),a("body").on("click",".more",function(){m++,o()})}h.hrefInit(),h.eventInit();var p=a("body").width()-24;g.init({width:p}),a("body").on("click","[data-login]",function(a){a.preventDefault();if(!window.URL.login)return c.login(),!1}),a("body").on("click","[data-alert]",function(b){b.preventDefault();var c=e.init(a("#alert-tpl").html()),f=a(this).data("alert"),g=d.open({type:1,anim:"up",shade:"background-color: rgba(0,0,0,.3)",style:"width:75%;border-radius:5px",content:c({html:f}),success:function(b,c){a("body").on("click",".know-close",function(){d.close(g)})}})}),a("body").on("click","[data-pc]",function(b){b.preventDefault();var c=e.init(a("#alert-tpl").html()),f=d.open({type:1,anim:"up",shade:"background-color: rgba(0,0,0,.3)",style:"width:75%;border-radius:5px",content:c({html:"请用电脑打开该试用进行申请"}),success:function(b,c){a("body").on("click",".know-close",function(){d.close(f)})}})}),a("body").on("click","[data-like]",function(){if(!window.URL.login)return c.login(),!1;var b=a(this);a(this).hasClass("on")?a.get("/api/praise/praise",{id_value:i,type:6,status:-1},function(a){b.removeClass("on").find("i").removeClass("on animate")},"json"):a.get("/api/praise/praise",{id_value:i,type:6,status:1},function(a){a.resultCode=="-100"?c.login():a.resultCode=="0"?b.addClass("on").find("i").addClass("on animate"):d.msg("操作失败~请稍后再试")},"json")}),a("body").on("click","[data-share]",function(){var b=e.init(a("#share-tpl").html()),c=d.open({type:1,anim:"up",shade:"background-color: rgba(0,0,0,.3)",style:"position:fixed; bottom:0;left:0; width: 100%;",content:b({}),success:function(b,e){a("body").on("click",".share-query",function(){d.close(c)})}})}),a("body").on("click","[data-buy]",function(){var b=e.init(a("#buy-tpl").html()),c=d.open({type:1,anim:"up",shade:"background-color: rgba(0,0,0,.3)",style:"position:fixed; bottom:0;left:0; width: 100%;",content:b({}),success:function(b,e){a("body").on("click",".share-query",function(){d.close(c)})}})}),window.__no_session_cache__=!0,new b.init({url:"/api/comment/geteventapply.html",size:10,boxDom:"#apply-list",tplDom:"#apply-list-tpl",sendData:{id:i},callBack:function(){a("#apply-list .ugc:not([data-show])").each(function(){var b=a(this).find(".line-num");b&&b.position().top>a(this).height()&&(a(this).attr("data-show",""),a(this).after('<a href="javascript:;" class="look-more">展开</a>'))})}}),a("body").on("click",".look-more",function(){a(this).siblings(".ugc").removeClass("text-ellipsis-5"),a(this).remove()}),a("[data-down-time]").each(function(){var b=a(this).text(),c=a(this);f.run({dom:c,intDiff:b,callback:function(){window.location.reload()}})})}return{init:j}})