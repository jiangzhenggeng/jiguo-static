define(["require","jquery","app/tplEngine"],function(a,b,c){function d(a,d){this.loadMore=b(".g-load-more-btn"),this.is_loading=!0,this.limit="",this.size=8,this.p=0,this.url=a,this.user_center_comment_list=typeof d=="undefined"?b("#user-center-comment-list"):b(d),this.tpl_box=typeof d=="undefined"?b("#user-center-comment-list-tpl"):b(d+"-tpl"),this.func_tpl=c.init(this.tpl_box.html());var e=this;this.loadCommentFunc=function(){e.loadMore.addClass("g-loading").html(e.loadMore.attr("loading")),e.is_loading=!1,b.get(this.url,{limit:e.limit,size:e.size,p:e.p},function(a){e.loadMore.removeClass("g-loading").html(e.loadMore.attr("default")),a.data!=null?(e.limit=a.limit,e.p+=1,e.user_center_comment_list.append(e.func_tpl({data:a})),e.is_loading=!0,e.user_center_comment_list.find("article:not(.each)").each(function(){if(b(this).find("span.jiguo-show-open-flage").length<=0)return;b(this).height()>60&&b(this).find("span.jiguo-show-open-flage").position().top>b(this).height()&&(b(this).addClass("each"),b(this).after('<p class="jiguo-open-btn" data-show-html="隐藏" data-hide-html="展开">展开</p>'))}),a.data.length<e.size&&(e.is_loading=!1,e.loadMore.html(e.loadMore.attr("no-more")).css("background-image","none").addClass("g-no-data"))):(e.is_loading=!1,e.loadMore.html(e.loadMore.attr("no-more")).addClass("g-no-data").css("background-image","none"),e.p<=0&&e.loadMore.html(e.loadMore.attr("no-data")).addClass("g-no-data"))},"json")},e.is_loading&&e.loadCommentFunc(),e.loadMore.click(function(){e.is_loading&&e.loadCommentFunc()})}return{loadTool:d}})