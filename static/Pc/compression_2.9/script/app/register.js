define(["jquery","app/common","app/countdown"],function(a,b,c){function d(){layer.ready();var b=!0;a(".getcode").click(function(){var d=a("[data-tel]").val();if(!/^1[34578][0-9]{9}$/.test(d)){layer.tips("请正确填写手机号码",a("[data-tel]")),a("[data-tel]").focus();return}var e=a("[data-img-code]").val();if(e==""){layer.tips("请输入图片验证码",a("[data-img-code]")),a("[data-img-code]").focus();return}if(b==0){layer.msg("手机验证码已发送");return}b=!1,a.get("/api/validation/tel",{tel:d,vcode:e,action:action},function(d){if(d.resultCode!=0){layer.msg(d.errorMsg),d.resultCode==-2&&(b=!0,imgCode.trigger("click"));return}var e=a(".getcode");c.run({dom:".getcode",tplFn:function(a,c,d,f,g){e.html(f+"秒重新发送"),g<=0&&(e.html("发送验证码"),b=!0)}})},"json")}),a(".save-warp .btn").click(function(){var b=K.trim(a("[data-tel]").val()),c=K.trim(a("[data-img-code]").val()),d=K.trim(a("[data-phone-code]").val());if(!/^1[34578][0-9]{9}$/.test(b)){layer.tips("请正确填写手机号码",a("[data-tel]"));return}if(c==""){layer.tips("请输入图片验证码",a("[data-img-code]")),a("[data-img-code]").focus();return}if(d==""){layer.tips("请输入手机验证码",a("[data-phone-code]")),a("[data-phone-code]").focus();return}a.get(postUrl,{tel:b,vcode:c,code:d},function(a){if(a.resultCode!=0){layer.msg(a.errorMsg);return}window.location=callUrl},"json")})}return a(function(){var b=a("[data-register-img-code]");b.attr("src",b.attr("src")),b.click(function(){a(this).attr("src",b.attr("src").split("?")[0]+"?"+Math.random())})}),{init:d,setRegisterPassword:function(){layer.ready(),a(".save-warp .btn").click(function(){var b=K.trim(a("[data-username]").val()),c=K.trim(a("[data-password]").val()),d=K.trim(a("[data-repassword]").val());if(b==""){layer.tips("请填写用户名",a("[data-username]"));return}if(c==""){layer.tips("请填写密码",a("[data-password]"));return}if(c!=d){layer.tips("两次输入的密码不相同",a("[data-repassword]"));return}a.get("/api/user/name",{username:b,passwd:c},function(a){if(a.resultCode!=0){layer.msg(a.errorMsg);return}window.location="/"},"json")})},changePassword:function(){layer.ready(),a(".save-warp .btn").click(function(){var c=K.trim(a("[data-password]").val()),d=K.trim(a("[data-repassword]").val());if(c==""){layer.tips("请填写密码",a("[data-password]"));return}if(c!=d){layer.tips("两次输入的密码不相同",a("[data-repassword]"));return}a.get("/api/user/mobile",{passwd:c},function(a){if(a.resultCode!=0){layer.msg(a.errorMsg);return}layer.msg("密码修改成功",function(){b.login()})},"json")})}}})