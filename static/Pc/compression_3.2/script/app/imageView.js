define(["jquery","app/tplEngine","global.fun"],function(a,b,c){function d(){this.imgArray=[]}return d.prototype={getImg:function(b){b=a(b);var c=this;c.imgArray=[],b.find("img").each(function(){c.imgArray.push({src:a(this).attr("src"),title:a(this).attr("title")||a(this).attr("alt"),width:a(this).attr("data-width"),height:a(this).attr("data-height"),type:a(this).attr("data-img-type"),original:a(this).attr("data-original")})}),a("#"+this.viewId).remove()},setImgArray:function(b,c){c&&this.clearImgArray();for(var d in b)this.imgArray.push(b[d]);a("#"+this.viewId).remove()},clearImgArray:function(){this.imgArray=[],a("#"+this.viewId).remove()},createTpl:function(c){var d=this;if(a("#"+d.viewId).length>0)return!0;d.viewId=K.randomId(),a("body").append(b.init(a("#data-imgea-view-tpl").html(),{dataItem:d.imgArray,tplId:d.viewId,cuurObj:c})),a("body").on("click",".image-show-content",function(){d.close()}).on("click",".item-wrap",function(){d.curr=a(this);var b=a(this).parent();return b.parent().find("li.on").removeClass("on"),b.addClass("on"),d.imgShow||(d.imgShow=a(".image-show-item-real").find("img")),d.imgShow.attr("src",a(this).find("img").attr("data-larg-src")),d.curr.parent().prev("li").length<=0?a(".image-view-prev").css("opacity",.3):a(".image-view-prev").css("opacity",1),d.curr.parent().next("li").length<=0?a(".image-view-next").css("opacity",.3):a(".image-view-next").css("opacity",1),!1}).on("click",".image-view-prev",function(){return d.curr.parent().prev("li").length>0&&d.curr.parent().prev("li").find(".item-wrap").trigger("click"),!1}).on("click",".image-view-next",function(){return d.curr.parent().next("li").length>0&&d.curr.parent().next("li").find(".item-wrap").trigger("click"),!1}).on("click",".image-show-item-real",function(){return!1}),d.currAll=a(".bottom-item-wrap").find("li .item-wrap"),d.curr=d.currAll.first(),d.currAll.each(function(){if(a(this).find("img").attr("src")==c.attr("src"))return d.curr=a(this),!1}),d.curr.trigger("click")},run:function(b){if(this._run)return!0;var c=this;a(".comment-list-box").on("click","img[data-show-larg]",function(b){b.preventDefault();var d=a(this).closest("a"),e=d.attr("href");d.attr("href","javascript:;"),setTimeout(function(){d.attr("href",e)},800),c.clearImgArray(),c.getImg(a(this).closest(".comment-content-data-img")),c.createTpl(a(this)),a(document.body).css("overflow","hidden")}),this._run=!0},close:function(){a(document.body).css("overflow","visible"),a("body").off("click",".image-view-close").off("click",".item-wrap").off("click",".image-view-prev").off("click",".image-view-next"),this.imgShow=null,a("#"+this.viewId).remove()}},{init:new d}})