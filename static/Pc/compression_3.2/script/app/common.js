define(["require","jquery","global.fun","app/search","layer","app/tplEngine","app/scrollStatus","app/viewport"],function(a,b,c,d,e,f,g,h){function i(){var a="",c=window.URL.backUrl;b.post("/api/user/GetUrl",{back_url:c},function(c,d){d=="success"?(a=f.init(b("#login-input-tpl").html(),{data:c.result}),j(a)):e.msg(c.errorMsg)},"json")}function j(a){var c=K.randomId();e.ready(function(){var d=e.open({type:1,title:!1,closeBtn:0,shadeClose:!0,area:["715px","325px"],content:'<div id="'+c+'">'+a+"</div>",success:function(a,f){function g(c){if(c.type=="keypress"&&c.keyCode!=13)return;var d=a.find("input[data-login-username]").val().trim(),f=a.find("input[data-login-password]").val(),g=a.find("input[data-login-auto]").val();if(d.length<=0||d.length>32){e.tips("请正确填写手机号",a.find("input[data-login-username]"));return}if(f.length<=0||f.length>32){e.tips("请正确填写密码",a.find("input[data-login-password]"));return}b.get("/api/user/login",{tel:d,passwd:f,autologin:g},function(b){if(b.resultCode==0){window.__is_login_online__=!0,window.location.reload(),clearInterval(window.ajax_status),window.layer_close=!1;return}b.resultCode==-1?(e.msg(b.errorMsg),a.find("input[data-login-username]").focus()):b.resultCode==-2?(e.msg(b.errorMsg),a.find("input[data-login-password]").focus()):e.msg("系统错误")},"json")}function h(){window.layer_close&&(clearInterval(window.ajax_status),window.layer_close=!1);if(window.__is_login_online__)return;b.get("/ajax/code",function(a){a=a.trim().replace(/\s+/g,""),a==1&&(clearInterval(window.ajax_status),window.layer_close=!1,location.reload())})}setTimeout(function(){b(a).find(".apply-input-close").attr("onClick","layer.close('"+d+"')")});var a=b("#"+c);a.parent().parent().css("background-color","transparent"),a.find("input[data-login-username]").focus(),a.find("#window-login-submit").bind("click",g),a.find("input").bind("keypress",g),window.ajax_status=setInterval(h,1e3)},end:function(){window.layer_close=!0}})})}return b(function(){if(window.speedTop)return;window.speedTop=!0,h.init();var a='<div class="quick-speed-top"><a href="javascript:;"><div class="query-speed-box query-tel"><i class="query-tel-icon"></i><div class="query-content query-tel-content"><p class="ft-16 query-tel-txt">400-001-9217</p><p class="ft-12 query-tel-time">周一到周五 10:00-19:00</p></div></div></a><a href="javascript:;"><div class="query-speed-box query-wx"><i class="query-wx-icon"></i><div class="query-content query-wx-content"><div class="query-wx-erweima"></div><p class="ft-12 query-wx-txt">极果平平微信：jiguopp</p></div></div></a><a href="/feedback/isfeedback" target="_blank"><div class="query-speed-box"><i class="query-feedback-icon"></i></div></a><a href="javascript:;" data-quick-speed-top><div class="query-speed-box query-top"><i class="query-top-icon"></i></div></a></div>';b("body").append(a);var c=b(".quick-speed-top"),d=b(".footer"),e=b(window).height(),f=b(window).width(),g=d.outerHeight(),j=0,k=0,l=40,m=l,n=(f-1080)/2,o=f-n+50;f<=1080&&(o=1130);var p=function(a){e=b(window).height(),f=b(window).width(),j=0,k=0,l=40,m=l,n=(f-1080)/2,o=f-n+50,f<=1080&&(o=1130);var a={bottom:m,top:"auto",left:o};a||(a.display="none"),c.css(a)};p(),b(window).resize(function(){p(!0)}),c.find("[data-quick-speed-top]").click(function(){b("body,html").animate({scrollTop:0},600)}),b(window).scroll(function(){j=b(window).scrollTop(),k=d.offset().top;if(!(j>500)){c.hide(160);return}c.show(160),e+j>k?(m=e+j-k,c.css({bottom:m>l?m:l})):c.css({bottom:l})}),b("body").on("click","[href][data-query-cheack-login]",function(a){window.URL.login||(a.preventDefault(),i())}),b("body").on("click","#open-login-window",i)}),b(function(){b("body").on("click","[data-has-login]",function(a){if(!window.URL.login)return a.preventDefault(),i(),!1})}),{login:i,collect:function(a,c){var d=this;b(a||"#homeAjaxLoad").on("click",".five-pointed-star",function(a){a.preventDefault();var d=b(this);if(!window.URL.login){i();return}b.get("/api/praise/praise",{type:b(this).attr("data-type"),id_value:b(this).attr("data-id_value"),status:b(this).attr("data-status")},function(a){a.resultCode==-100?i():a.result.zan==1?d.addClass("like"):a.result.zan==-1?(d.removeClass("like"),c&&d.parent().parent().parent().fadeOut(500)):e.ready(function(){e.msg("网络错误")})},"json")})}}})